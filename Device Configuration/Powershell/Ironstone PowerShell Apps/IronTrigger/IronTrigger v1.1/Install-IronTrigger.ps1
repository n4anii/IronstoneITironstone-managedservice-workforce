<#
.SYNOPSIS
    <Short, what it does>


.DESCRIPTION
    <Long, what it does>


.OUTPUTS
    <What it outputs during runtime>


Usage:


Todo:


Resources:
- Base64Encode.org (https://www.base64encode.org/) for Base64 encoding of the files

#>


#region Variables
# Settings
[bool] $DebugWinTemp = $false
[bool] $DebugConsole = $true
[bool] $ReadOnly = $false
If ($DebugWinTemp) {[String] $Script:DebugStr=[String]::Empty}

# Variables
$NameScript     = 'IronTrigger'
$NameScriptFile = ('Install {0}' -f ($NameScript))
$DirLog         = ('{0}\Program Files\IronstoneIT\Intune\DeviceConfiguration\' -f ($env:SystemDrive))
$DirInstall     = ('{0}\Program Files\IronstoneIT\{1}\' -f ($env:SystemDrive,$NameScript))


# Script specific variables
[String] $Script:ScheduledTaskName = $NameScript


# Files
#region Files
# Enable-BitLockerTrigger.PS1
#region FilePS1
[String] $Script:NamePS1 = 'Enable_BitLocker.ps1'
[String] $Script:FilePS1 = ('PCNQU1NjcmlwdEluZm8gCi5WRVJTSU9OIDEuNwouR1VJRCBmNTE4N2UzZi1lZDBhLTRjZTEtYjQzOC1kOGY0MjE2MTljYTMgCi5PUklHSU5BTCBBVVRIT1IgSmFuIFZhbiBNZWlydmVubmUgCi5NT0RJRklFRCBCWSBPbGF2IFIuIEJpcmtlbGFuZCwgU29vcmFqIFJhamFnb3BhbGFuLCBQYXVsIEh1aWpicmVndHMsIFBpZXRlciBXaWdsZXZlbiAmIE5pYWxsIEJyYWR5ICh3aW5kb3dzLW5vb2IuY29tIDIwMTcvOC8xNykKLkNPUFlSSUdIVCAKLlRBR1MgQXp1cmUgSW50dW5lIEJpdExvY2tlciAgCi5MSUNFTlNFVVJJICAKLlBST0pFQ1RVUkkgIAouSUNPTlVSSSAgCi5FWFRFUk5BTE1PRFVMRURFUEVOREVOQ0lFUyAgCi5SRVFVSVJFRFNDUklQVFMgIAouRVhURVJOQUxTQ1JJUFRERVBFTkRFTkNJRVMgIAouUkVMRUFTRU5PVEVTCi5UT0RPCi0gV2ViaG9vaywgZW1haWwgb3Igc2ltaWxhciBmb3Igbm90aWZ5aW5nIGFkbWlucyBhYm91dCBYIGZhaWxlZCBydW5zICAKIz4KCjwjIAogCi5ERVNDUklQVElPTiAKIENoZWNrIHdoZXRoZXIgQml0TG9ja2VyIGlzIEVuYWJsZWQsIGlmIG5vdCBFbmFibGUgQml0TG9ja2VyIG9uIEFBRCBKb2luZWQgZGV2aWNlcyBhbmQgc3RvcmUgcmVjb3ZlcnkgaW5mbyBpbiBBQUQgCiBBZGRlZCBsb2dnaW5nCiM+IAoKW2NtZGxldGJpbmRpbmcoKV0KcGFyYW0oCiAgICBbUGFyYW1ldGVyKCldCiAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgW3N0cmluZ10gJE9TRHJpdmUgPSAkZW52OlN5c3RlbURyaXZlCikKW05ldC5TZXJ2aWNlUG9pbnRNYW5hZ2VyXTo6U2VjdXJpdHlQcm90b2NvbCA9IFtOZXQuU2VjdXJpdHlQcm90b2NvbFR5cGVdOjpUbHMxMgoKCgojcmVnaW9uIFNldHRpbmdzIGFuZCBWYXJpYWJsZXMKIyBTZXR0aW5ncwpbYm9vbF0gJEdVSSA9ICRmYWxzZQpbYm9vbF0gJFNjcmlwdDpCb29sUmVtb3ZlRmlsZXNBZnRlclN1Y2Nlc3MgPSAkZmFsc2UKIyBWYXJpYWJsZXMKW1N0cmluZ10gJExvY2FsOk5hbWVTY3JpcHQgICAgICAgICA9ICdJcm9uVHJpZ2dlcicKW1N0cmluZ10gJFNjcmlwdDpTY2hlZHVsZWRUYXNrTmFtZSA9ICRMb2NhbDpOYW1lU2NyaXB0LkNsb25lKCkKW1N0cmluZ10gJFNjcmlwdDpEaXJJbnN0YWxsICAgICAgICA9ICgnezB9XFByb2dyYW0gRmlsZXNcSXJvbnN0b25lSVRcezF9XCcgLWYgKCRlbnY6U3lzdGVtRHJpdmUsJE5hbWVTY3JpcHQpKQpbU3RyaW5nXSAkU2NyaXB0OkRpckxvZyAgICAgICAgICAgID0gKCd7MH1cUHJvZ3JhbSBGaWxlc1xJcm9uc3RvbmVJVFxJbnR1bmVcRGV2aWNlQ29uZmlndXJhdGlvblwnIC1mICgkZW52OlN5c3RlbURyaXZlKSkKW1N0cmluZ10gJFNjcmlwdDpGaWxlTG9nICAgICAgICAgICA9ICgnezB9SXJvblRyaWdnZXIgLSBFbmFibGVCaXRMb2NrZXIubG9nJyAtZiAoJFNjcmlwdDpEaXJMb2cpKQpbU3RyaW5nXSAkU2NyaXB0OkZpbGVTdGF0cyAgICAgICAgID0gKCd7MH1zdGF0cy50eHQnIC1mICgkU2NyaXB0OkRpckluc3RhbGwpKQojIEhlbHAgVmFyaWFibGVzCltTdHJpbmddICRTY3JpcHQ6Q29tcHV0ZXJOYW1lICAgICAgPSAkZW52OkNPTVBVVEVSTkFNRQpbU3RyaW5nW11dICRTY3JpcHQ6Qml0TG9ja2VyRW5jcnlwdGlvblN0YXR1c2VzID0gQCgnRnVsbHlEZWNyeXB0ZWQnLCdFbmNyeXB0aW9uSW5Qcm9ncmVzcycsJ0Z1bGx5RW5jcnlwdGVkJykKI2VuZHJlZ2lvbiBTZXR0aW5ncyBhbmQgVmFyaWFibGVzCgoKCiNyZWdpb24gRnVuY3Rpb25zCiAgICAjcmVnaW9uIExvZ1dyaXRlCiAgICBGdW5jdGlvbiBMb2dXcml0ZSB7CiAgICAgICAgUGFyYW0gKFtzdHJpbmddJExvZ1N0cmluZykKICAgICAgICBbc3RyaW5nXSAkYSA9IEdldC1EYXRlCiAgICAgICAgW3N0cmluZ10gJExvZ1N0cmluZyA9ICRhLCAkTG9nU3RyaW5nCiAgICAgICAgQWRkLWNvbnRlbnQgLVBhdGggJFNjcmlwdDpGaWxlTG9nIC1WYWx1ZSAkTG9nU3RyaW5nCiAgICAgICAgV3JpdGUtSG9zdCAkTG9nU3RyaW5nCiAgICB9CiAgICAjZW5kcmVnaW9uIExvZ1dyaXRlCgogICAgI3JlZ2lvbiBMb2dFcnJvcnMKICAgIEZ1bmN0aW9uIExvZ0Vycm9ycyB7CiAgICAgICAgTG9nV3JpdGUgKCdDYXVnaHQgYW4gZXhjZXB0aW9uOicpCiAgICAgICAgTG9nV3JpdGUgKCdFeGNlcHRpb24gVHlwZTogJyArICQoJF8uRXhjZXB0aW9uLkdldFR5cGUoKS5GdWxsTmFtZSkpCiAgICAgICAgTG9nV3JpdGUgKCdFeGNlcHRpb24gTWVzc2FnZTogJyArICQoJF8uRXhjZXB0aW9uLk1lc3NhZ2UpKQogICAgfQogICAgI2VuZHJlZ2lvbiBMb2dFcnJvcnMKCgogICAgI3JlZ2lvbiBXcml0ZS1TdGF0czoKICAgICMgV3JpdGUtU3RhdHM6IE91dHB1dHMgY3VycmVudCBzdGF0dXMgb2YgdmFyaW91cyBib29sZWFucyBhbmQgb3RoZXIgbWVhc3VyZW1lbnRzCiAgICBGdW5jdGlvbiBXcml0ZS1TdGF0cyB7CiAgICAgICAgW2Jvb2xbXV0gJExvY2FsOktleVByb3RlY3RvclR5cGVzID0gR2V0LUJpdExvY2tlcktleVByb3RlY3RvclR5cGVzICAgIAogICAgICAgIExvZ1dyaXRlICgnUnVuczogezB9IHwgRW5jcnlwdGVkOiB7MX0gfCBSZWNvdmVyeSBQYXNzd29yZHMgcHJlc2VudDogezJ9IHwgQmFja3VwIHRvIE9uZURyaXZlOiB7M30gfCBCYWNrdXAgdG8gQXp1cmVBRDogezR9JyAtZiAoJFNjcmlwdDpDb3VudFJ1bnMsJFNjcmlwdDpJc0VuY3J5cHRlZCwkU2NyaXB0OklzUHJvdGVjdGlvblBhc3N3LCRTY3JpcHQ6SXNCYWNrdXBPRCwkU2NyaXB0OklzQmFja3VwQUFEKSkKICAgICAgICBMb2dXcml0ZSAoJ0JpdExvY2tlciBLZXlQcm90ZWN0b3IgVHlwZXMgcHJlc2VudD8gfCBUUE06IHswfSB8IFJlY292ZXJ5UGFzc3dvcmQ6IHsxfScgLWYgKCRMb2NhbDpLZXlQcm90ZWN0b3JUeXBlc1swXSwkTG9jYWw6S2V5UHJvdGVjdG9yVHlwZXNbMV0pKQogICAgfQogICAgI2VuZHJlZ2lvbiBXcml0ZS1TdGF0czoKCgogICAgI3JlZ2lvbiBXcml0ZS1SZWNvdmVyeVBhc3N3b3JkCiAgICAjIFdyaXRlLVJlY292ZXJ5UGFzc3dvcmQKICAgIEZ1bmN0aW9uIFdyaXRlLVJlY292ZXJ5UGFzc3dvcmQgewogICAgICAgIEdldC1SZWNvdmVyeVBhc3N3b3JkcwogICAgICAgIExvZ1dyaXRlICgnVGhlcmVzIG9uZSBSZWNvdmVyeSBQYXNzd29yZCBwcmVzZW50OicpCiAgICAgICAgTG9nV3JpdGUgKEdldC1SZWNvdmVyeVBhc3N3b3Jkc1N0cmluZykKICAgIH0KICAgICNlbmRyZWdpb24gV3JpdGUtUmVjb3ZlcnlQYXNzd29yZAoKCiAgICAjcmVnaW9uIEdldC1CaXRMb2NrZXJTdGF0dXMKICAgICMgR2V0LUJpdExvY2tlclN0YXR1czogRmlsbHMgdHdvIHN0cmluZ3MgKHNjb3BlOnNjcmlwdCkgd2l0aCBjdXJyZW50IFZvbHVtZSBFbmNyeXB0aW9uIFN0YXR1cywgYW5kIFZvbHVtZSBQcm90ZWN0aW9uIFN0YXR1cy4KICAgIEZ1bmN0aW9uIEdldC1CaXRMb2NrZXJTdGF0dXMgewogICAgICAgIFtNaWNyb3NvZnQuQml0TG9ja2VyLlN0cnVjdHVyZXMuQml0TG9ja2VyVm9sdW1lXSAkTG9jYWw6Qml0TG9ja2VyU3RhdHVzID0gR2V0LUJpdExvY2tlclZvbHVtZSAtTW91bnRQb2ludCAkT1NEcml2ZQogICAgICAgIFtTdHJpbmddICRTY3JpcHQ6Vm9sdW1lRW5jU3RhdHVzID0gKCgkTG9jYWw6Qml0TG9ja2VyU3RhdHVzIHwgU2VsZWN0LU9iamVjdCAtUHJvcGVydHkgVm9sdW1lU3RhdHVzKS5Wb2x1bWVTdGF0dXMpLlRvU3RyaW5nKCkKICAgICAgICBbU3RyaW5nXSAkU2NyaXB0OlZvbHVtZVByb3RlY3Rpb25TdGF0dXMgPSAoKCRMb2NhbDpCaXRMb2NrZXJTdGF0dXMgfCBTZWxlY3QtT2JqZWN0IC1Qcm9wZXJ0eSBQcm90ZWN0aW9uU3RhdHVzKS5Qcm90ZWN0aW9uU3RhdHVzKS5Ub1N0cmluZygpCiAgICB9CiAgICAjZW5kcmVnaW9uIEdldC1CaXRMb2NrZXJTdGF0dXMKCgogICAgI3JlZ2lvbiBHZXQtQml0TG9ja2VyS2V5UHJvdGVjdG9yVHlwZXMKICAgICMgR2V0LUJpdExvY2tlcktleVByb3RlY3RvclR5cGVzOiBSZXR1cm5zIGEgYm9vbCBhcnJheSwgd2hlcmUgdGhlIGZpcnN0IHJlcHJlc2VudHMgc3RhdHVzIG9mIFRQTSBwcmVzZW5jZSwgYW5kIHRoZSBzZWNvbmQgZm9yIFByb3RlY3Rpb24gUGFzc3dvcmQKICAgIEZ1bmN0aW9uIEdldC1CaXRMb2NrZXJLZXlQcm90ZWN0b3JUeXBlcyB7CiAgICAgICAgW01pY3Jvc29mdC5CaXRMb2NrZXIuU3RydWN0dXJlcy5CaXRMb2NrZXJWb2x1bWVdICRMb2NhbDpCaXRMb2NrZXJTdGF0dXMgPSBHZXQtQml0TG9ja2VyVm9sdW1lIC1Nb3VudFBvaW50ICRPU0RyaXZlCiAgICAgICAgW3VpbnQxNl0gJExvY2FsOkNvdW50UmVjUGFzcyA9IDAKICAgICAgICBbdWludDE2XSAkTG9jYWw6Q291bnRUUE0gPSAwCiAgICAgICAgJExvY2FsOkJpdExvY2tlclN0YXR1cy5LZXlQcm90ZWN0b3IgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIElmICgkXy5LZXlQcm90ZWN0b3JUeXBlIC1lcSAnUmVjb3ZlcnlQYXNzd29yZCcpIHskTG9jYWw6Q291bnRSZWNQYXNzICs9IDF9CiAgICAgICAgICAgIEVsc2VJZiAoJF8uS2V5UHJvdGVjdG9yVHlwZSAtZXEgJ1RQTScpIHskTG9jYWw6Q291bnRUUE0gKz0gMX0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIChbYm9vbF0gKCRMb2NhbDpDb3VudFRQTSAtZ2UgMSksW2Jvb2xdICgkTG9jYWw6Q291bnRSZWNQYXNzIC1nZSAxKSkKICAgIH0KICAgICNlbmRyZWdpb25HZXQtQml0TG9ja2VyS2V5UHJvdGVjdG9yVHlwZXMKCgogICAgI3JlZ2lvbiBHZXQtUmVjb3ZlcnlQYXNzd29yZHMKICAgICMgR2V0LVJlY292ZXJ5UGFzc3dvcmRzOiBGaWxscyBhIGFycmF5bGlzdCB3aXRoIGV4aXN0aW5nIFByb3RlY3Rpb25QYXNzd29yZHMsIHNjb3BlOnNjcmlwdAogICAgRnVuY3Rpb24gR2V0LVJlY292ZXJ5UGFzc3dvcmRzIHsKICAgICAgICAjIEdldCBFeGlzdGluZyBCaXRMb2NrZXIgUHJvdGVjdGlvblBhc3N3b3JkcwogICAgICAgICRMb2NhbDpCaXRMb2NrU3RhdHVzID0gR2V0LUJpdExvY2tlclZvbHVtZSAtTW91bnRQb2ludCAkT1NEcml2ZQogICAgICAgICRMb2NhbDpLZXlQcm90ZWN0b3JTdGF0dXMgPSAoJExvY2FsOkJpdExvY2tTdGF0dXMgfCBTZWxlY3QtT2JqZWN0IC1Qcm9wZXJ0eSBLZXlQcm90ZWN0b3IpLktleVByb3RlY3RvcgogICAgICAgIFtTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0XSAkU2NyaXB0OkFycmF5UHJvdGVjdGlvblBhc3N3b3JkcyA9IFtTeXN0ZW0uQ29sbGVjdGlvbnMuQXJyYXlMaXN0XTo6bmV3KCkKICAgICAgICBbdWludDE2XSAkU2NyaXB0OkNvdW50UHJvdGVjdGlvbktleXMgPSAwCgogICAgICAgICRMb2NhbDpLZXlQcm90ZWN0b3JTdGF0dXMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgIElmICgkXy5LZXlQcm90ZWN0b3JUeXBlIC1lcSAnUmVjb3ZlcnlQYXNzd29yZCcpIHsKICAgICAgICAgICAgICAgICRTY3JpcHQ6Q291bnRQcm90ZWN0aW9uS2V5cyArPSAxCiAgICAgICAgICAgICAgICAkbnVsbCA9ICRTY3JpcHQ6QXJyYXlQcm90ZWN0aW9uUGFzc3dvcmRzLkFkZChbUFNDdXN0b21PYmplY3RdQHtLZXlQcm90ZWN0b3JJZCA9IFtTdHJpbmddJF8uS2V5UHJvdGVjdG9ySWQ7IFJlY292ZXJ5UGFzc3dvcmQgPSBbU3RyaW5nXSRfLlJlY292ZXJ5UGFzc3dvcmR9KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgI2VuZHJlZ2lvbiBHZXQtUmVjb3ZlcnlQYXNzd29yZHMKCgogICAgI3JlZ2lvbiBHZXQtUmVjb3ZlcnlQYXNzd29yZHNTdHJpbmcKICAgICMgR2V0LVJlY292ZXJ5UGFzc3dvcmRzU3RyaW5nOiBSZXR1cm5zIGEgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIHJlY292ZXJ5IHBhc3N3b3JkcyBmcm9tICRTY3JpcHQ6QXJyYXlQcm90ZWN0aW9uUGFzc3dvcmRzLiBVc2VmdWxsIGZvciBwcmludGluZy8gbG9nZ2luZy8gYmFja3VwCiAgICBGdW5jdGlvbiBHZXQtUmVjb3ZlcnlQYXNzd29yZHNTdHJpbmcgewogICAgICAgIFt1aW50MTZdICRMb2NhbDpUZW1wQ291bnRlciA9IDAKICAgICAgICBbU3RyaW5nXSAkTG9jYWw6T3V0U3RyID0gW1N0cmluZ106OkVtcHR5CiAgICAgICAgJFNjcmlwdDpBcnJheVByb3RlY3Rpb25QYXNzd29yZHMgfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICRMb2NhbDpPdXRTdHIgKz0gKCd7MH0gfCBLZXlQcm90ZWN0b3JJZCAiezF9IiB8IFJlY292ZXJ5UGFzc3dvcmQgInsyfSInIC1mICgoJExvY2FsOlRlbXBDb3VudGVyICs9IDEpLCRfLktleVByb3RlY3RvcklkLCRfLlJlY292ZXJ5UGFzc3dvcmQpKQogICAgICAgIH0KICAgICAgICBSZXR1cm4gJExvY2FsOk91dFN0cgogICAgfQogICAgI2VuZHJlZ2lvbiBHZXQtUmVjb3ZlcnlQYXNzd29yZHNTdHJpbmcKCgogICAgI3JlZ2lvbiBDcmVhdGUtRW52VmFyaWFibGVzCiAgICAjIENyZWF0ZS1FbnZWYXJpYWJsZXM6IENyZWF0ZXMgdmFyaWFibGVzIHVzZWQgYnkgdGhlIHRyb3VibGVzaG9vdGVyIGF0IHRoZSBib3R0b20sIHdoZW4gZmFpbGVkIHJ1bnMgcmVhY2hlcyBhIGdpdmVuIG51bWJlci4gIAogICAgRnVuY3Rpb24gQ3JlYXRlLUVudlZhcmlhYmxlcyB7CiAgICAgICAgIyMjIyBHbG9iYWwgVmFyaWFibGVzCiAgICAgICAgIyMgVGVuYW50CiAgICAgICAgW1N0cmluZ10gJExvY2FsOklEID0gKEdldC1DaGlsZEl0ZW0gQ2VydDpcTG9jYWxNYWNoaW5lXE15XCB8IFdoZXJlLU9iamVjdCB7ICRfLklzc3VlciAtbWF0Y2ggJ0NOPU1TLU9yZ2FuaXphdGlvbi1BY2Nlc3MnIH0pLlN1YmplY3QuUmVwbGFjZSgnQ049JywnJykKICAgICAgICBbU3RyaW5nXSAkU2NyaXB0Ok5hbWVUZW5hbnQgPSAoR2V0LUl0ZW1Qcm9wZXJ0eSBIS0xNOlxTWVNURU1cQ3VycmVudENvbnRyb2xTZXRcQ29udHJvbFxDbG91ZERvbWFpbkpvaW5cSm9pbkluZm9cJCgkTG9jYWw6SUQpKS5Vc2VyRW1haWwuU3BsaXQoJ0AnKVsxXQogICAgICAgIFtTdHJpbmddICRTY3JpcHQ6TmFtZVRlbmFudFNob3J0ID0gJEdsb2JhbDpOYW1lVGVuYW50LlNwbGl0KCcuJylbMF0KICAgICAgICAjIyBIYXJkd2FyZSBhbmQgV2luZG93cyBpbmZvCiAgICAgICAgW1N0cmluZ10gJFNjcmlwdDpDb21wdXRlck1hbnVmYWN0dXJlciA9IFF1ZXJ5LVJlZ2lzdHJ5IC1EaXIgJ0hLTE06XEhBUkRXQVJFXERFU0NSSVBUSU9OXFN5c3RlbVxCSU9TXFN5c3RlbU1hbnVmYWN0dXJlcicKICAgICAgICBJZiAoLW5vdChbU3RyaW5nXTo6SXNOdWxsT3JFbXB0eSgkU2NyaXB0OkNvbXB1dGVyTWFudWZhY3R1cmVyKSkpIHsKICAgICAgICAgICAgW1N0cmluZ10gJFNjcmlwdDpDb21wdXRlckZhbWlseSA9IFF1ZXJ5LVJlZ2lzdHJ5IC1EaXIgJ0hLTE06XEhBUkRXQVJFXERFU0NSSVBUSU9OXFN5c3RlbVxCSU9TXFN5c3RlbUZhbWlseScKICAgICAgICAgICAgW1N0cmluZ10gJFNjcmlwdDpDb21wdXRlclByb2R1Y3ROYW1lID0gUXVlcnktUmVnaXN0cnkgLURpciAnSEtMTTpcSEFSRFdBUkVcREVTQ1JJUFRJT05cU3lzdGVtXEJJT1NcU3lzdGVtUHJvZHVjdE5hbWUnCiAgICAgICAgICAgIFtTdHJpbmddICRTY3JpcHQ6V2luZG93c0VkaXRpb24gPSBRdWVyeS1SZWdpc3RyeSAtRGlyICdIS0xNOlxTT0ZUV0FSRVxNaWNyb3NvZnRcV2luZG93cyBOVFxDdXJyZW50VmVyc2lvblxQcm9kdWN0TmFtZScKICAgICAgICAgICAgW1N0cmluZ10gJFNjcmlwdDpXaW5kb3dzVmVyc2lvbiA9IFF1ZXJ5LVJlZ2lzdHJ5IC1EaXIgJ0hLTE06XFNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzIE5UXEN1cnJlbnRWZXJzaW9uXFJlbGVhc2VJZCcKICAgICAgICAgICAgW1N0cmluZ10gJFNjcmlwdDpXaW5kb3dzVmVyc2lvbiArPSAoJyAoezB9KScgLWYgKFF1ZXJ5LVJlZ2lzdHJ5IC1EaXIgJ0hLTE06XFNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzIE5UXEN1cnJlbnRWZXJzaW9uXEN1cnJlbnRCdWlsZCcpKQogICAgICAgIH0gCiAgICAgICAgRWxzZSB7CiAgICAgICAgICAgICRMb2NhbDpFbnZJbmZvID0gR2V0LVdtaU9iamVjdCAtQ2xhc3MgV2luMzJfQ29tcHV0ZXJTeXN0ZW0gfCBTZWxlY3QtT2JqZWN0IC1Qcm9wZXJ0eSBNYW51ZmFjdHVyZXIsTW9kZWwsU3lzdGVtRmFtaWx5ICAgICAgICAKICAgICAgICAgICAgW1N0cmluZ10gJFNjcmlwdDpDb21wdXRlck1hbnVmYWN0dXJlciA9ICRMb2NhbDpFbnZJbmZvLk1hbnVmYWN0dXJlcgogICAgICAgICAgICBbU3RyaW5nXSAkU2NyaXB0OkNvbXB1dGVyRmFtaWx5ID0gJExvY2FsOkVudkluZm8uU3lzdGVtRmFtaWx5CiAgICAgICAgICAgIFtTdHJpbmddICRTY3JpcHQ6Q29tcHV0ZXJQcm9kdWN0TmFtZSA9ICRMb2NhbDpFbnZJbmZvLk1vZGVsCiAgICAgICAgICAgICRMb2NhbDpPU0luZm8gPSBHZXQtV21pT2JqZWN0IC1DbGFzcyB3aW4zMl9vcGVyYXRpbmdzeXN0ZW0gfCBTZWxlY3QtT2JqZWN0IC1Qcm9wZXJ0eSBDYXB0aW9uLFZlcnNpb24KICAgICAgICAgICAgW1N0cmluZ10gJFNjcmlwdDpXaW5kb3dzRWRpdGlvbiA9ICRMb2NhbDpPU0luZm8uQ2FwdGlvbgogICAgICAgICAgICBbU3RyaW5nXSAkU2NyaXB0OldpbmRvd3NWZXJzaW9uID0gJExvY2FsOk9TSW5mby5WZXJzaW9uCiAgICAgICAgfQogICAgfQogICAgI2VuZHJlZ2lvbiBDcmVhdGUtRW52VmFyaWFibGVzCgoKICAgICNyZWdpb24gUXVlcnktUmVnaXN0cnkKICAgIEZ1bmN0aW9uIFF1ZXJ5LVJlZ2lzdHJ5IHsKICAgICAgICBQYXJhbSAoW1BhcmFtZXRlcihNYW5kYXRvcnk9JHRydWUpXSBbU3RyaW5nXSAkRGlyKQogICAgICAgICRMb2NhbDpPdXQgPSBbU3RyaW5nXTo6RW1wdHkKICAgICAgICBbU3RyaW5nXSAkTG9jYWw6S2V5ID0gJERpci5TcGxpdCgne1x9JylbLTFdCiAgICAgICAgW1N0cmluZ10gJExvY2FsOkRpciA9ICREaXIuUmVwbGFjZSgkTG9jYWw6S2V5LCcnKQogICAgICAgIAogICAgICAgICRMb2NhbDpFeGlzdHMgPSBHZXQtSXRlbVByb3BlcnR5IC1QYXRoICgnezB9JyAtZiAkRGlyKSAtTmFtZSAoJ3swfScgLWYgJExvY2FsOktleSkgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICBJZiAoJEV4aXN0cykgewogICAgICAgICAgICAkTG9jYWw6T3V0ID0gJExvY2FsOkV4aXN0cy4kTG9jYWw6S2V5CiAgICAgICAgfQogICAgICAgIHJldHVybiAkTG9jYWw6T3V0CiAgICB9CiAgICAjZW5kcmVnaW9uIFF1ZXJ5LVJlZ2lzdHJ5CgoKICAgICNyZWdpb24gUmVtb3ZlLVNjaGVkdWxlZFRhc2sKICAgIEZ1bmN0aW9uIFJlbW92ZS1TY2hlZHVsZWRUYXNrIHsKICAgICAgICBMb2dXcml0ZSAnUmVtb3ZpbmcgdGhlIFNjaGVkdWxlZCB0YXNrIGFuZCBmaWxlcy4nCiAgICAgICAgJExvY2FsOlNjaGVkdWxlZFRhc2tzID0gR2V0LVNjaGVkdWxlZFRhc2sgfCBXaGVyZS1PYmplY3QgeyRfLlRhc2tOYW1lIC1saWtlICRTY3JpcHQ6U2NoZWR1bGVkVGFza05hbWUgLW9yICRfLlRhc2tOYW1lIC1saWtlICcqVHJpZ2dlcid9CiAgICAgICAgSWYgKCRMb2NhbDpTY2hlZHVsZWRUYXNrcy5sZW5ndGggLWd0IDApIHsKICAgICAgICAgICAgJExvY2FsOlRhc2tzIHwgRm9yRWFjaC1PYmplY3QgeyAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICRudWxsID0gVW5yZWdpc3Rlci1TY2hlZHVsZWRUYXNrIC1UYXNrTmFtZSAkXy5UYXNrTmFtZSAtQ29uZmlybTokZmFsc2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnUmVtb3ZpbmcgdGhlIFNjaGVkdWxlZCB0YXNrICJ7MH0iLiBTdWNjZXNzPyB7MX0nIC1mICgkXy5UYXNrTmFtZSwkPykpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgRWxzZSB7CiAgICAgICAgICAgIElmIChHZXQtU2NoZWR1bGVkVGFzayAtVGFza05hbWUgJFNjcmlwdDpTY2hlZHVsZWRUYXNrTmFtZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkgeyAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJG51bGwgPSBVbnJlZ2lzdGVyLVNjaGVkdWxlZFRhc2sgLVRhc2tOYW1lICRTY3JpcHQ6U2NoZWR1bGVkVGFza05hbWUgLUNvbmZpcm06JGZhbHNlIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ1JlbW92aW5nIHRoZSBTY2hlZHVsZWQgdGFzayAiezB9Ii4gU3VjY2Vzcz8gezF9JyAtZiAoJFNjcmlwdDpTY2hlZHVsZWRUYXNrTmFtZSwkPykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgRWxzZSB7CiAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ1NjaGVkdWxlZCB0YXNrICJ7MH0iIGRvZXMgbm90IGV4aXN0LicgLWYgKCRTY3JpcHQ6U2NoZWR1bGVkVGFza05hbWUpKQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgI2VuZHJlZ2lvbiBSZW1vdmUtU2NoZWR1bGVkVGFzawojZW5kcmVnaW9uIEZ1bmN0aW9ucwoKCgojcmVnaW9uIFN0YXJ0CiMjIyMgU3RhcnQKIyMgIEZldGNoaW5nIHByZXZpb3VzIHJ1biByZXN1bHRzCkxvZ1dyaXRlICgnU3RhcnRpbmcgVHJpZ2dlciBCaXRMb2NrZXIgc2NyaXB0LicpCklmICgtbm90IChUZXN0LVBhdGggLVBhdGggJFNjcmlwdDpGaWxlU3RhdHMpKSB7CiAgICBbdWludDE2XSAkU2NyaXB0OkNvdW50UnVucyA9IDAKICAgIFtib29sXSAkU2NyaXB0OklzRW5jcnlwdGVkID0gW2Jvb2xdICRTY3JpcHQ6SXNQcm90ZWN0aW9uUGFzc3cgPSBbYm9vbF0gJFNjcmlwdDpJc0JhY2t1cE9EID0gW2Jvb2xdICRTY3JpcHQ6SXNCYWNrdXBBQUQgPSAkZmFsc2UKICAgIExvZ1dyaXRlICgnRmlyc3QgcnVuJykKfQpFbHNlIHsKICAgIFtTdHJpbmdbXV0gJElucHV0U3RyaW5nID0gKEdldC1Db250ZW50IC1QYXRoICRTY3JpcHQ6RmlsZVN0YXRzKS5TcGxpdChbRW52aXJvbm1lbnRdOjpOZXdMaW5lKQogICAgW3VpbnQxNl0gJFNjcmlwdDpDb3VudFJ1bnMgPSBbdWludDE2XSAkSW5wdXRTdHJpbmdbMF0KICAgIFtib29sXSAkU2NyaXB0OklzRW5jcnlwdGVkID0gW3VpbnQxNl0gJElucHV0U3RyaW5nWzFdCiAgICBbYm9vbF0gJFNjcmlwdDpJc1Byb3RlY3Rpb25QYXNzdyA9IFt1aW50MTZdICRJbnB1dFN0cmluZ1syXQogICAgW2Jvb2xdICRTY3JpcHQ6SXNCYWNrdXBPRCA9IFt1aW50MTZdICRJbnB1dFN0cmluZ1szXQogICAgW2Jvb2xdICRTY3JpcHQ6SXNCYWNrdXBBQUQgPSBbdWludDE2XSAkSW5wdXRTdHJpbmdbNF0KICAgIFdyaXRlLVN0YXRzCn0KI2VuZHJlZ2lvbiBTdGFydAoKCgojIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIEVOQ1JZUFRJT04gIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIwpMb2dXcml0ZSAoJyMjIyBCaXRMb2NrZXIgRW5jcnlwdGlvbicpCklmICgkU2NyaXB0OklzRW5jcnlwdGVkKSB7CiAgICBMb2dXcml0ZSAoJ09TIERyaXZlIGlzIGFscmVhZHkgZW5jcnlwdGVkLicpCn0KRWxzZSB7CiAgICAjIEdldCBlbmNyeXB0aW9uIHN0YXR1cwogICAgR2V0LUJpdExvY2tlclN0YXR1cwogICAgTG9nV3JpdGUgKCcjIEVuY3J5cHRpb24nKQogICAgTG9nd3JpdGUgKCdTdGF0dXMgb2YgT1MgZHJpdmUgKHswfSkgfCBWb2x1bWVTdGF0dXM6IHsxfSB8IFByb3RlY3Rpb25TdGF0dXM6IHsyfScgLWYgKCRPU0RyaXZlLCRTY3JpcHQ6Vm9sdW1lRW5jU3RhdHVzLCRTY3JpcHQ6Vm9sdW1lUHJvdGVjdGlvblN0YXR1cykpCgogICAgIyBJZiAnRnVsbHlFbmNyeXB0ZWQnCiAgICBJZiAoJFNjcmlwdDpWb2x1bWVFbmNTdGF0dXMgLWVxICRTY3JpcHQ6Qml0TG9ja2VyRW5jcnlwdGlvblN0YXR1c2VzWzJdKSB7CiAgICAgICAgTG9nV3JpdGUgKCdPUyBEcml2ZSBpcyBhbHJlYWR5IGVuY3J5cHRlZC4nKQogICAgICAgICRTY3JpcHQ6SXNFbmNyeXB0ZWQgPSAkdHJ1ZQogICAgfQoKICAgICMgSWYgJ0VuY3J5cHRpb25JblByb2dyZXNzJwogICAgRWxzZUlmICgkU2NyaXB0OlZvbHVtZUVuY1N0YXR1cyAtZXEgJFNjcmlwdDpCaXRMb2NrZXJFbmNyeXB0aW9uU3RhdHVzZXNbMV0pIHsKICAgICAgICBMb2dXcml0ZSAoJ09TIERyaXZlIGVuY3J5cHRpb24gaXMgaW4gcHJvZ3Jlc3MuJykKICAgICAgICBMb2dXcml0ZSAoJ0NhbiBjb250aW51ZSB0byBjaGVjayBpZiBUUE0gaXMgcHJlc2VudCwgYW5kIGFkZCAmIGJhY2t1cCBQcm90ZWN0aW9uIFBhc3N3b3JkJykKICAgIH0KCiAgICAjIElmIHRoZXJlIGV4aXN0cyBhIFRQTSwgZG9uJ3QgRW5hYmxlLUJpdGxvY2tlciBhZ2FpbgogICAgRWxzZUlmICgoR2V0LUJpdExvY2tlcktleVByb3RlY3RvclR5cGVzKVswXSkgewogICAgICAgIExvZ1dyaXRlICgnT1MgRHJpdmUgZW5jcnlwdGlvbiBoYXMgc3RhcnRlZCwgYnV0IGl0IGlzIG5vdCBmdWxseSBlbmNyeXB0ZWQgeWV0JykKICAgICAgICBMb2dXcml0ZSAoJ0F3YWl0aW5nIHJlc3RhcnQnKQogICAgICAgICRTY3JpcHQ6SXNFbmNyeXB0ZWQgPSAkZmFsc2UKICAgIH0KCiAgICAjIElmIHRoZXJlIGRvZXMgbm90IGV4aXN0IGEgVFBNLCBhbmQgc3RhdHVzID0gIkZ1bGx5RGVjcnlwdGVkIjogRW5hYmxlLUJpdExvY2tlciAgICAgCiAgICBFbHNlSWYgKCRWb2x1bWVFbmNTdGF0dXMgLWVxICRTY3JpcHQ6Qml0TG9ja2VyRW5jcnlwdGlvblN0YXR1c2VzWzBdKSB7CiAgICAgICAgTG9nV3JpdGUgKCdPUyBEcml2ZSBpcyBub3QgZW5jcnlwdGVkLicpCiAgICAgICAgTG9nV3JpdGUgKCdBdHRlbXB0aW5nIHRvIEVuYWJsZSBCaXRMb2NrZXIgb24gT1MgZHJpdmUgKHswfSknIC1mICgkT1NEcml2ZSkpCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgIyBFbmFibGUgQml0TG9ja2VyIHVzaW5nIFRQTQogICAgICAgICAgICAkbnVsbCA9IEVuYWJsZS1CaXRMb2NrZXIgLU1vdW50UG9pbnQgJE9TRHJpdmUgLVRwbVByb3RlY3RvciAtVXNlZFNwYWNlT25seSAtRXJyb3JBY3Rpb24gQ29udGludWUKICAgICAgICAgICAgSWYgKCQ/KSB7CiAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ1N1Y2Nlc3MgRW5hYmxpbmcgQml0TG9ja2VyPyB7MH0nIC1mICgkPykpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgRWxzZSB7CiAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ0ZhaWxlZCBFbmFibGluZyBCaXRsb2NrZXIgVHBtUHJvdGVjdG9yLCBpdGBzIHByb2JhYmx5IGFscmVhZHkgZW5hYmxlZCcpCiAgICAgICAgICAgIH0KICAgICAgICB9IAogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgTG9nRXJyb3JzCiAgICAgICAgICAgIEVuYWJsZS1CaXRMb2NrZXIgLU1vdW50UG9pbnQgJE9TRHJpdmUgLVRwbVByb3RlY3RvciAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgICAgICBMb2dXcml0ZSAoJ1dpbGwgYXR0ZW1wdCB0byBFbmFibGUgQml0TG9ja2VyIGFueXdheSBhbmQgdGhlbiBjb250aW51ZS4gU3VjY2Vzcz8gezB9JyAtZiAoJD8pKQogICAgICAgIH0KICAgIH0KCiAgICAjIElmIHNjZW5hcmlvIGZpdHMgbm9uZSBvZiB0aGUgY2FzZXMgYWJvdmUuLgogICAgRWxzZSB7CiAgICAgICAgTG9nV3JpdGUgKCdOZWl0aGVyICJ7MH0iLCAiezF9IiBvciAiezJ9IiwgcHJvYmFibHkgYXdhaXRpbmcgcmVzdGFydCcgLWYgKCRTY3JpcHQ6Qml0TG9ja2VyRW5jcnlwdGlvblN0YXR1c2VzWzBdLCRTY3JpcHQ6Qml0TG9ja2VyRW5jcnlwdGlvblN0YXR1c2VzWzFdLCRTY3JpcHQ6Qml0TG9ja2VyRW5jcnlwdGlvblN0YXR1c2VzWzJdKSkKICAgIH0KfQoKCiMgQWRkIEJpdExvY2tlciBSZWNvdmVyeSBQYXNzd29yZCBpZiBub25lIGFyZSBwcmVzZW50CkxvZ1dyaXRlICgnIyBSZWNvdmVyeVBhc3N3b3JkJykKSWYgKCRTY3JpcHQ6SXNFbmNyeXB0ZWQgLW9yICgkU2NyaXB0OlZvbHVtZUVuY1N0YXR1cyAtZXEgJFNjcmlwdDpCaXRMb2NrZXJFbmNyeXB0aW9uU3RhdHVzZXNbMV0pKSB7CiAgICBJZiAoLW5vdCgkU2NyaXB0OklzUHJvdGVjdGlvblBhc3N3KSkgewogICAgICAgIEdldC1SZWNvdmVyeVBhc3N3b3JkcwoKICAgICAgICAjIElmIHRoZXJlcyBhbHJlYWR5IGEgUHJvdGVjdGlvblBhc3N3b3JkLCB3ZSdyZSBkb25lCiAgICAgICAgSWYgKCRTY3JpcHQ6Q291bnRQcm90ZWN0aW9uS2V5cyAtZXEgMSkgewogICAgICAgICAgICBXcml0ZS1SZWNvdmVyeVBhc3N3b3JkCiAgICAgICAgICAgICRTY3JpcHQ6SXNQcm90ZWN0aW9uUGFzc3cgPSAkdHJ1ZQogICAgICAgIH0KCiAgICAgICAgIyBJZiB0aGVyZXMgMCBvciBtdWx0aXBsZSBQcm90ZWN0aW9uc1Bhc3N3b3JkKHMpCiAgICAgICAgRWxzZSB7CiAgICAgICAgICAgIFtib29sXSAkTG9jYWw6U3VjY2VzcyA9ICRmYWxzZQoKICAgICAgICAgICAgIyBJZiB0aGVyZSdzIG5vIFByb3RlY3Rpb25QYXNzd29yZCwgd2UgbmVlZCB0byBtYWtlIG9uZQogICAgICAgICAgICBJZiAoJFNjcmlwdDpDb3VudFByb3RlY3Rpb25LZXlzIC1lcSAwKSB7CiAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ05vIFJlY292ZXJ5UGFzc3dvcmRzIGZvdW5kIGZvciBPUyBEcml2ZSB7MH0sIGNyZWF0aW5nIG5ldyBvbmUuJyAtZiAkT1NEcml2ZSkKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgJG51bGwgPSBBZGQtQml0TG9ja2VyS2V5UHJvdGVjdG9yIC1Nb3VudFBvaW50ICRPU0RyaXZlIC1SZWNvdmVyeVBhc3N3b3JkUHJvdGVjdG9yIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIC1XYXJuaW5nQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgICAgICBJZiAoJD8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN1Y2Nlc3MgPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBFbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG51bGwgPSBFbmFibGUtQml0TG9ja2VyIC1Nb3VudFBvaW50ICRPU0RyaXZlIC1SZWNvdmVyeVBhc3N3b3JkUHJvdGVjdG9yIC1FcnJvckFjdGlvbiBTdG9wCiAgICAgICAgICAgICAgICAgICAgICAgIElmICgkPykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN1Y2Nlc3MgPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgTG9nRXJyb3JzCiAgICAgICAgICAgICAgICAgICAgJG51bGwgPSBBZGQtQml0TG9ja2VyS2V5UHJvdGVjdG9yIC1Nb3VudFBvaW50ICRPU0RyaXZlIC1SZWNvdmVyeVBhc3N3b3JkUHJvdGVjdG9yIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlIC1XYXJuaW5nQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgICAgICBJZiAoJD8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN1Y2Nlc3MgPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBFbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG51bGwgPSBFbmFibGUtQml0TG9ja2VyIC1Nb3VudFBvaW50ICRPU0RyaXZlIC1SZWNvdmVyeVBhc3N3b3JkUHJvdGVjdG9yIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgIElmICgkPykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN1Y2Nlc3MgPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgRmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdUcmllZCB0byBhZGQgQml0TG9ja2VyIFJlY292ZXJ5UGFzc3dvcmRQcm90ZWN0b3IuIFN1Y2Nlc3M/IHswfS4nIC1mICgkTG9jYWw6U3VjY2VzcykpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgCiAgICAgICAgICAgICMgSWYgdGhlcmUncyBtdWx0aXBsZSBleGlzdGluZyBQcm90ZWN0aW9uUGFzc3dvcmRzLCBkZWxldGUgYWxsIGJ1dCBvbmUKICAgICAgICAgICAgRWxzZSB7CiAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ1RoZXJlIGFyZSB7MH0gUmVjb3ZlcnkgUGFzc3dvcmRzIHByZXNlbnQ6JyAtZiAoJFNjcmlwdDpDb3VudFByb3RlY3Rpb25LZXlzKSkKICAgICAgICAgICAgICAgIFt1aW50MTZdICRMb2NhbDpJbnRUZW1wQ291bnRlciA9IDAKICAgICAgICAgICAgICAgICRTY3JpcHQ6QXJyYXlQcm90ZWN0aW9uUGFzc3dvcmRzIHwgRm9yRWFjaC1PYmplY3QgeyBMb2dXcml0ZSAoJ3swfSB8IEtleVByb3RlY3RvcklkICJ7MX0iIHwgUmVjb3ZlcnlQYXNzd29yZCAiezJ9IjogJyAtZiAoKCRMb2NhbDpJbnRUZW1wQ291bnRlciArPSAxKSwkXy5LZXlQcm90ZWN0b3JJZCwkXy5SZWNvdmVyeVBhc3N3b3JkKSkgfQogICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdXaWxsIHJlbW92ZSBhbGwgYnV0IHRoZSBmaXJzdCBvbmUnKQogICAgICAgICAgICAgICAgJFNjcmlwdDpBcnJheVByb3RlY3Rpb25QYXNzd29yZHMgfCBGb3JFYWNoLU9iamVjdCB7IAogICAgICAgICAgICAgICAgICAgIElmICgkXy5LZXlQcm90ZWN0b3JJZCAtbmUgJFNjcmlwdDpBcnJheVByb3RlY3Rpb25QYXNzd29yZHNbMF0uS2V5UHJvdGVjdG9ySWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJG51bGwgPSBSZW1vdmUtQml0TG9ja2VyS2V5UHJvdGVjdG9yIC1Nb3VudFBvaW50ICRPU0RyaXZlIC1LZXlQcm90ZWN0b3JJZCAkXy5LZXlQcm90ZWN0b3JJRAogICAgICAgICAgICAgICAgICAgICAgICBJZiAoJD8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnU3VjY2Vzc2Z1bGx5IHJlbW92ZWQgfCBLZXlQcm90ZWN0b3JJZCAiezB9IiB8IFJlY292ZXJ5UGFzc3dvcmQgInsxfSInIC1mICgkXy5LZXlQcm90ZWN0b3JJZCwkXy5SZWNvdmVyeVBhc3N3b3JkKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRTY3JpcHQ6Q291bnRQcm90ZWN0aW9uS2V5cyAtPSAxCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgRWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnU3VjY2Vzc2Z1bGx5IHNraXBwZWQgdGhlIGZpcnN0IGtleS4gfCBLZXlQcm90ZWN0b3JJZCAiezB9IiB8IFJlY292ZXJ5UGFzc3dvcmQgInsxfSInIC1mICgkXy5LZXlQcm90ZWN0b3JJZCwkXy5SZWNvdmVyeVBhc3N3b3JkKSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBJZiAoJFNjcmlwdDpDb3VudFByb3RlY3Rpb25LZXlzIC1lcSAxKSB7CiAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN1Y2Nlc3MgPSAkdHJ1ZQogICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgQ291bnQgYW5kIGxpc3QgZXhpc3RpbmcgUmVjb3ZlcnlQYXNzd29yZCwgb25seSB3cml0ZSBzdWNjZXNzIGlmIHRoZXJlcyBvbmUgICAgICAgIAogICAgICAgICAgICBJZiAoJExvY2FsOlN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgIExvZ1dyaXRlICdDaGVja2luZyBpZiB0aGVyZSBpcyBvbmx5IG9uZSBQcm90ZWN0aW9uIFBhc3N3b3JkLicKICAgICAgICAgICAgICAgIEdldC1SZWNvdmVyeVBhc3N3b3JkcwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBJZiAoJFNjcmlwdDpDb3VudFByb3RlY3Rpb25LZXlzIC1lcSAwKSB7CiAgICAgICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdGQUlMLCBubyBQcm90ZWN0aW9uIFBhc3N3b3JkIGZvdW5kJykKICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIEVsc2UgewogICAgICAgICAgICAgICAgICAgIElmICgkU2NyaXB0OkNvdW50UHJvdGVjdGlvbktleXMgLWVxIDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdTVUNDRVNTLCBrZXlzIGxlZnQ6IDEuJykKICAgICAgICAgICAgICAgICAgICAgICAgJFNjcmlwdDpJc1Byb3RlY3Rpb25QYXNzdyA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIEVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBMb2dXcml0ZSAnRkFJTCwga2V5cyBsZWZ0OiB7MH0uJyAtZiAoJFNjcmlwdDpBcnJheVByb3RlY3Rpb25QYXNzd29yZHMuQ291bnQpCiAgICAgICAgICAgICAgICAgICAgICAgICRTY3JpcHQ6SXNQcm90ZWN0aW9uUGFzc3cgPSAkZmFsc2UKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdTdGF0dXM6IHswfSBrZXkocykgcHJlc2VudDonIC1mICgkR2xvYmFsOkNvdW50UHJvdGVjdGlvbktleXMpKQogICAgICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnS2V5UHJvdGVjdG9ySWQgInswfSIgfCBSZWNvdmVyeVBhc3N3b3JkICJ7MX0iLicgLWYgKCRTY3JpcHQ6QXJyYXlQcm90ZWN0aW9uUGFzc3dvcmRzWzBdLktleVByb3RlY3RvcklkLCRTY3JpcHQ6QXJyYXlQcm90ZWN0aW9uUGFzc3dvcmRzWzBdLlJlY292ZXJ5UGFzc3dvcmQpKQogICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgRWxzZSB7CiAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ1NvbWV0aGluZyBmYWlsZWQnKQogICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAKICAgICAgICB9CiAgICAKICAgIH0KICAgIEVsc2UgewogICAgICAgIFdyaXRlLVJlY292ZXJ5UGFzc3dvcmQKICAgIH0KfQojIE5vdCBlbmNyeXB0ZWQgPSBObyBtYWtpbmcgb2YgUmVjb3ZlcnlQYXNzd29yZApFbHNlIHsKICAgIExvZ1dyaXRlICgnT1MgRHJpdmUgaXMgbmVpdGhlciAiRnVsbHlFbmNyeXB0ZWQiIG9yICJFbmNyeXB0aW9uSW5Qcm9ncmVzcyI6IEJpdExvY2tlciBSZWNvdmVyeVBhc3N3b3JkIGNhbiBub3QgYmUgYWRkZWQuJykKICAgIExvZ1dyaXRlICgnUmVjb3ZlcnkgUGFzc3dvcmQgcHJlc2VudD8gezB9JyAtZiAoKEdldC1CaXRMb2NrZXJLZXlQcm90ZWN0b3JUeXBlcylbMV0pKQogICAgJFNjcmlwdDpJc1Byb3RlY3Rpb25QYXNzdyA9ICRmYWxzZQp9CgoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjIyMjIyBCQUNLVVAgIyMjIyMjCiMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgQmFja3VwIEJpdExvY2tlciBLZXkgdG8gT25lRHJpdmUgYW5kIEF6dXJlQUQKTG9nV3JpdGUgKCcjIyMgQmFja3VwIFByb3RlY3Rpb24gUGFzc3dvcmQnKQojIENoZWNrIHdoYXRoZXIgT1NEcml2ZSBpcyBlbmNyeXB0ZWQgYW5kIGlmIFByb3RlY3Rpb24gUGFzc3dvcmQocykgZXhpc3QKSWYgKCgkU2NyaXB0OklzRW5jcnlwdGVkIC1vciAoJFNjcmlwdDpWb2x1bWVFbmNTdGF0dXMgLWVxICRTY3JpcHQ6Qml0TG9ja2VyRW5jcnlwdGlvblN0YXR1c2VzWzFdKSkgLWFuZCAkU2NyaXB0OklzUHJvdGVjdGlvblBhc3N3KSB7CiAgICBMb2dXcml0ZSAoJ09TIERyaXZlIGlzIGVuY3J5cHRlZCwgYW5kIHRoZXJlIGFyZSB7MH0gUHJvdGVjdGlvblBhc3N3b3JkKHMpIHByZXNlbnQuJyAtZiAoJFNjcmlwdDpDb3VudFByb3RlY3Rpb25LZXlzKSkKICAgIExvZ1dyaXRlICgnQ29udGludWluZyB3aXRoIGJhY2t1cC4nKQoKICAgIElmICgoLW5vdCgkSXNQcm90ZWN0aW9uUGFzc3cpKSAtb3IgKC1ub3QoJElzQmFja3VwQUFEKSkpIHsgICAgICAgIAogICAgICAgIElmICgtbm90ICgkU2NyaXB0OkFycmF5UHJvdGVjdGlvblBhc3N3b3JkcykpIHsKICAgICAgICAgICAgR2V0LVJlY292ZXJ5UGFzc3dvcmRzCiAgICAgICAgfQogICAgfQoKICAgICMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwogICAgIyBPbmVEcml2ZSBmb3IgQnVzaW5lc3MgYmFja3VwCiAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgIExvZ1dyaXRlICgnIyBCYWNrdXAgdG8gT25lRHJpdmUnKQogICAgSWYgKCRTY3JpcHQ6SXNCYWNrdXBPRCkgewogICAgICAgIExvZ1dyaXRlICgnQWxyZWFkeSBkb25lJykKICAgIH0KICAgIEVsc2UgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgICNXcml0aW5nIFZhbHVlIHRvIE9uZURyaXZlIGZpcnN0IAogICAgICAgICAgICAkcmVnVmFsdWVzID0gR2V0LUNoaWxkSXRlbSAnSEtDVTpcU09GVFdBUkVcTWljcm9zb2Z0XE9uZURyaXZlXEFjY291bnRzXCcKICAgICAgICAgICAgRm9yRWFjaCAoJHJlZ1ZhbHVlIGluICRyZWdWYWx1ZXMpIHsKICAgICAgICAgICAgICAgIFtTdHJpbmddICRMb2NhbDpPRDRCQWNjVHlwZSA9IFtTdHJpbmdbXV0gKCgoJHJlZ1ZhbHVlIHwgU2VsZWN0LU9iamVjdCBOYW1lKS5OYW1lKS5TcGxpdCgne1x9JylbLTFdKQogICAgICAgICAgICAgICAgSWYgKCRMb2NhbDpPRDRCQWNjVHlwZSAtbGlrZSAnQnVzaW5lc3MqJykgewogICAgICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnRm91bmQgYSBPbmVEcml2ZSBmb3IgQnVzaW5lc3MgYWNjb3VudCcpCiAgICAgICAgICAgICAgICAgICAgJExvY2FsOktleSA9ICRyZWdWYWx1ZS5uYW1lLlJlcGxhY2UoJ0hLRVlfQ1VSUkVOVF9VU0VSJywgJ0hLQ1U6JykgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIFtTdHJpbmddICRMb2NhbDpPRDRCUGF0aCA9IChHZXQtSXRlbVByb3BlcnR5IC1QYXRoICRMb2NhbDpLZXkgLU5hbWUgJ1VzZXJGb2xkZXInKS5Vc2VyRm9sZGVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgSWYgKCgtbm90KCRMb2NhbDpPRDRCUGF0aCAtbGlrZSAoJE9TRHJpdmUgKyAnXFVzZXJzXCpcT25lRHJpdmUgLSonKSkpIC1hbmQgKFRlc3QtUGF0aCAkTG9jYWw6T0Q0QlBhdGgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnRmFpbGVkIHRvIGJ1aWxkIE9uZURyaXZlIHBhdGg6ICJ7MH0iLCBvciBpdCBkb2VzIG5vdCBleGlzdC4nIC1mICRMb2NhbDpQYXRoKQogICAgICAgICAgICAgICAgICAgICAgICAkU2NyaXB0OklzQmFja3VwT0QgPSAkZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgI1tTdHJpbmddICRMb2NhbDpQYXRoID0gKCRlbnY6U3lzdGVtRHJpdmUgKyAkZW52OkhPTUVQQVRIICsgJ09uZURyaXZlIC0gJyArICdcQml0TG9ja2VyIFJlY292ZXJ5XCcgKyAkZW52OkNPTVBVVEVSTkFNRSArICdcJyApCiAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgICAgICBFbHNlIHsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBJZiAoLW5vdCgkU2NyaXB0OkNvbXB1dGVyUHJvZHVjdE5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDcmVhdGUtRW52VmFyaWFibGVzCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgW1N0cmluZ10gJExvY2FsOk9ENEJCYWNrdXBQYXRoID0gKCRMb2NhbDpPRDRCUGF0aCArICdcQml0TG9ja2VyIFJlY292ZXJ5XHswfSAoezF9IHsyfSlcJyAtZiAoJFNjcmlwdDpDb21wdXRlck5hbWUsJFNjcmlwdDpDb21wdXRlck1hbnVmYWN0dXJlciwkU2NyaXB0OkNvbXB1dGVyUHJvZHVjdE5hbWUpKQogICAgICAgICAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ09uZURyaXZlIGZvciBCdXNpbmVzcyBwYXRoOiB7MH0nIC1mICgkTG9jYWw6T0Q0QlBhdGgpKQogICAgICAgICAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ1Jlc3RvcmUgcGFzc3dvcmQgcGF0aDogezB9JyAtZiAoJExvY2FsOk9ENEJCYWNrdXBQYXRoKSkgCiAgICAgICAgICAgICAgICAgICAgICAgICNUZXN0aW5nIGlmIFJlY292ZXJ5IGZvbGRlciBleGlzdHMgaWYgbm90IGNyZWF0ZSBvbmUKICAgICAgICAgICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdUZXN0aW5nIGlmIGJhY2t1cCBmb2xkZXIgZXhpc3RzLCBjcmVhdGUgaXQgaWYgbm90LicpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKFRlc3QtUGF0aCAkTG9jYWw6T0Q0QkJhY2t1cFBhdGgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbnVsbCA9IE5ldy1JdGVtIC1JdGVtVHlwZSBEaXJlY3RvcnkgLUZvcmNlIC1QYXRoICRMb2NhbDpPRDRCQmFja3VwUGF0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSWYgKCQ/KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9nV3JpdGUgJ1N1Y2Nlc3MgY3JlYXRpbmcgT25lRHJpdmUgZm9yIEJ1c2luZXNzIGZvbGRlciBmb3IgYmFja3VwJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnRG9lcyBiYWNrdXAgZm9sZGVyIGV4aXN0PyB7MH0nIC1mIChUZXN0LVBhdGggLVBhdGggJExvY2FsOk9ENEJCYWNrdXBQYXRoKSkgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgQ3JlYXRlIHN0cmluZyBmb3IgQml0TG9ja2VyUmVjb3ZlcnlQYXNzd29yZC50eHQKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN0clJlY1Bhc3MgPSBbU3RyaW5nXTo6RW1wdHkKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN0clJlY1Bhc3MgKz0gKCdCaXRMb2NrZXIgUmVjb3ZlcnlQYXNzd29yZCBmb3IgT1MgRHJpdmUgKHswfSl7MX0nIC1mICgkZW52OlN5c3RlbURyaXZlLCJgcmBuIikpCiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbDpTdHJSZWNQYXNzICs9IEdldC1SZWNvdmVyeVBhc3N3b3Jkc1N0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWw6U3RyUmVjUGFzcyArPSAiYHJgbmByYG4iCiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbDpTdHJSZWNQYXNzICs9ICdCaXRMb2NrZXIgRHJpdmUgRW5jcnlwdGlvbiByZWNvdmVyeSBrZXl7MH0nIC1mICJgcmBuIgogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWw6U3RyUmVjUGFzcyArPSAnVG8gdmVyaWZ5IHRoYXQgdGhpcyBpcyB0aGUgY29ycmVjdCByZWNvdmVyeSBrZXksIGNvbXBhcmUgdGhlIHN0YXJ0IG9mIHRoZSBmb2xsb3dpbmd7MH0nIC1mICJgcmBuIgogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWw6U3RyUmVjUGFzcyArPSAnaWRlbnRpZmllciB3aXRoIHRoZSBpZGVudGlmaWVyIHZhbHVlIGRpc3BsYXllZCBvbiB5b3VyIFBDLicKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN0clJlY1Bhc3MgKz0gImByYG5gcmBuIgogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWw6U3RyUmVjUGFzcyArPSAoJ0lkZW50aWZpZXI6IHswfScgLWYgKCRTY3JpcHQ6QXJyYXlQcm90ZWN0aW9uUGFzc3dvcmRzWzBdLktleVByb3RlY3RvcklkKSkKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN0clJlY1Bhc3MgKz0gImByYG5gcmBuIgogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWw6U3RyUmVjUGFzcyArPSAnSWYgdGhlIGFib3ZlIGlkZW50aWZpZXIgbWF0Y2hlcyB0aGUgb25lIGRpc3BsYXllZCBieSB5b3VyIFBDLHswfScgLWYgImByYG4iCiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbDpTdHJSZWNQYXNzICs9ICd0aGVuIHVzZSB0aGUgZm9sbG93aW5nIGtleSB0byAgdW5sb2NrIHlvdXIgZHJpdmU6JwogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWw6U3RyUmVjUGFzcyArPSAiYHJgbmByYG4iCiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbDpTdHJSZWNQYXNzICs9ICgnUmVjb3ZlcnkgS2V5OiB7MH0nIC1mICgkU2NyaXB0OkFycmF5UHJvdGVjdGlvblBhc3N3b3Jkc1swXS5SZWNvdmVyeVBhc3N3b3JkKSkKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN0clJlY1Bhc3MgKz0gImByYG5gcmBuIgogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWw6U3RyUmVjUGFzcyArPSAnSWYgdGhlIGFib3ZlIGlkZW50aWZpZXIgZG9lc25gdCBtYXRjaCB0aGUgb25lIGRpc3BsYXllZCBieSB5b3VyIFBDLHswfScgLWYgImByYG4iCiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbDpTdHJSZWNQYXNzICs9ICd0aGVuIHRoaXMgaXNuYHQgdGhlIHJpZ2h0IGtleSB0byB1bmxvY2sgeW91ciBkcml2ZS57MH0nIC1mICJgcmBuIgogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWw6U3RyUmVjUGFzcyArPSAnVHJ5IGFub3RoZXIgcmVjb3Zlcnkga2V5LCBvciByZWZlciB0b3swfScgLWYgImByYG4iIAogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWw6U3RyUmVjUGFzcyArPSAnaHR0cHM6Ly9nby5taWNyb3NvZnQuY29tL2Z3bGluay8/TGlua0lEPTI2MDU4OSBmb3IgYWRkaXRpb25hbCBhc3Npc3RhbmNlLicKCiAgICAgICAgICAgICAgICAgICAgICAgICMgT3V0LUZpbGUgdGhlIHN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBbU3RyaW5nXSAkTG9jYWw6Q3VyRGF0ZSA9IChHZXQtRGF0ZSAtVWZvcm1hdCAnJXklbSVkJUglTSVTJykKICAgICAgICAgICAgICAgICAgICAgICAgW1N0cmluZ10gJExvY2FsOk9ENEJCYWNrdXBGaWxlUGF0aCA9ICgkTG9jYWw6T0Q0QkJhY2t1cFBhdGggKyAnQml0bG9ja2VyUmVjb3ZlcnlQYXNzd29yZCB7MH0udHh0JyAtZiAoJExvY2FsOkN1ckRhdGUpKQogICAgICAgICAgICAgICAgICAgICAgICBPdXQtRmlsZSAtRmlsZVBhdGggJExvY2FsOk9ENEJCYWNrdXBGaWxlUGF0aCAtRW5jb2RpbmcgdXRmOCAtRm9yY2UgLUlucHV0T2JqZWN0ICgkTG9jYWw6U3RyUmVjUGFzcykKICAgICAgICAgICAgICAgICAgICAgICAgSWYgKCQ/KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkU2NyaXB0OklzQmFja3VwT0QgPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIENhdGNoIHsKICAgICAgICAgICAgTG9nV3JpdGUgKCdFcnJvciB3aGlsZSBiYWNrdXAgdG8gT25lRHJpdmUsIG1ha2Ugc3VyZSB0aGF0IHlvdSBhcmUgQUFEIGpvaW5lZCBhbmQgYXJlIHJ1bm5pbmcgdGhlIGNtZGxldCBhcyBhbiBhZG1pbi4nKQogICAgICAgICAgICBMb2dXcml0ZSAoJ0Vycm9yIG1lc3NhZ2U6JyArICJgcmBuIiArICgkXykpCiAgICAgICAgfQogICAgICAgIEZpbmFsbHkgewogICAgICAgICAgICBMb2dXcml0ZSAoJ0RpZCBiYWNrdXAgdG8gT25lRHJpdmUgc3VjY2VlZD8gezB9JyAtZiAoJFNjcmlwdDpJc0JhY2t1cE9EKSkKICAgICAgICB9CiAgICB9CiAgICAKICAgICMjIyMjIyMjIyMjIyMjIyMjCiAgICAjIEF6dXJlIEFEIEJhY2t1cAogICAgIyMjIyMjIyMjIyMjIyMjIyMKICAgIExvZ1dyaXRlICgnIyBCYWNrdXAgdG8gQXp1cmUgQUQnKQogICAgSWYgKCRTY3JpcHQ6SXNCYWNrdXBBQUQpIHsKICAgICAgICBMb2dXcml0ZSAoJ0FscmVhZHkgZG9uZScpCiAgICB9CiAgICBFbHNlIHsgICAgICAgICAgIAogICAgICAgICNDaGVjayBpZiB3ZSBjYW4gdXNlIEJhY2t1cFRvQUFELUJpdExvY2tlcktleVByb3RlY3RvciBjb21tYW5kbGV0CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgTG9nV3JpdGUgJ0NoZWNrIGlmIHdlIGNhbiB1c2UgQmFja3VwVG9BQUQtQml0TG9ja2VyS2V5UHJvdGVjdG9yIGNvbW1hbmRsZXQuLi4nCiAgICAgICAgICAgICRjbWROYW1lID0gJ0JhY2t1cFRvQUFELUJpdExvY2tlcktleVByb3RlY3RvcicKICAgICAgICAgICAgaWYgKEdldC1Db21tYW5kICRjbWROYW1lIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSB7CiAgICAgICAgICAgICAgICAjQmFja3VwVG9BQUQtQml0TG9ja2VyS2V5UHJvdGVjdG9yIGNvbW1hbmRsZXQgZXhpc3RzCiAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ3swfSBjb21tYW5kbGV0IGV4aXN0cyEnIC1mICRjbWROYW1lKSAKICAgICAgICAgICAgICAgICRudWxsID0gQmFja3VwVG9BQUQtQml0TG9ja2VyS2V5UHJvdGVjdG9yIC1Nb3VudFBvaW50ICRPU0RyaXZlIC1LZXlQcm90ZWN0b3JJZCAkU2NyaXB0OkFycmF5UHJvdGVjdGlvblBhc3N3b3Jkc1swXS5LZXlQcm90ZWN0b3JJZCAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgSWYgKCQ/KSB7CiAgICAgICAgICAgICAgICAgICAgJFNjcmlwdDpJc0JhY2t1cEFBRCA9ICR0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBFbHNlIHsKICAgICAgICAgICAgICAgICAgICAkTG9jYWw6QkxWID0gR2V0LUJpdExvY2tlclZvbHVtZSAtTW91bnRQb2ludCAkT1NEcml2ZQogICAgICAgICAgICAgICAgICAgICRudWxsID0gQmFja3VwVG9BQUQtQml0TG9ja2VyS2V5UHJvdGVjdG9yIC1Nb3VudFBvaW50ICRPU0RyaXZlIC1LZXlQcm90ZWN0b3JJZCAkTG9jYWw6QkxWLktleVByb3RlY3RvclswXS5LZXlQcm90ZWN0b3JJZCAtRXJyb3JBY3Rpb24gU3RvcAogICAgICAgICAgICAgICAgICAgIElmICgkPykgewogICAgICAgICAgICAgICAgICAgICAgICAkU2NyaXB0OklzQmFja3VwQUFEID0gJHRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ1N1Y2Nlc3M/IHswfScgLWYgKCRTY3JpcHQ6SXNCYWNrdXBBQUQpKQogICAgICAgICAgICB9IAogICAgICAgICAgICBlbHNlIHsgCiAgICAgICAgICAgICAgICAjIEJhY2t1cFRvQUFELUJpdExvY2tlcktleVByb3RlY3RvciBjb21tYW5kbGV0IG5vdCBhdmFpbGFibGUsIHVzaW5nIG90aGVyIG1lY2hhbmlzbSAKICAgICAgICAgICAgICAgIExvZ1dyaXRlICdCYWNrdXBUb0FBRC1CaXRMb2NrZXJLZXlQcm90ZWN0b3IgY29tbWFuZGxldCBub3QgYXZhaWxhYmxlLCB1c2luZyBvdGhlciBtZWNoYW5pc20uJyAKICAgICAgICAgICAgICAgICMgR2V0IHRoZSBBQUQgTWFjaGluZSBDZXJ0aWZpY2F0ZQogICAgICAgICAgICAgICAgJGNlcnQgPSBHZXQtQ2hpbGRJdGVtIENlcnQ6XExvY2FsTWFjaGluZVxNeVwgfCBXaGVyZS1PYmplY3QgeyAkXy5Jc3N1ZXIgLW1hdGNoICdDTj1NUy1Pcmdhbml6YXRpb24tQWNjZXNzJyB9CgogICAgICAgICAgICAgICAgIyBPYnRhaW4gdGhlIEFBRCBEZXZpY2UgSUQgZnJvbSB0aGUgY2VydGlmaWNhdGUKICAgICAgICAgICAgICAgICRpZCA9ICRjZXJ0LlN1YmplY3QuUmVwbGFjZSgnQ049JywnJykKCiAgICAgICAgICAgICAgICAjIEdldCB0aGUgdGVuYW50IG5hbWUgZnJvbSB0aGUgcmVnaXN0cnkKICAgICAgICAgICAgICAgICR0ZW5hbnQgPSAoR2V0LUl0ZW1Qcm9wZXJ0eSBIS0xNOlxTWVNURU1cQ3VycmVudENvbnRyb2xTZXRcQ29udHJvbFxDbG91ZERvbWFpbkpvaW5cSm9pbkluZm9cJCgkaWQpKS5Vc2VyRW1haWwuU3BsaXQoJ0AnKVsxXQogICAgICAgICAgICAgICAgTG9nV3JpdGUgJHRlbmFudAogICAgICAgICAgICAgICAgIyBHZW5lcmF0ZSB0aGUgYm9keSB0byBzZW5kIHRvIEFBRCBjb250YWluaW5nIHRoZSByZWNvdmVyeSBpbmZvcm1hdGlvbgogICAgICAgICAgICAgICAgIyBHZXQgdGhlIEJpdExvY2tlciBrZXkgaW5mb3JtYXRpb24gZnJvbSBXTUkKICAgICAgICAgICAgICAgIChHZXQtQml0TG9ja2VyVm9sdW1lIC1Nb3VudFBvaW50ICRPU0RyaXZlKS5LZXlQcm90ZWN0b3J8PyB7JF8uS2V5UHJvdGVjdG9yVHlwZSAtZXEgJ1JlY292ZXJ5UGFzc3dvcmQnfXwgJSB7CiAgICAgICAgICAgICAgICAgICAgJGtleSA9ICRfCiAgICAgICAgICAgICAgICAgICAgd3JpdGUtdmVyYm9zZSAia2lkIDogJCgka2V5LktleVByb3RlY3RvcklkKSBrZXk6ICQoJGtleS5SZWNvdmVyeVBhc3N3b3JkKSIKICAgICAgICAgICAgICAgICAgICAkYm9keSA9ICJ7IiJrZXkiIjoiIiQoJGtleS5SZWNvdmVyeVBhc3N3b3JkKSIiLCIia2lkIiI6IiIkKCRrZXkuS2V5UHJvdGVjdG9ySWQucmVwbGFjZSgneycsJycpLlJlcGxhY2UoJ30nLCcnKSkiIiwiInZvbCIiOiIiT1NWIiJ9IgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgQ3JlYXRlIHRoZSBVUkwgdG8gcG9zdCB0aGUgZGF0YSB0byBiYXNlZCBvbiB0aGUgdGVuYW50IGFuZCBkZXZpY2UgaW5mb3JtYXRpb24KICAgICAgICAgICAgICAgICAgICAkdXJsID0gImh0dHBzOi8vZW50ZXJwcmlzZXJlZ2lzdHJhdGlvbi53aW5kb3dzLm5ldC9tYW5hZ2UvJHRlbmFudC9kZXZpY2UvJCgkaWQpP2FwaS12ZXJzaW9uPTEuMCIKICAgICAgICAgICAgICAgICAgICBMb2dzdHJpbmcgIkNyZWF0aW5nIHVybC4uLiR1cmwiCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBQb3N0IHRoZSBkYXRhIHRvIHRoZSBVUkwgYW5kIHNpZ24gaXQgd2l0aCB0aGUgQUFEIE1hY2hpbmUgQ2VydGlmaWNhdGUKICAgICAgICAgICAgICAgICAgICAkcmVxID0gSW52b2tlLVdlYlJlcXVlc3QgLVVyaSAkdXJsIC1Cb2R5ICRib2R5IC1Vc2VCYXNpY1BhcnNpbmcgLU1ldGhvZCBQb3N0IC1Vc2VEZWZhdWx0Q3JlZGVudGlhbHMgLUNlcnRpZmljYXRlICRjZXJ0CiAgICAgICAgICAgICAgICAgICAgJHJlcS5SYXdDb250ZW50CiAgICAgICAgICAgICAgICAgICAgSWYgKCQ/KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRTY3JpcHQ6SXNCYWNrdXBBQUQgPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0gICAgCiAgICAgICAgICAgICAgICAgICAgTG9nU3RyaW5nICgnUG9zdCB0aGUgZGF0YSB0byB0aGUgVVJMIGFuZCBzaWduIGl0IHdpdGggdGhlIEFBRCBNYWNoaW5lIENlcnRpZmljYXRlLiBTdWNjZXNzPyB7MH0nIC1mICgkU2NyaXB0OklzQmFja3VwQUFEKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAKICAgICAgICB9CiAgICAgICAgY2F0Y2ggewogICAgICAgICAgICBMb2dXcml0ZSAoJ0Vycm9yIHdoaWxlIGJhY2t1cCB0byBBenVyZSBBRCwgbWFrZSBzdXJlIHRoYXQgeW91IGFyZSBBQUQgam9pbmVkIGFuZCBhcmUgcnVubmluZyB0aGUgY21kbGV0IGFzIGFuIGFkbWluLicpCiAgICAgICAgICAgIExvZ1dyaXRlICgnRXJyb3IgbWVzc2FnZTonICsgImByYG4iICsgKCRfKSkKICAgICAgICAgICAgJElzQmFja3VwQUFEID0gJGZhbHNlCiAgICAgICAgfQogICAgICAgIEZpbmFsbHkgewogICAgICAgICAgICBMb2dXcml0ZSAoJ0RpZCBiYWNrdXAgdG8gQXp1cmUgQUQgU3VjY2VlZD8gezB9JyAtZiAoJFNjcmlwdDpJc0JhY2t1cEFBRCkpCiAgICAgICAgfQogICAgfQoKfSAKZWxzZSB7CiAgICBMb2dXcml0ZSAoJ0RyaXZlIGlzIG5vdCBlbmNyeXB0ZWQgYW5kL29yIG5vIFByb3RlY3Rpb24gUGFzc3dvcmQocykgcHJlc2VudC4nKQogICAgTG9nV3JpdGUgKCdXaWxsIHNraXAgYmFja3VwLCBmb3Igbm93LicpCn0KCgojIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIyMgIEcgVSBJICMjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIwojcmVnaW9uIEdVSQpJZiAoJFNjcmlwdDpJc0VuY3J5cHRlZCAtYW5kICRTY3JpcHQ6SXNQcm90ZWN0aW9uUGFzc3cgLWFuZCAkR1VJKSB7CiAgICAjIFNob3cgcmVib290IHByb21wdCB0byB1c2VyCiAgICBMb2dXcml0ZSAiUHJvbXB0aW5nIHVzZXIgdG8gUmVib290IGNvbXB1dGVyLiIKICAgICAgICAgICAKCiAgICBbdm9pZF1bU3lzdGVtLlJlZmxlY3Rpb24uQXNzZW1ibHldOjpMb2FkV2l0aFBhcnRpYWxOYW1lKCDigJxTeXN0ZW0uV2luZG93cy5Gb3Jtc+KAnSkKICAgIFt2b2lkXVtTeXN0ZW0uUmVmbGVjdGlvbi5Bc3NlbWJseV06OkxvYWRXaXRoUGFydGlhbE5hbWUoIOKAnE1pY3Jvc29mdC5WaXN1YWxCYXNpY+KAnSkKCiAgICAkZm9ybSA9IE5ldy1PYmplY3Qg4oCcU3lzdGVtLldpbmRvd3MuRm9ybXMuRm9ybeKAnTsKICAgICRmb3JtLldpZHRoID0gNTAwOwogICAgJGZvcm0uSGVpZ2h0ID0gMTUwOwogICAgJGZvcm0uVGV4dCA9ICJCaXRMb2NrZXIgcmVxdWlyZXMgYSByZWJvb3QgISI7CiAgICAkZm9ybS5TdGFydFBvc2l0aW9uID0gW1N5c3RlbS5XaW5kb3dzLkZvcm1zLkZvcm1TdGFydFBvc2l0aW9uXTo6Q2VudGVyU2NyZWVuOwoKICAgICREcm9wRG93bkFycmF5ID0gQCgiNDpIb3VycyIsICI4OkhvdXJzIiwgIjEyOkhvdXJzIiwgIjI0OkhvdXJzIikKICAgICREREwgPSBOZXctT2JqZWN0IFN5c3RlbS5XaW5kb3dzLkZvcm1zLkNvbWJvQm94CiAgICAkRERMLkxvY2F0aW9uID0gTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5TaXplKDE0MCwgMTApCiAgICAkRERMLlNpemUgPSBOZXctT2JqZWN0IFN5c3RlbS5EcmF3aW5nLlNpemUoMTMwLCAzMCkKICAgIEZvckVhY2ggKCRJdGVtIGluICREcm9wRG93bkFycmF5KSB7CiAgICAgICAgJERETC5JdGVtcy5BZGQoJEl0ZW0pIHwgT3V0LU51bGwKICAgIH0KICAgICREREwuU2VsZWN0ZWRJbmRleCA9IDAKCiAgICAkYnV0dG9uMSA9IE5ldy1PYmplY3Qg4oCcU3lzdGVtLldpbmRvd3MuRm9ybXMuYnV0dG9u4oCdOwogICAgJGJ1dHRvbjEuTGVmdCA9IDQwOwogICAgJGJ1dHRvbjEuVG9wID0gODU7CiAgICAkYnV0dG9uMS5XaWR0aCA9IDEwMDsKICAgICRidXR0b24xLlRleHQgPSDigJxSZWJvb3QgTm934oCdOwogICAgJGJ1dHRvbjEuQWRkX0NsaWNrKCB7JGdsb2JhbDp4aW5wdXQgPSAiUmVib290IjsgJEZvcm0uQ2xvc2UoKX0pCgogICAgJGJ1dHRvbjIgPSBOZXctT2JqZWN0IOKAnFN5c3RlbS5XaW5kb3dzLkZvcm1zLmJ1dHRvbuKAnTsKICAgICRidXR0b24yLkxlZnQgPSAxNzA7CiAgICAkYnV0dG9uMi5Ub3AgPSA4NTsKICAgICRidXR0b24yLldpZHRoID0gMTAwOwogICAgJGJ1dHRvbjIuVGV4dCA9IOKAnFBvc3Rwb25l4oCdOwogICAgJGJ1dHRvbjIuQWRkX0NsaWNrKCB7JGdsb2JhbDp4aW5wdXQgPSAiUG9zdHBvbmU6IiArICREREwuVGV4dDsgJEZvcm0uQ2xvc2UoKX0pCgogICAgJGJ1dHRvbjMgPSBOZXctT2JqZWN0IOKAnFN5c3RlbS5XaW5kb3dzLkZvcm1zLmJ1dHRvbuKAnTsKICAgICRidXR0b24zLkxlZnQgPSAyOTA7CiAgICAkYnV0dG9uMy5Ub3AgPSA4NTsKICAgICRidXR0b24zLldpZHRoID0gMTAwOwogICAgJGJ1dHRvbjMuVGV4dCA9IOKAnENhbmNlbOKAnTsKICAgICRidXR0b24zLkFkZF9DbGljayggeyRnbG9iYWw6eGlucHV0ID0gIlBvc3Rwb25lMjQiOyAkRm9ybS5DbG9zZSgpfSkKCgogICAgJGZvcm0uS2V5UHJldmlldyA9ICRUcnVlCiAgICAkZm9ybS5BZGRfS2V5RG93bigge2lmICgkXy5LZXlDb2RlIC1lcSAiRW50ZXIiKSAKICAgICAgICAgICAgeyR4ID0gJHRleHRCb3gxLlRleHQ7ICRmb3JtLkNsb3NlKCl9fSkKICAgICRmb3JtLkFkZF9LZXlEb3duKCB7aWYgKCRfLktleUNvZGUgLWVxICJFc2NhcGUiKSAKICAgICAgICAgICAgeyRmb3JtLkNsb3NlKCl9fSkKCiAgICAkZXZlbnRIYW5kbGVyID0gW1N5c3RlbS5FdmVudEhhbmRsZXJdIHsgCiAgICAgICAgJGJ1dHRvbjEuQ2xpY2s7CiAgICAgICAgJERyb3BEb3duQXJyYXkuVGV4dDsKICAgICAgICAkZm9ybS5DbG9zZSgpOyB9OwoKICAgICMkYnV0dG9uLkFkZF9DbGljaygkZXZlbnRIYW5kbGVyKSA7CiAgICAkZm9ybS5Db250cm9scy5BZGQoJGJ1dHRvbjEpOwogICAgJGZvcm0uQ29udHJvbHMuQWRkKCRidXR0b24yKTsKICAgICRmb3JtLkNvbnRyb2xzLkFkZCgkYnV0dG9uMyk7CiAgICAkZm9ybS5Db250cm9scy5BZGQoJERETCk7CiAgICAkZm9ybS5Db250cm9scy5BZGQoJHRleHRMYWJlbDEpCiAgICAkcmV0ID0gJGZvcm0uU2hvd0RpYWxvZygpOwoKICAgIGlmICgkZ2xvYmFsOnhpbnB1dCAtZXEgIlJlYm9vdCIpIHtzaHV0ZG93biAtciAtZiAvdCA2MDB9CiAgICBpZiAoJGdsb2JhbDp4aW5wdXQgLWxpa2UgIlBvc3Rwb25lOio6SG91cnMiKSB7CiAgICAgICAgJGh2YWwgPSAoKFtpbnRdJGdsb2JhbDp4aW5wdXQuc3BsaXQoIjoiKVsxXSkgKiA2MCAqIDYwKQogICAgICAgIHNodXRkb3duIC1yIC1mIC90ICRodmFsCiAgICB9CiAgICBpZiAoJGdsb2JhbDp4aW5wdXQgLWVxICJQb3N0cG9uZTI0Iikge3NodXRkb3duIC1yIC1mIC90IDg2NDAwfQp9CiNlbmRyZWdpb24gR1VJCgoKCgojIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIFMgVCBBIFQgUyAjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIwpMb2dXcml0ZSAoJyMjIyBTVEFUUycpCiRTY3JpcHQ6Q291bnRSdW5zICs9IDEKCklmICgtbm90KCRTY3JpcHQ6Qm9vbFJlbW92ZUZpbGVzQWZ0ZXJTdWNjZXNzKSkgewogICAgSWYgKC1ub3QoVGVzdC1QYXRoICRTY3JpcHQ6RGlySW5zdGFsbCkpIHsKICAgICAgICAkbnVsbCA9IE5ldy1JdGVtIC1QYXRoICRTY3JpcHQ6RGlySW5zdGFsbCAtSXRlbVR5cGUgRGlyZWN0b3J5IC1Gb3JjZQogICAgfQogICAgCiAgICBbU3RyaW5nXSAkT3V0U3RyaW5nID0gKCgkU2NyaXB0OkNvdW50UnVucykuVG9TdHJpbmcoKSArICJgcmBuIikKICAgICRPdXRTdHJpbmcgKz0gKChbdWludDE2XSAkU2NyaXB0OklzRW5jcnlwdGVkKS5Ub1N0cmluZygpICsgImByYG4iKQogICAgJE91dFN0cmluZyArPSAoKFt1aW50MTZdICRTY3JpcHQ6SXNQcm90ZWN0aW9uUGFzc3cpLlRvU3RyaW5nKCkgKyAiYHJgbiIpCiAgICAkT3V0U3RyaW5nICs9ICgoW3VpbnQxNl0gJFNjcmlwdDpJc0JhY2t1cE9EKS5Ub1N0cmluZygpICsgImByYG4iKQogICAgJE91dFN0cmluZyArPSAoKFt1aW50MTZdICRTY3JpcHQ6SXNCYWNrdXBBQUQpLlRvU3RyaW5nKCkgKyAiYHJgbiIpCiAgICAKICAgIE91dC1GaWxlIC1GaWxlUGF0aCAkU2NyaXB0OkZpbGVTdGF0cyAtRW5jb2RpbmcgdXRmOCAtRm9yY2UgLUlucHV0T2JqZWN0ICgkT3V0U3RyaW5nKQp9CkxvZ1dyaXRlICgnUnVucyBzbyBmYXI6IHswfScgLWYgKCRTY3JpcHQ6Q291bnRSdW5zKSkKCklmICgkU2NyaXB0OkNvdW50UnVucyAtZXEgMzApIHsKICAgIExvZ1dyaXRlICgnU2hvdWxkIGhhdmUgYmVlbiBkb25lIGJ5IG5vdy4nKQogICAgUmVtb3ZlLVNjaGVkdWxlZFRhc2sKCiAgICBJZiAoJGZhbHNlKSB7CiAgICAgICAgIyMjIEdhdGhlcmluZyBpbmZvIGZvciB0aGUgZW1haWwKICAgICAgICBJZiAoLW5vdCgkU2NyaXB0OldpbmRvd3NWZXJzaW9uKSkgewogICAgICAgICAgICBDcmVhdGUtRW52VmFyaWFibGVzCiAgICAgICAgfQogICAgICAgICMjIyBCdWlsZGluZyBlbWFpbCBzdHJpbmcKICAgICAgICBbU3RyaW5nXSAkTG9jYWw6U3RyU3ViamVjdCA9ICgnQml0TG9ja2VyVHJpZ2dlciBmYWlsZWQgezB9IHRpbWVzIGZvciB0ZW5hbnQgInsxfSIsIGRldmljZTogInsyfSInIC1mICgkQ291bnRSdW5zLlRvU3RyaW5nKCksJExvY2FsOk5hbWVUZW5hbnQsJExvY2FsOk5hbWVDb21wdXRlcikpCiAgICAgICAgW1N0cmluZ10gJExvY2FsOlN0ckVtYWlsID0gW1N0cmluZ106OkVtcHR5CiAgICAgICAgJExvY2FsOlN0ckVtYWlsICs9ICgkTG9jYWw6U3RyU3ViamVjdCkKICAgICAgICAkTG9jYWw6U3RyRW1haWwgKz0gKCJgcmBuIikKICAgICAgICAkTG9jYWw6U3RyRW1haWwgKz0gKCJgcmBuIiArICcjIyBFbnZpcm9ubWVudCBpbmZvJykKICAgICAgICAkTG9jYWw6U3RyRW1haWwgKz0gKCJgcmBuIiArICdEZXZpY2UgbmFtZTogJyArICRTY3JpcHQ6Q29tcHV0ZXJOYW1lICsgJyB8IE1hbnVmYWN0dXJlcjogJyArICRTY3JpcHQ6Q29tcHV0ZXJNYW51ZmFjdHVyZXIgKyAnIHwgTW9kZWw6ICcgKyAkU2NyaXB0OkNvbXB1dGVyUHJvZHVjdE5hbWUpIAogICAgICAgICRMb2NhbDpTdHJFbWFpbCArPSAoImByYG4iICsgJ1dpbmRvd3MgRWRpdGlvbjogJyArICRTY3JpcHQ6V2luZG93c0VkaXRpb24gKyAnIHwgV2luZG93cyBWZXJzaW9uJyArICRTY3JpcHQ6V2luZG93c1ZlcnNpb24pCiAgICAgICAgJExvY2FsOlN0ckVtYWlsICs9ICgiYHJgbmByYG4iICsgJ1RoZXJlIGhhdmUgbm93IGJlZW4gezB9IHJ1bnMsIGJ1dCBCaXRMb2NrZXJUcmlnZ2VyIFNUSUxMIGZhaWxzLicgLWYgKCRTY3JpcHQ6Q291bnRSdW5zKSkKICAgICAgICAkTG9jYWw6U3RyRW1haWwgKz0gKCJgcmBuIiArICdTdWNjZXNzIHN0YXR1cyB8IEVuY3J5cHRlZCA6IHswfSB8IFByb3RlY3Rpb24gUGFzc3dvcmRzIHByZXNlbnQgOiB7MX0gfCBCYWNrdXAgdG8gQXp1cmVBRCA6IHsyfSB8IEJhY2t1cCB0byBPbmVEcml2ZSA6IHszfScgLWYgKCRTY3JpcHQ6SXNFbmNyeXB0ZWQsJFNjcmlwdDpJc1Byb3RlY3Rpb25QYXNzdywkU2NyaXB0OklzQmFja3VwQUFELCRTY3JpcHQ6SXNCYWNrdXBPRCkpCiAgICAgICAgTG9nV3JpdGUgKCRMb2NhbDpTdHJFbWFpbCkKICAgICAgICA8IyMjIFNlbmQgZW1haWwKICAgICAgICAjIyBNYWlsIGFkZHJlc3MoZXMpCiAgICAgICAgW1N0cmluZ10gJExvY2FsOlN0clRvRW1haWxBZGRyZXNzID0gJ09sYXYgUi4gQmlya2VsYW5kIDxvbGF2YkBpcm9uc3RvZWl0LmNvbT47JwogICAgICAgICMkU3RyRW1haWxBZGRyZXNzICs9ICdJcm9uc3RvbmUgU2VydmljZWRlc2sgPHNlcnZpY2VkZWtzQGlyb25zdG9uZWl0LmNvbT4nCiAgICAgICAgW1N0cmluZ10gJExvY2FsOlN0ckZyb21FbWFpbEFkZHJlc3MgPSAoJ0JpdExvY2tlclRyaWdnZXJGYWlsQHswfScgLWYgKCRTY3JpcHQ6TmFtZVRlbmFudCkpCiAgICAgICAgI1NlbmQtTWFpbE1lc3NhZ2UgLVRvICRMb2NhbDpTdHJUb0VtYWlsQWRkcmVzcyAtU210cFNlcnZlciAgLUZyb20gJExvY2FsOlN0ckZyb21FbWFpbEFkZHJlc3MgLVN1YmplY3QgJExvY2FsOlN0clN1YmplY3QgLUJvZHkgJExvY2FsOlN0ckVtYWlsCiAgICAgICAgIz4KICAgIH0KfQoKCgojIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIEVORCBSRVNVTFQgIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIwpMb2dXcml0ZSAoJyMjIyBFbmQgcmVzdWx0cycpCldyaXRlLVN0YXRzCiMgQ2xlYW5pbmcgdXAgaWYgc3VjY2VzcwpJZiAoJFNjcmlwdDpJc0VuY3J5cHRlZCAtYW5kICRTY3JpcHQ6SXNQcm90ZWN0aW9uUGFzc3cgLWFuZCAkU2NyaXB0OklzQmFja3VwQUFEIC1hbmQgJFNjcmlwdDpJc0JhY2t1cE9EKSB7CiAgICBHZXQtQml0TG9ja2VyU3RhdHVzCiAgICBHZXQtUmVjb3ZlcnlQYXNzd29yZHMKICAgIElmICgoJFNjcmlwdDpWb2x1bWVFbmNTdGF0dXMgLWVxICdGdWxseUVuY3J5cHRlZCcpIC1hbmQgKCRTY3JpcHQ6QXJyYXlQcm90ZWN0aW9uUGFzc3dvcmRzLkNvdW50IC1nZSAxKSkgewogICAgICAgIAogICAgICAgICMgU2NoZWR1bGVkVGFzawogICAgICAgIFJlbW92ZS1TY2hlZHVsZWRUYXNrCiAgICAgICAgCgogICAgICAgICMgRmlsZXMKICAgICAgICBJZiAoLW5vdCgkU2NyaXB0OkJvb2xSZW1vdmVGaWxlc0FmdGVyU3VjY2VzcykpIHsKICAgICAgICAgICAgW1N0cmluZ10gJExvY2FsOkxvZ0Rlc3RQYXRoID0gKCd7MH17MX0nIC1mICgkU2NyaXB0OkRpckluc3RhbGwsJFNjcmlwdDpGaWxlTG9nLlNwbGl0KCd7XH0nKVstMV0pKQogICAgICAgICAgICBDb3B5LUl0ZW0gLVBhdGggJFNjcmlwdDpGaWxlTG9nIC1EZXN0aW5hdGlvbiAkTG9jYWw6TG9nRGVzdFBhdGggLUZvcmNlCiAgICAgICAgfQogICAgICAgIEVsc2UgewogICAgICAgICAgICAkbnVsbCA9IFN0YXJ0LUpvYiAtQXJndW1lbnRMaXN0ICRTY3JpcHQ6RmlsZUxvZyAtU2NyaXB0QmxvY2sgewogICAgICAgICAgICAgICAgUGFyYW0oCiAgICAgICAgICAgICAgICAgICAgW3N0cmluZ10gJEZpbGVMb2cKICAgICAgICAgICAgICAgICkKICAgICAgICAKICAgICAgICAgICAgICAgIEZ1bmN0aW9uIExvZ1dyaXRlIHsKICAgICAgICAgICAgICAgICAgICBQYXJhbSAoW3N0cmluZ10kTG9nU3RyaW5nKQogICAgICAgICAgICAgICAgICAgIFtzdHJpbmddICRhID0gR2V0LURhdGUKICAgICAgICAgICAgICAgICAgICBbc3RyaW5nXSAkTG9nU3RyaW5nID0gJGEsICRMb2dTdHJpbmcKICAgICAgICAgICAgICAgICAgICBBZGQtY29udGVudCAtUGF0aCAkRmlsZUxvZyAtVmFsdWUgJExvZ1N0cmluZwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgW1N0cmluZ10gJExvY2FsOlJlbURpclBhdGggPSAoJHtlbnY6UHJvZ3JhbUZpbGVzKHg4Nil9ICsgJ1xCaXRMb2NrZXJUcmlnZ2VyXCcpCiAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzIDUKICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnU3RhcnRlZCB0aGUgam9iIHRvIHJlbW92ZSAiezB9IicgLWYgKCRMb2NhbDpSZW1EaXJQYXRoKSkKICAgICAgICAgICAgICAgIElmIChUZXN0LVBhdGggJExvY2FsOlJlbURpclBhdGgpIHsKICAgICAgICAgICAgICAgICAgICBSZW1vdmUtSXRlbSAtUGF0aCAkTG9jYWw6UmVtRGlyUGF0aCAtUmVjdXJzZSAtRm9yY2UKICAgICAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ1JlbW92aW5nIHRoZSBmb2xkZXIgKHJlY3Vyc2UsIGZvcmNlKS4gU3VjY2Vzcz8gezB9JyAtZiAoJD8pKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgRWxzZSB7CiAgICAgICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdGb2xkZXIgZG9lcyBub3QgZXhpc3QnKQogICAgICAgICAgICAgICAgfSAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSAgICAKfQpFbHNlIHsKICAgIExvZ1dyaXRlICdUaGVyZSBhcmUgc3RpbGwgdGhpbmdzIHRvIGRvLiBUcnlpbmcgYWdhaW4gaW4gMTUgbWludXRlcy4nCn0KCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMjIyAgRCBPIE4gRSAgIyMjIyMKIyMjIyMjIyMjIyMjIyMjIyMjIyMKTG9nV3JpdGUgKCdBbGwgZG9uZSwgZXhpdGluZyBzY3JpcHQuLi4nKQ==')
#endregion FilePS1

# Enable-BitLockerTrigger.VBS
#region FileVBS
[String] $Script:NameVBS = 'Enable_BitLocker.vbs'
[String] $Script:FileVBS = ('U2V0IG9ialNoZWxsID0gQ3JlYXRlT2JqZWN0KCJXc2NyaXB0LlNoZWxsIikgIA0KU2V0IGFyZ3MgPSBXc2NyaXB0LkFyZ3VtZW50cyAgDQpGb3IgRWFjaCBhcmcgSW4gYXJncyAgDQogICAgRGltIFBTUnVuDQogICAgUFNSdW4gPSAicG93ZXJzaGVsbC5leGUgLVdpbmRvd1N0eWxlIGhpZGRlbiAtRXhlY3V0aW9uUG9saWN5IGJ5cGFzcyAtTm9uSW50ZXJhY3RpdmUgLUZpbGUgIiIiICYgYXJnICYgIiIiIg0KICAgIG9ialNoZWxsLlJ1bihQU1J1biksMA0KTmV4dA==')
#endregion FileVBS
    
# Enable-BitLockerTrigger.XML
#region FileXML
[String] $Script:NameXML = 'Enable_BitLocker.xml'
[String] $Script:FileXML = ('PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTE2Ij8+CjxUYXNrIHZlcnNpb249IjEuNCIgeG1sbnM9Imh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd2luZG93cy8yMDA0LzAyL21pdC90YXNrIj4KICA8UmVnaXN0cmF0aW9uSW5mbz4KICAgIDxEYXRlPjIwMTgtMDEtMDFUMTQ6MDA6MDA8L0RhdGU+CiAgICA8QXV0aG9yPklyb25zdG9uZTwvQXV0aG9yPgogICAgPFVSST5cSXJvblRyaWdnZXI8L1VSST4KICA8L1JlZ2lzdHJhdGlvbkluZm8+CiAgPFRyaWdnZXJzPgogICAgPFRpbWVUcmlnZ2VyPgogICAgICA8UmVwZXRpdGlvbj4KICAgICAgICA8SW50ZXJ2YWw+UFQxNU08L0ludGVydmFsPgogICAgICAgIDxTdG9wQXREdXJhdGlvbkVuZD5mYWxzZTwvU3RvcEF0RHVyYXRpb25FbmQ+CiAgICAgIDwvUmVwZXRpdGlvbj4KICAgICAgPFN0YXJ0Qm91bmRhcnk+MjAxOC0wMS0wMVQwMDowMDowMDwvU3RhcnRCb3VuZGFyeT4KICAgICAgPEVuYWJsZWQ+dHJ1ZTwvRW5hYmxlZD4KICAgIDwvVGltZVRyaWdnZXI+CiAgPC9UcmlnZ2Vycz4KICA8UHJpbmNpcGFscz4KICAgIDxQcmluY2lwYWwgaWQ9IkF1dGhvciI+CiAgICAgIDxHcm91cElkPlMtMS01LTMyLTU0NTwvR3JvdXBJZD4KICAgICAgPFJ1bkxldmVsPkhpZ2hlc3RBdmFpbGFibGU8L1J1bkxldmVsPgogICAgPC9QcmluY2lwYWw+CiAgPC9QcmluY2lwYWxzPgogIDxTZXR0aW5ncz4KICAgIDxNdWx0aXBsZUluc3RhbmNlc1BvbGljeT5JZ25vcmVOZXc8L011bHRpcGxlSW5zdGFuY2VzUG9saWN5PgogICAgPERpc2FsbG93U3RhcnRJZk9uQmF0dGVyaWVzPmZhbHNlPC9EaXNhbGxvd1N0YXJ0SWZPbkJhdHRlcmllcz4KICAgIDxTdG9wSWZHb2luZ09uQmF0dGVyaWVzPmZhbHNlPC9TdG9wSWZHb2luZ09uQmF0dGVyaWVzPgogICAgPEFsbG93SGFyZFRlcm1pbmF0ZT50cnVlPC9BbGxvd0hhcmRUZXJtaW5hdGU+CiAgICA8U3RhcnRXaGVuQXZhaWxhYmxlPnRydWU8L1N0YXJ0V2hlbkF2YWlsYWJsZT4KICAgIDxSdW5Pbmx5SWZOZXR3b3JrQXZhaWxhYmxlPmZhbHNlPC9SdW5Pbmx5SWZOZXR3b3JrQXZhaWxhYmxlPgogICAgPElkbGVTZXR0aW5ncz4KICAgICAgPFN0b3BPbklkbGVFbmQ+dHJ1ZTwvU3RvcE9uSWRsZUVuZD4KICAgICAgPFJlc3RhcnRPbklkbGU+ZmFsc2U8L1Jlc3RhcnRPbklkbGU+CiAgICA8L0lkbGVTZXR0aW5ncz4KICAgIDxBbGxvd1N0YXJ0T25EZW1hbmQ+dHJ1ZTwvQWxsb3dTdGFydE9uRGVtYW5kPgogICAgPEVuYWJsZWQ+dHJ1ZTwvRW5hYmxlZD4KICAgIDxIaWRkZW4+ZmFsc2U8L0hpZGRlbj4KICAgIDxSdW5Pbmx5SWZJZGxlPmZhbHNlPC9SdW5Pbmx5SWZJZGxlPgogICAgPERpc2FsbG93U3RhcnRPblJlbW90ZUFwcFNlc3Npb24+ZmFsc2U8L0Rpc2FsbG93U3RhcnRPblJlbW90ZUFwcFNlc3Npb24+CiAgICA8VXNlVW5pZmllZFNjaGVkdWxpbmdFbmdpbmU+dHJ1ZTwvVXNlVW5pZmllZFNjaGVkdWxpbmdFbmdpbmU+CiAgICA8V2FrZVRvUnVuPmZhbHNlPC9XYWtlVG9SdW4+CiAgICA8RXhlY3V0aW9uVGltZUxpbWl0PlBUMUg8L0V4ZWN1dGlvblRpbWVMaW1pdD4KICAgIDxQcmlvcml0eT43PC9Qcmlvcml0eT4KICA8L1NldHRpbmdzPgogIDxBY3Rpb25zIENvbnRleHQ9IkF1dGhvciI+CiAgICA8RXhlYz4KICAgICAgPENvbW1hbmQ+d3NjcmlwdC5leGU8L0NvbW1hbmQ+CiAgICAgIDxBcmd1bWVudHM+IkM6XFByb2dyYW0gRmlsZXNcSXJvbnN0b25lSVRcSXJvblRyaWdnZXJcRW5hYmxlX0JpdExvY2tlci52YnMiICJDOlxQcm9ncmFtIEZpbGVzXElyb25zdG9uZUlUXElyb25UcmlnZ2VyXEVuYWJsZV9CaXRMb2NrZXIucHMxIjwvQXJndW1lbnRzPgogICAgPC9FeGVjPgogIDwvQWN0aW9ucz4KPC9UYXNrPg==')
#endregion FileXML
#enregion Files
#endregion Variables



#region Functions
    #region Write-DebugIfOn
    Function Write-DebugIfOn {
        param(
            [Parameter(Mandatory=$true, Position=0)]
            [String] $In
        )
        If ($DebugConsole) {
            Write-Output -InputObject $In
        }
        If ($DebugWinTemp) {
            $Script:DebugStr += ($In + "`r`n")
        }
    }
    #endregion Write-DebugIfOn


    #region Check-CreateDir
    Function Check-CreateDir {
        Param(
            [Parameter(Mandatory=$true, Position=0)]
            [String] $Dir
        )
        Write-DebugIfOn -In ('Check-CreateDir -Dir ' + $Dir)
        If (!(Test-Path $Dir)) {
                Write-DebugIfOn -In '   Reg dir does not exist, trying to create'
                If(!($ReadOnly)) {
                    $null = New-Item -ItemType Directory -Force -Path $Dir 2>&1
                    If (!($?)) {
                        Write-DebugIfOn -In '      ERROR: Dir could not be created'
                    }
                    Else {
                        Write-DebugIfOn -In '      SUCCESS: Dir was created'
                    }
                }
                Else {Write-DebugIfOn -In '      ReadOnly mode'}
            } 
        Else {
            Write-DebugIfOn -In '   Reg dir does already exist'
        } 
    }
    #endregion Check-CreateDir


    #region FileOut-FromBase64
    Function FileOut-FromBase64 {
        Param(
            [Parameter(Mandatory=$true)]
            [String] $InstallDir, $FileName, $File, $Encoding
        )
        Write-DebugIfOn -In ('FileOut-FromBase64 -FilePath ' + $InstallDir + ' -FileName ' + $FileName + ' -File ' + ($File.Substring(0,10) + '...'))
        $Local:FilePath = $InstallDir + $FileName

        If (Test-Path $InstallDir) {
            Write-DebugIfOn -In ('   Path exists, trying to write the file (File alrady exists? {0})' -f (Test-Path $Local:FilePath))
            If (-not($ReadOnly)) {
                Out-File -FilePath $Local:FilePath -Encoding $Encoding -InputObject ([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($File)))
                Write-DebugIfOn -In ('      Success? {0}' -f ($?))
                Write-DebugIfOn -In ('         Does file actually exist? {0}' -f (Test-Path $Local:FilePath -ErrorAction SilentlyContinue))
            }
        }
        Else {
            Write-DebugIfOn -In ('   ERROR: Path does not exist')
        }
    }
    #enregion FileOut-FromBase64


    #region Query-Registry
    Function Query-Registry {
        Param ([Parameter(Mandatory=$true)] [String] $Dir)
        $Local:Out = [String]::Empty
        [String] $Local:Key = $Dir.Split('{\}')[-1]
        [String] $Local:Dir = $Dir.Replace($Local:Key,'')
        
        $Local:Exists = Get-ItemProperty -Path ('{0}' -f $Dir) -Name ('{0}' -f $Local:Key) -ErrorAction SilentlyContinue
        If ($Exists) {
            $Local:Out = $Local:Exists.$Local:Key
        }
        return $Local:Out
    }
    #endregion Query-Registry


    #region Get-MachineInfo
    Function Get-MachineInfo {
        $Script:ComputerName = $env:COMPUTERNAME
        [String] $Script:ComputerManufacturer = Query-Registry -Dir 'HKLM:\HARDWARE\DESCRIPTION\System\BIOS\SystemManufacturer'
        If (-not([String]::IsNullOrEmpty($Script:ComputerManufacturer))) {
            [String] $Script:ComputerFamily = Query-Registry -Dir 'HKLM:\HARDWARE\DESCRIPTION\System\BIOS\SystemFamily'
            [String] $Script:ComputerProductName = Query-Registry -Dir 'HKLM:\HARDWARE\DESCRIPTION\System\BIOS\SystemProductName'
            [String] $Script:WindowsEdition = Query-Registry -Dir 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProductName'
            [String] $Script:WindowsVersion = Query-Registry -Dir 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ReleaseId'
            [String] $Script:WindowsVersion += (' ({0})' -f (Query-Registry -Dir 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\CurrentBuild'))
        } 
        Else {
            $Local:EnvInfo = Get-WmiObject -Class Win32_ComputerSystem | Select-Object -Property Manufacturer,Model,SystemFamily        
            [String] $Script:ComputerManufacturer = $Local:EnvInfo.Manufacturer
            [String] $Script:ComputerFamily = $Local:EnvInfo.SystemFamily
            [String] $Script:ComputerProductName = $Local:EnvInfo.Model
            $Local:OSInfo = Get-WmiObject -Class win32_operatingsystem | Select-Object -Property Caption,Version
            [String] $Script:WindowsEdition = $Local:OSInfo.Caption
            [String] $Script:WindowsVersion = $Local:OSInfo.Version
        }
    }
    #endregion Get-MachineInfo
#enregion Functions



#region Initialize
Get-MachineInfo
If ($DebugWinTemp -or $DebugConsole) {
    Write-DebugIfOn -In '### Environment Info'
    Write-DebugIfOn -In ('Script settings: DebugConsole = "{0}", DebugWinTemp = "{1}", ReadOnly = "{2}"' -f ($DebugConsole,$DebugWinTemp,$Script:ReadOnly))
    Write-DebugIfOn -In ('Machine info: Name = "{0}", Manufacturer = "{1}", Family = "{2}", Model = "{3}"' -f ($Script:ComputerName,$Script:ComputerManufacturer,$Script:ComputerFamily,$Script:ComputerProductName))
    Write-DebugIfOn -In ('Windows info: Edition = "{0}", Version = "{1}"' -f ($Script:WindowsEdition,$Script:WindowsVersion))
}
#endregion Initialize



#region Main
    Write-DebugIfOn -In ("`r`n`r`n" + '### ' + $WhatToConfig)

    [String] $Local:InstallDir = (${env:ProgramFiles(x86)} + '\IronTrigger\')


    ###########################################################
    ### 1. Clean up BitLockerTrigger and IronTrigger
    Write-DebugIfOn -In ("`r`n`r`n" + '# 1. Clean up previous install paths')
    # Paths
    Write-DebugIfOn -In ('Remove previous install path(s) if present')
    [String[]] $Local:RemPaths = @($DirInstall,(${env:ProgramFiles(x86)} + '\BitLockerTrigger\'),(${env:ProgramFiles(x86)} + '\IronTrigger\'))
    $Local:RemPaths | ForEach-Object {
        Write-DebugIfOn -In ('   Removing "{0}" if it exists.' -f ($_))
        If (Test-Path -Path "$_") {
            Remove-Item -Path "$_" -Force -Recurse
            Write-DebugIfOn -In ('      Directory does exist. Removing. Success? .' -f ($?))
        }
        Else {
            Write-DebugIfOn -In ('      Directory does not exist')
        }
    }
    # Stats and Logs
    Write-DebugIfOn -In ('Remove previous files: Stats and Logs')
    [String[]] $Local:RemItems = @(($env:windir + '\Temp\BitLockerTrigger.log'),($env:windir + '\Temp\IronTrigger.log'))
    $Local:RemItems | ForEach-Object { 
        Write-DebugIfOn -In ('   Removing "{0}" if it exists.' -f ($_))
        If (Test-Path -Path "$_") {
            Remove-Item -Path "$_" -Force
            Write-DebugIfOn -In ('      File does exist. Removing. Success? .' -f ($?))
        }
        Else {
            Write-DebugIfOn -In ('      File does not exist')
        }     
    }
    # Scheduled tasks
    Write-DebugIfOn -In ('Remove previous ScheduledTask(s)')
    $Local:ScheduledTasks = Get-ScheduledTask | Where-Object {$_.TaskName -like $Script:ScheduledTaskName -or $_.TaskName -like '*Trigger'}
    If ($Local:ScheduledTasks.length -gt 0) {
        $Local:Tasks | ForEach-Object {             
            $null = Unregister-ScheduledTask -TaskName $_.TaskName -Confirm:$false -ErrorAction SilentlyContinue
            Write-DebugIfOn -In ('  Removing the Scheduled task "{0}". Success? {1}' -f ($_.TaskName,$?))
        }
    }
    Else {
        If (Get-ScheduledTask -TaskName $Script:ScheduledTaskName -ErrorAction SilentlyContinue) {            
            $null = Unregister-ScheduledTask -TaskName $Script:ScheduledTaskName -Confirm:$false -ErrorAction SilentlyContinue
            Write-DebugIfOn -In ('  Removing the Scheduled task "{0}". Success? {1}' -f ($Script:ScheduledTaskName,$?))
        }
        Else {
            Write-DebugIfOn -In ('  Scheduled task "{0}" does not exist.' -f ($Script:ScheduledTaskName))
        }
    }



    ###########################################################
    ### 2. Create install dir and log dir if not exist
    Write-DebugIfOn -In ("`r`n`r`n" + '# 2. Create install and log dir')
    Check-CreateDir -Dir $DirInstall
    Check-CreateDir -Dir $DirLog
    

    ###########################################################
    ### 3. Import files
    Write-DebugIfOn -In ("`r`n`r`n" + '# 3. Import files to "{0}"' -f ($DirInstall))
    FileOut-FromBase64 -InstallDir $DirInstall -FileName $Script:NamePS1 -File $Script:FilePS1 -Encoding utf8
    FileOut-FromBase64 -InstallDir $DirInstall -FileName $Script:NameVBS -File $Script:FileVBS -Encoding default
    FileOut-FromBase64 -InstallDir $DirInstall -FileName $Script:NameXML -File $Script:FileXML -Encoding utf8


    ###########################################################
    ### 4. Create ScheduledTask from XML
    Write-DebugIfOn -In ("`r`n`r`n" + '# 4. Create Scheduled Task "{0}"' -f ($Script:ScheduledTaskName))
    Write-DebugIfOn -In ('Register-ScheduledTask -Xml (Get-Content "{0}" | Out-String) -TaskName "{1}" -Force' -f (($DirInstall + $Script:NameXML),$Script:ScheduledTaskName))
    $null = Register-ScheduledTask -Xml (Get-Content ($DirInstall + $Local:NameXML) | Out-String) -TaskName $Script:ScheduledTaskName -Force
    Write-DebugIfOn -In ('   Success? {0}' -f ($?))


    ###########################################################
    ### 5. Run ScheduledTask
    Write-DebugIfOn -In ("`r`n`r`n" + '# 5. Start Scheduled Task "{0}"' -f ($Script:ScheduledTaskName))
    $null = Start-ScheduledTask -TaskName $Script:ScheduledTaskName
    Write-DebugIfOn -In ('   Success? {0}' -f ($?))



    Write-DebugIfOn -In ("`r`n`r`n" + 'Done.')    
#endregion Main



#region Debug
If ($DebugWinTemp) {
    If ([String]::IsNullOrEmpty($Script:DebugStr)) {
        $Script:DebugStr = 'Everything failed'
    }

    # Write Output
    $CurTime = Get-Date -Uformat '%y%m%d%H%M%S'
    $DebugFileName = ('{0} {1}.ps1' -f ($NameScriptFile,$CurTime))

    If (-not(Test-Path -Path $DirLog)) {
        $null = New-Item -Path $DirLog -Force -ItemType Directory
    }
    $Script:DebugStr | Out-File -FilePath ($DirLog + $DebugFileName) -Encoding 'utf8'
}
#endregion Debug