<#
.SYNOPSIS
    <Short, what it does>


.DESCRIPTION
    <Long, what it does>


.OUTPUTS
    <What it outputs during runtime>


Usage:


Todo:


Resources:
- Base64Encode.org (https://www.base64encode.org/) for Base64 encoding of the files

#>


#region Variables
# Settings
[bool] $DebugWinTemp = $false
[bool] $DebugConsole = $true
[bool] $ReadOnly = $false
If ($DebugWinTemp) {[String] $Global:DebugStr=[String]::Empty}

# Script specific variables
[String] $WhatToConfig = 'Install IronTrigger'
[String] $Script:ScheduledTaskName = 'IronTrigger'

# Files
#region Files
# Enable-BitLockerTrigger.PS1
#region FilePS1
[String] $Local:NamePS1 = 'Enable_BitLocker.ps1'
[String] $Local:FilePS1 = ('PCNQU1NjcmlwdEluZm8gCi5WRVJTSU9OIDEuNwouR1VJRCBmNTE4N2UzZi1lZDBhLTRjZTEtYjQzOC1kOGY0MjE2MTljYTMgCi5PUklHSU5BTCBBVVRIT1IgSmFuIFZhbiBNZWlydmVubmUgCi5NT0RJRklFRCBCWSBPbGF2IFIuIEJpcmtlbGFuZCwgU29vcmFqIFJhamFnb3BhbGFuLCBQYXVsIEh1aWpicmVndHMsIFBpZXRlciBXaWdsZXZlbiAmIE5pYWxsIEJyYWR5ICh3aW5kb3dzLW5vb2IuY29tIDIwMTcvOC8xNykKLkNPUFlSSUdIVCAKLlRBR1MgQXp1cmUgSW50dW5lIEJpdExvY2tlciAgCi5MSUNFTlNFVVJJICAKLlBST0pFQ1RVUkkgIAouSUNPTlVSSSAgCi5FWFRFUk5BTE1PRFVMRURFUEVOREVOQ0lFUyAgCi5SRVFVSVJFRFNDUklQVFMgIAouRVhURVJOQUxTQ1JJUFRERVBFTkRFTkNJRVMgIAouUkVMRUFTRU5PVEVTCi5UT0RPCi0gV2ViaG9vaywgZW1haWwgb3Igc2ltaWxhciBmb3Igbm90aWZ5aW5nIGFkbWlucyBhYm91dCBYIGZhaWxlZCBydW5zICAKIz4KCjwjIAogCi5ERVNDUklQVElPTiAKIENoZWNrIHdoZXRoZXIgQml0TG9ja2VyIGlzIEVuYWJsZWQsIGlmIG5vdCBFbmFibGUgQml0TG9ja2VyIG9uIEFBRCBKb2luZWQgZGV2aWNlcyBhbmQgc3RvcmUgcmVjb3ZlcnkgaW5mbyBpbiBBQUQgCiBBZGRlZCBsb2dnaW5nCiM+IAoKW2NtZGxldGJpbmRpbmcoKV0KcGFyYW0oCiAgICBbUGFyYW1ldGVyKCldCiAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgW3N0cmluZ10gJE9TRHJpdmUgPSAkZW52OlN5c3RlbURyaXZlCikKW05ldC5TZXJ2aWNlUG9pbnRNYW5hZ2VyXTo6U2VjdXJpdHlQcm90b2NvbCA9IFtOZXQuU2VjdXJpdHlQcm90b2NvbFR5cGVdOjpUbHMxMgoKCgojcmVnaW9uIFNldHRpbmdzIGFuZCBWYXJpYWJsZXMKIyBTZXR0aW5ncwpbYm9vbF0gJEdVSSA9ICRmYWxzZQpbYm9vbF0gJFNjcmlwdDpCb29sUmVtb3ZlRmlsZXNBZnRlclN1Y2Nlc3MgPSAkZmFsc2UKIyBWYXJpYWJsZXMKW1N0cmluZ10gJExvY2FsOk5hbWUgPSAnSXJvblRyaWdnZXInCltTdHJpbmddICRTY3JpcHQ6U2NoZWR1bGVkVGFza05hbWUgPSAkTG9jYWw6TmFtZS5DbG9uZSgpCltTdHJpbmddICRTY3JpcHQ6Q29tcHV0ZXJOYW1lID0gJGVudjpDT01QVVRFUk5BTUUKW1N0cmluZ10gJFNjcmlwdDpCaXRMb2NrZXJUcmlnZ2VyUGF0aCA9ICgnezB9XHsxfVwnIC1mICgke2VudjpQcm9ncmFtRmlsZXMoeDg2KX0sJExvY2FsOk5hbWUpKQpbU3RyaW5nXSAkU2NyaXB0OkZpbGVMb2cgPSAoJ0M6XFdpbmRvd3NcVGVtcFx7MH0ubG9nJyAtZiAoJExvY2FsOk5hbWUpKQpbU3RyaW5nXSAkU2NyaXB0OkZpbGVTdGF0cyA9ICgkU2NyaXB0OkJpdExvY2tlclRyaWdnZXJQYXRoICsgJ3N0YXRzLnR4dCcpCltTdHJpbmdbXV0gJFNjcmlwdDpCaXRMb2NrZXJFbmNyeXB0aW9uU3RhdHVzZXMgPSBAKCdGdWxseURlY3J5cHRlZCcsJ0VuY3J5cHRpb25JblByb2dyZXNzJywnRnVsbHlFbmNyeXB0ZWQnKQojZW5kcmVnaW9uIFNldHRpbmdzIGFuZCBWYXJpYWJsZXMKCgoKI3JlZ2lvbiBGdW5jdGlvbnMKICAgICNyZWdpb24gTG9nV3JpdGUKICAgIEZ1bmN0aW9uIExvZ1dyaXRlIHsKICAgICAgICBQYXJhbSAoW3N0cmluZ10kTG9nU3RyaW5nKQogICAgICAgIFtzdHJpbmddICRhID0gR2V0LURhdGUKICAgICAgICBbc3RyaW5nXSAkTG9nU3RyaW5nID0gJGEsICRMb2dTdHJpbmcKICAgICAgICBBZGQtY29udGVudCAtUGF0aCAkU2NyaXB0OkZpbGVMb2cgLVZhbHVlICRMb2dTdHJpbmcKICAgICAgICBXcml0ZS1Ib3N0ICRMb2dTdHJpbmcKICAgIH0KICAgICNlbmRyZWdpb24gTG9nV3JpdGUKCiAgICAjcmVnaW9uIExvZ0Vycm9ycwogICAgRnVuY3Rpb24gTG9nRXJyb3JzIHsKICAgICAgICBMb2dXcml0ZSAoJ0NhdWdodCBhbiBleGNlcHRpb246JykKICAgICAgICBMb2dXcml0ZSAoJ0V4Y2VwdGlvbiBUeXBlOiAnICsgJCgkXy5FeGNlcHRpb24uR2V0VHlwZSgpLkZ1bGxOYW1lKSkKICAgICAgICBMb2dXcml0ZSAoJ0V4Y2VwdGlvbiBNZXNzYWdlOiAnICsgJCgkXy5FeGNlcHRpb24uTWVzc2FnZSkpCiAgICB9CiAgICAjZW5kcmVnaW9uIExvZ0Vycm9ycwoKCiAgICAjcmVnaW9uIFdyaXRlLVN0YXRzOgogICAgIyBXcml0ZS1TdGF0czogT3V0cHV0cyBjdXJyZW50IHN0YXR1cyBvZiB2YXJpb3VzIGJvb2xlYW5zIGFuZCBvdGhlciBtZWFzdXJlbWVudHMKICAgIEZ1bmN0aW9uIFdyaXRlLVN0YXRzIHsKICAgICAgICBbYm9vbFtdXSAkTG9jYWw6S2V5UHJvdGVjdG9yVHlwZXMgPSBHZXQtQml0TG9ja2VyS2V5UHJvdGVjdG9yVHlwZXMgICAgCiAgICAgICAgTG9nV3JpdGUgKCdSdW5zOiB7MH0gfCBFbmNyeXB0ZWQ6IHsxfSB8IFJlY292ZXJ5IFBhc3N3b3JkcyBwcmVzZW50OiB7Mn0gfCBCYWNrdXAgdG8gT25lRHJpdmU6IHszfSB8IEJhY2t1cCB0byBBenVyZUFEOiB7NH0nIC1mICgkU2NyaXB0OkNvdW50UnVucywkU2NyaXB0OklzRW5jcnlwdGVkLCRTY3JpcHQ6SXNQcm90ZWN0aW9uUGFzc3csJFNjcmlwdDpJc0JhY2t1cE9ELCRTY3JpcHQ6SXNCYWNrdXBBQUQpKQogICAgICAgIExvZ1dyaXRlICgnQml0TG9ja2VyIEtleVByb3RlY3RvciBUeXBlcyBwcmVzZW50PyB8IFRQTTogezB9IHwgUmVjb3ZlcnlQYXNzd29yZDogezF9JyAtZiAoJExvY2FsOktleVByb3RlY3RvclR5cGVzWzBdLCRMb2NhbDpLZXlQcm90ZWN0b3JUeXBlc1sxXSkpCiAgICB9CiAgICAjZW5kcmVnaW9uIFdyaXRlLVN0YXRzOgoKCiAgICAjcmVnaW9uIFdyaXRlLVJlY292ZXJ5UGFzc3dvcmQKICAgICMgV3JpdGUtUmVjb3ZlcnlQYXNzd29yZAogICAgRnVuY3Rpb24gV3JpdGUtUmVjb3ZlcnlQYXNzd29yZCB7CiAgICAgICAgR2V0LVJlY292ZXJ5UGFzc3dvcmRzCiAgICAgICAgTG9nV3JpdGUgKCdUaGVyZXMgb25lIFJlY292ZXJ5IFBhc3N3b3JkIHByZXNlbnQ6JykKICAgICAgICBMb2dXcml0ZSAoR2V0LVJlY292ZXJ5UGFzc3dvcmRzU3RyaW5nKQogICAgfQogICAgI2VuZHJlZ2lvbiBXcml0ZS1SZWNvdmVyeVBhc3N3b3JkCgoKICAgICNyZWdpb24gR2V0LUJpdExvY2tlclN0YXR1cwogICAgIyBHZXQtQml0TG9ja2VyU3RhdHVzOiBGaWxscyB0d28gc3RyaW5ncyAoc2NvcGU6c2NyaXB0KSB3aXRoIGN1cnJlbnQgVm9sdW1lIEVuY3J5cHRpb24gU3RhdHVzLCBhbmQgVm9sdW1lIFByb3RlY3Rpb24gU3RhdHVzLgogICAgRnVuY3Rpb24gR2V0LUJpdExvY2tlclN0YXR1cyB7CiAgICAgICAgW01pY3Jvc29mdC5CaXRMb2NrZXIuU3RydWN0dXJlcy5CaXRMb2NrZXJWb2x1bWVdICRMb2NhbDpCaXRMb2NrZXJTdGF0dXMgPSBHZXQtQml0TG9ja2VyVm9sdW1lIC1Nb3VudFBvaW50ICRPU0RyaXZlCiAgICAgICAgW1N0cmluZ10gJFNjcmlwdDpWb2x1bWVFbmNTdGF0dXMgPSAoKCRMb2NhbDpCaXRMb2NrZXJTdGF0dXMgfCBTZWxlY3QtT2JqZWN0IC1Qcm9wZXJ0eSBWb2x1bWVTdGF0dXMpLlZvbHVtZVN0YXR1cykuVG9TdHJpbmcoKQogICAgICAgIFtTdHJpbmddICRTY3JpcHQ6Vm9sdW1lUHJvdGVjdGlvblN0YXR1cyA9ICgoJExvY2FsOkJpdExvY2tlclN0YXR1cyB8IFNlbGVjdC1PYmplY3QgLVByb3BlcnR5IFByb3RlY3Rpb25TdGF0dXMpLlByb3RlY3Rpb25TdGF0dXMpLlRvU3RyaW5nKCkKICAgIH0KICAgICNlbmRyZWdpb24gR2V0LUJpdExvY2tlclN0YXR1cwoKCiAgICAjcmVnaW9uIEdldC1CaXRMb2NrZXJLZXlQcm90ZWN0b3JUeXBlcwogICAgIyBHZXQtQml0TG9ja2VyS2V5UHJvdGVjdG9yVHlwZXM6IFJldHVybnMgYSBib29sIGFycmF5LCB3aGVyZSB0aGUgZmlyc3QgcmVwcmVzZW50cyBzdGF0dXMgb2YgVFBNIHByZXNlbmNlLCBhbmQgdGhlIHNlY29uZCBmb3IgUHJvdGVjdGlvbiBQYXNzd29yZAogICAgRnVuY3Rpb24gR2V0LUJpdExvY2tlcktleVByb3RlY3RvclR5cGVzIHsKICAgICAgICBbTWljcm9zb2Z0LkJpdExvY2tlci5TdHJ1Y3R1cmVzLkJpdExvY2tlclZvbHVtZV0gJExvY2FsOkJpdExvY2tlclN0YXR1cyA9IEdldC1CaXRMb2NrZXJWb2x1bWUgLU1vdW50UG9pbnQgJE9TRHJpdmUKICAgICAgICBbdWludDE2XSAkTG9jYWw6Q291bnRSZWNQYXNzID0gMAogICAgICAgIFt1aW50MTZdICRMb2NhbDpDb3VudFRQTSA9IDAKICAgICAgICAkTG9jYWw6Qml0TG9ja2VyU3RhdHVzLktleVByb3RlY3RvciB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgSWYgKCRfLktleVByb3RlY3RvclR5cGUgLWVxICdSZWNvdmVyeVBhc3N3b3JkJykgeyRMb2NhbDpDb3VudFJlY1Bhc3MgKz0gMX0KICAgICAgICAgICAgRWxzZUlmICgkXy5LZXlQcm90ZWN0b3JUeXBlIC1lcSAnVFBNJykgeyRMb2NhbDpDb3VudFRQTSArPSAxfQogICAgICAgIH0KICAgICAgICByZXR1cm4gKFtib29sXSAoJExvY2FsOkNvdW50VFBNIC1nZSAxKSxbYm9vbF0gKCRMb2NhbDpDb3VudFJlY1Bhc3MgLWdlIDEpKQogICAgfQogICAgI2VuZHJlZ2lvbkdldC1CaXRMb2NrZXJLZXlQcm90ZWN0b3JUeXBlcwoKCiAgICAjcmVnaW9uIEdldC1SZWNvdmVyeVBhc3N3b3JkcwogICAgIyBHZXQtUmVjb3ZlcnlQYXNzd29yZHM6IEZpbGxzIGEgYXJyYXlsaXN0IHdpdGggZXhpc3RpbmcgUHJvdGVjdGlvblBhc3N3b3Jkcywgc2NvcGU6c2NyaXB0CiAgICBGdW5jdGlvbiBHZXQtUmVjb3ZlcnlQYXNzd29yZHMgewogICAgICAgICMgR2V0IEV4aXN0aW5nIEJpdExvY2tlciBQcm90ZWN0aW9uUGFzc3dvcmRzCiAgICAgICAgJExvY2FsOkJpdExvY2tTdGF0dXMgPSBHZXQtQml0TG9ja2VyVm9sdW1lIC1Nb3VudFBvaW50ICRPU0RyaXZlCiAgICAgICAgJExvY2FsOktleVByb3RlY3RvclN0YXR1cyA9ICgkTG9jYWw6Qml0TG9ja1N0YXR1cyB8IFNlbGVjdC1PYmplY3QgLVByb3BlcnR5IEtleVByb3RlY3RvcikuS2V5UHJvdGVjdG9yCiAgICAgICAgW1N5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3RdICRTY3JpcHQ6QXJyYXlQcm90ZWN0aW9uUGFzc3dvcmRzID0gW1N5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3RdOjpuZXcoKQogICAgICAgIFt1aW50MTZdICRTY3JpcHQ6Q291bnRQcm90ZWN0aW9uS2V5cyA9IDAKCiAgICAgICAgJExvY2FsOktleVByb3RlY3RvclN0YXR1cyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgSWYgKCRfLktleVByb3RlY3RvclR5cGUgLWVxICdSZWNvdmVyeVBhc3N3b3JkJykgewogICAgICAgICAgICAgICAgJFNjcmlwdDpDb3VudFByb3RlY3Rpb25LZXlzICs9IDEKICAgICAgICAgICAgICAgICRudWxsID0gJFNjcmlwdDpBcnJheVByb3RlY3Rpb25QYXNzd29yZHMuQWRkKFtQU0N1c3RvbU9iamVjdF1Ae0tleVByb3RlY3RvcklkID0gW1N0cmluZ10kXy5LZXlQcm90ZWN0b3JJZDsgUmVjb3ZlcnlQYXNzd29yZCA9IFtTdHJpbmddJF8uUmVjb3ZlcnlQYXNzd29yZH0pCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAjZW5kcmVnaW9uIEdldC1SZWNvdmVyeVBhc3N3b3JkcwoKCiAgICAjcmVnaW9uIEdldC1SZWNvdmVyeVBhc3N3b3Jkc1N0cmluZwogICAgIyBHZXQtUmVjb3ZlcnlQYXNzd29yZHNTdHJpbmc6IFJldHVybnMgYSBzdHJpbmcgY29udGFpbmluZyB0aGUgcmVjb3ZlcnkgcGFzc3dvcmRzIGZyb20gJFNjcmlwdDpBcnJheVByb3RlY3Rpb25QYXNzd29yZHMuIFVzZWZ1bGwgZm9yIHByaW50aW5nLyBsb2dnaW5nLyBiYWNrdXAKICAgIEZ1bmN0aW9uIEdldC1SZWNvdmVyeVBhc3N3b3Jkc1N0cmluZyB7CiAgICAgICAgW3VpbnQxNl0gJExvY2FsOlRlbXBDb3VudGVyID0gMAogICAgICAgIFtTdHJpbmddICRMb2NhbDpPdXRTdHIgPSBbU3RyaW5nXTo6RW1wdHkKICAgICAgICAkU2NyaXB0OkFycmF5UHJvdGVjdGlvblBhc3N3b3JkcyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgJExvY2FsOk91dFN0ciArPSAoJ3swfSB8IEtleVByb3RlY3RvcklkICJ7MX0iIHwgUmVjb3ZlcnlQYXNzd29yZCAiezJ9IicgLWYgKCgkTG9jYWw6VGVtcENvdW50ZXIgKz0gMSksJF8uS2V5UHJvdGVjdG9ySWQsJF8uUmVjb3ZlcnlQYXNzd29yZCkpCiAgICAgICAgfQogICAgICAgIFJldHVybiAkTG9jYWw6T3V0U3RyCiAgICB9CiAgICAjZW5kcmVnaW9uIEdldC1SZWNvdmVyeVBhc3N3b3Jkc1N0cmluZwoKCiAgICAjcmVnaW9uIENyZWF0ZS1FbnZWYXJpYWJsZXMKICAgICMgQ3JlYXRlLUVudlZhcmlhYmxlczogQ3JlYXRlcyB2YXJpYWJsZXMgdXNlZCBieSB0aGUgdHJvdWJsZXNob290ZXIgYXQgdGhlIGJvdHRvbSwgd2hlbiBmYWlsZWQgcnVucyByZWFjaGVzIGEgZ2l2ZW4gbnVtYmVyLiAgCiAgICBGdW5jdGlvbiBDcmVhdGUtRW52VmFyaWFibGVzIHsKICAgICAgICAjIyMjIEdsb2JhbCBWYXJpYWJsZXMKICAgICAgICAjIyBUZW5hbnQKICAgICAgICBbU3RyaW5nXSAkTG9jYWw6SUQgPSAoR2V0LUNoaWxkSXRlbSBDZXJ0OlxMb2NhbE1hY2hpbmVcTXlcIHwgV2hlcmUtT2JqZWN0IHsgJF8uSXNzdWVyIC1tYXRjaCAnQ049TVMtT3JnYW5pemF0aW9uLUFjY2VzcycgfSkuU3ViamVjdC5SZXBsYWNlKCdDTj0nLCcnKQogICAgICAgIFtTdHJpbmddICRTY3JpcHQ6TmFtZVRlbmFudCA9IChHZXQtSXRlbVByb3BlcnR5IEhLTE06XFNZU1RFTVxDdXJyZW50Q29udHJvbFNldFxDb250cm9sXENsb3VkRG9tYWluSm9pblxKb2luSW5mb1wkKCRMb2NhbDpJRCkpLlVzZXJFbWFpbC5TcGxpdCgnQCcpWzFdCiAgICAgICAgW1N0cmluZ10gJFNjcmlwdDpOYW1lVGVuYW50U2hvcnQgPSAkR2xvYmFsOk5hbWVUZW5hbnQuU3BsaXQoJy4nKVswXQogICAgICAgICMjIEhhcmR3YXJlIGFuZCBXaW5kb3dzIGluZm8KICAgICAgICBbU3RyaW5nXSAkU2NyaXB0OkNvbXB1dGVyTWFudWZhY3R1cmVyID0gUXVlcnktUmVnaXN0cnkgLURpciAnSEtMTTpcSEFSRFdBUkVcREVTQ1JJUFRJT05cU3lzdGVtXEJJT1NcU3lzdGVtTWFudWZhY3R1cmVyJwogICAgICAgIElmICgtbm90KFtTdHJpbmddOjpJc051bGxPckVtcHR5KCRTY3JpcHQ6Q29tcHV0ZXJNYW51ZmFjdHVyZXIpKSkgewogICAgICAgICAgICBbU3RyaW5nXSAkU2NyaXB0OkNvbXB1dGVyRmFtaWx5ID0gUXVlcnktUmVnaXN0cnkgLURpciAnSEtMTTpcSEFSRFdBUkVcREVTQ1JJUFRJT05cU3lzdGVtXEJJT1NcU3lzdGVtRmFtaWx5JwogICAgICAgICAgICBbU3RyaW5nXSAkU2NyaXB0OkNvbXB1dGVyUHJvZHVjdE5hbWUgPSBRdWVyeS1SZWdpc3RyeSAtRGlyICdIS0xNOlxIQVJEV0FSRVxERVNDUklQVElPTlxTeXN0ZW1cQklPU1xTeXN0ZW1Qcm9kdWN0TmFtZScKICAgICAgICAgICAgW1N0cmluZ10gJFNjcmlwdDpXaW5kb3dzRWRpdGlvbiA9IFF1ZXJ5LVJlZ2lzdHJ5IC1EaXIgJ0hLTE06XFNPRlRXQVJFXE1pY3Jvc29mdFxXaW5kb3dzIE5UXEN1cnJlbnRWZXJzaW9uXFByb2R1Y3ROYW1lJwogICAgICAgICAgICBbU3RyaW5nXSAkU2NyaXB0OldpbmRvd3NWZXJzaW9uID0gUXVlcnktUmVnaXN0cnkgLURpciAnSEtMTTpcU09GVFdBUkVcTWljcm9zb2Z0XFdpbmRvd3MgTlRcQ3VycmVudFZlcnNpb25cUmVsZWFzZUlkJwogICAgICAgICAgICBbU3RyaW5nXSAkU2NyaXB0OldpbmRvd3NWZXJzaW9uICs9ICgnICh7MH0pJyAtZiAoUXVlcnktUmVnaXN0cnkgLURpciAnSEtMTTpcU09GVFdBUkVcTWljcm9zb2Z0XFdpbmRvd3MgTlRcQ3VycmVudFZlcnNpb25cQ3VycmVudEJ1aWxkJykpCiAgICAgICAgfSAKICAgICAgICBFbHNlIHsKICAgICAgICAgICAgJExvY2FsOkVudkluZm8gPSBHZXQtV21pT2JqZWN0IC1DbGFzcyBXaW4zMl9Db21wdXRlclN5c3RlbSB8IFNlbGVjdC1PYmplY3QgLVByb3BlcnR5IE1hbnVmYWN0dXJlcixNb2RlbCxTeXN0ZW1GYW1pbHkgICAgICAgIAogICAgICAgICAgICBbU3RyaW5nXSAkU2NyaXB0OkNvbXB1dGVyTWFudWZhY3R1cmVyID0gJExvY2FsOkVudkluZm8uTWFudWZhY3R1cmVyCiAgICAgICAgICAgIFtTdHJpbmddICRTY3JpcHQ6Q29tcHV0ZXJGYW1pbHkgPSAkTG9jYWw6RW52SW5mby5TeXN0ZW1GYW1pbHkKICAgICAgICAgICAgW1N0cmluZ10gJFNjcmlwdDpDb21wdXRlclByb2R1Y3ROYW1lID0gJExvY2FsOkVudkluZm8uTW9kZWwKICAgICAgICAgICAgJExvY2FsOk9TSW5mbyA9IEdldC1XbWlPYmplY3QgLUNsYXNzIHdpbjMyX29wZXJhdGluZ3N5c3RlbSB8IFNlbGVjdC1PYmplY3QgLVByb3BlcnR5IENhcHRpb24sVmVyc2lvbgogICAgICAgICAgICBbU3RyaW5nXSAkU2NyaXB0OldpbmRvd3NFZGl0aW9uID0gJExvY2FsOk9TSW5mby5DYXB0aW9uCiAgICAgICAgICAgIFtTdHJpbmddICRTY3JpcHQ6V2luZG93c1ZlcnNpb24gPSAkTG9jYWw6T1NJbmZvLlZlcnNpb24KICAgICAgICB9CiAgICB9CiAgICAjZW5kcmVnaW9uIENyZWF0ZS1FbnZWYXJpYWJsZXMKCgogICAgI3JlZ2lvbiBRdWVyeS1SZWdpc3RyeQogICAgRnVuY3Rpb24gUXVlcnktUmVnaXN0cnkgewogICAgICAgIFBhcmFtIChbUGFyYW1ldGVyKE1hbmRhdG9yeT0kdHJ1ZSldIFtTdHJpbmddICREaXIpCiAgICAgICAgJExvY2FsOk91dCA9IFtTdHJpbmddOjpFbXB0eQogICAgICAgIFtTdHJpbmddICRMb2NhbDpLZXkgPSAkRGlyLlNwbGl0KCd7XH0nKVstMV0KICAgICAgICBbU3RyaW5nXSAkTG9jYWw6RGlyID0gJERpci5SZXBsYWNlKCRMb2NhbDpLZXksJycpCiAgICAgICAgCiAgICAgICAgJExvY2FsOkV4aXN0cyA9IEdldC1JdGVtUHJvcGVydHkgLVBhdGggKCd7MH0nIC1mICREaXIpIC1OYW1lICgnezB9JyAtZiAkTG9jYWw6S2V5KSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgIElmICgkRXhpc3RzKSB7CiAgICAgICAgICAgICRMb2NhbDpPdXQgPSAkTG9jYWw6RXhpc3RzLiRMb2NhbDpLZXkKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRMb2NhbDpPdXQKICAgIH0KICAgICNlbmRyZWdpb24gUXVlcnktUmVnaXN0cnkKI2VuZHJlZ2lvbiBGdW5jdGlvbnMKCgoKI3JlZ2lvbiBTdGFydAojIyMjIFN0YXJ0CiMjICBGZXRjaGluZyBwcmV2aW91cyBydW4gcmVzdWx0cwpMb2dXcml0ZSAoJ1N0YXJ0aW5nIFRyaWdnZXIgQml0TG9ja2VyIHNjcmlwdC4nKQpJZiAoLW5vdCAoVGVzdC1QYXRoIC1QYXRoICRTY3JpcHQ6RmlsZVN0YXRzKSkgewogICAgW3VpbnQxNl0gJFNjcmlwdDpDb3VudFJ1bnMgPSAwCiAgICBbYm9vbF0gJFNjcmlwdDpJc0VuY3J5cHRlZCA9IFtib29sXSAkU2NyaXB0OklzUHJvdGVjdGlvblBhc3N3ID0gW2Jvb2xdICRTY3JpcHQ6SXNCYWNrdXBPRCA9IFtib29sXSAkU2NyaXB0OklzQmFja3VwQUFEID0gJGZhbHNlCiAgICBMb2dXcml0ZSAoJ0ZpcnN0IHJ1bicpCn0KRWxzZSB7CiAgICBbU3RyaW5nW11dICRJbnB1dFN0cmluZyA9IChHZXQtQ29udGVudCAtUGF0aCAkU2NyaXB0OkZpbGVTdGF0cykuU3BsaXQoW0Vudmlyb25tZW50XTo6TmV3TGluZSkKICAgIFt1aW50MTZdICRTY3JpcHQ6Q291bnRSdW5zID0gW3VpbnQxNl0gJElucHV0U3RyaW5nWzBdCiAgICBbYm9vbF0gJFNjcmlwdDpJc0VuY3J5cHRlZCA9IFt1aW50MTZdICRJbnB1dFN0cmluZ1sxXQogICAgW2Jvb2xdICRTY3JpcHQ6SXNQcm90ZWN0aW9uUGFzc3cgPSBbdWludDE2XSAkSW5wdXRTdHJpbmdbMl0KICAgIFtib29sXSAkU2NyaXB0OklzQmFja3VwT0QgPSBbdWludDE2XSAkSW5wdXRTdHJpbmdbM10KICAgIFtib29sXSAkU2NyaXB0OklzQmFja3VwQUFEID0gW3VpbnQxNl0gJElucHV0U3RyaW5nWzRdCiAgICBXcml0ZS1TdGF0cwp9CiNlbmRyZWdpb24gU3RhcnQKCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMjIyBFTkNSWVBUSU9OICMjIyMKIyMjIyMjIyMjIyMjIyMjIyMjIyMKTG9nV3JpdGUgKCcjIyMgQml0TG9ja2VyIEVuY3J5cHRpb24nKQpJZiAoJFNjcmlwdDpJc0VuY3J5cHRlZCkgewogICAgTG9nV3JpdGUgKCdPUyBEcml2ZSBpcyBhbHJlYWR5IGVuY3J5cHRlZC4nKQp9CkVsc2UgewogICAgIyBHZXQgZW5jcnlwdGlvbiBzdGF0dXMKICAgIEdldC1CaXRMb2NrZXJTdGF0dXMKICAgIExvZ1dyaXRlICgnIyBFbmNyeXB0aW9uJykKICAgIExvZ3dyaXRlICgnU3RhdHVzIG9mIE9TIGRyaXZlICh7MH0pIHwgVm9sdW1lU3RhdHVzOiB7MX0gfCBQcm90ZWN0aW9uU3RhdHVzOiB7Mn0nIC1mICgkT1NEcml2ZSwkU2NyaXB0OlZvbHVtZUVuY1N0YXR1cywkU2NyaXB0OlZvbHVtZVByb3RlY3Rpb25TdGF0dXMpKQoKICAgICMgSWYgJ0Z1bGx5RW5jcnlwdGVkJwogICAgSWYgKCRTY3JpcHQ6Vm9sdW1lRW5jU3RhdHVzIC1lcSAkU2NyaXB0OkJpdExvY2tlckVuY3J5cHRpb25TdGF0dXNlc1syXSkgewogICAgICAgIExvZ1dyaXRlICgnT1MgRHJpdmUgaXMgYWxyZWFkeSBlbmNyeXB0ZWQuJykKICAgICAgICAkU2NyaXB0OklzRW5jcnlwdGVkID0gJHRydWUKICAgIH0KCiAgICAjIElmICdFbmNyeXB0aW9uSW5Qcm9ncmVzcycKICAgIEVsc2VJZiAoJFNjcmlwdDpWb2x1bWVFbmNTdGF0dXMgLWVxICRTY3JpcHQ6Qml0TG9ja2VyRW5jcnlwdGlvblN0YXR1c2VzWzFdKSB7CiAgICAgICAgTG9nV3JpdGUgKCdPUyBEcml2ZSBlbmNyeXB0aW9uIGlzIGluIHByb2dyZXNzLicpCiAgICAgICAgTG9nV3JpdGUgKCdDYW4gY29udGludWUgdG8gY2hlY2sgaWYgVFBNIGlzIHByZXNlbnQsIGFuZCBhZGQgJiBiYWNrdXAgUHJvdGVjdGlvbiBQYXNzd29yZCcpCiAgICB9CgogICAgIyBJZiB0aGVyZSBleGlzdHMgYSBUUE0sIGRvbid0IEVuYWJsZS1CaXRsb2NrZXIgYWdhaW4KICAgIEVsc2VJZiAoKEdldC1CaXRMb2NrZXJLZXlQcm90ZWN0b3JUeXBlcylbMF0pIHsKICAgICAgICBMb2dXcml0ZSAoJ09TIERyaXZlIGVuY3J5cHRpb24gaGFzIHN0YXJ0ZWQsIGJ1dCBpdCBpcyBub3QgZnVsbHkgZW5jcnlwdGVkIHlldCcpCiAgICAgICAgTG9nV3JpdGUgKCdBd2FpdGluZyByZXN0YXJ0JykKICAgICAgICAkU2NyaXB0OklzRW5jcnlwdGVkID0gJGZhbHNlCiAgICB9CgogICAgIyBJZiB0aGVyZSBkb2VzIG5vdCBleGlzdCBhIFRQTSwgYW5kIHN0YXR1cyA9ICJGdWxseURlY3J5cHRlZCI6IEVuYWJsZS1CaXRMb2NrZXIgICAgIAogICAgRWxzZUlmICgkVm9sdW1lRW5jU3RhdHVzIC1lcSAkU2NyaXB0OkJpdExvY2tlckVuY3J5cHRpb25TdGF0dXNlc1swXSkgewogICAgICAgIExvZ1dyaXRlICgnT1MgRHJpdmUgaXMgbm90IGVuY3J5cHRlZC4nKQogICAgICAgIExvZ1dyaXRlICgnQXR0ZW1wdGluZyB0byBFbmFibGUgQml0TG9ja2VyIG9uIE9TIGRyaXZlICh7MH0pJyAtZiAoJE9TRHJpdmUpKQogICAgICAgIHRyeSB7CiAgICAgICAgICAgICMgRW5hYmxlIEJpdExvY2tlciB1c2luZyBUUE0KICAgICAgICAgICAgJG51bGwgPSBFbmFibGUtQml0TG9ja2VyIC1Nb3VudFBvaW50ICRPU0RyaXZlIC1UcG1Qcm90ZWN0b3IgLVVzZWRTcGFjZU9ubHkgLUVycm9yQWN0aW9uIENvbnRpbnVlCiAgICAgICAgICAgIElmICgkPykgewogICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdTdWNjZXNzIEVuYWJsaW5nIEJpdExvY2tlcj8gezB9JyAtZiAoJD8pKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEVsc2UgewogICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdGYWlsZWQgRW5hYmxpbmcgQml0bG9ja2VyIFRwbVByb3RlY3RvciwgaXRgcyBwcm9iYWJseSBhbHJlYWR5IGVuYWJsZWQnKQogICAgICAgICAgICB9CiAgICAgICAgfSAKICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgIExvZ0Vycm9ycwogICAgICAgICAgICBFbmFibGUtQml0TG9ja2VyIC1Nb3VudFBvaW50ICRPU0RyaXZlIC1UcG1Qcm90ZWN0b3IgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgTG9nV3JpdGUgKCdXaWxsIGF0dGVtcHQgdG8gRW5hYmxlIEJpdExvY2tlciBhbnl3YXkgYW5kIHRoZW4gY29udGludWUuIFN1Y2Nlc3M/IHswfScgLWYgKCQ/KSkKICAgICAgICB9CiAgICB9CgogICAgIyBJZiBzY2VuYXJpbyBmaXRzIG5vbmUgb2YgdGhlIGNhc2VzIGFib3ZlLi4KICAgIEVsc2UgewogICAgICAgIExvZ1dyaXRlICgnTmVpdGhlciAiezB9IiwgInsxfSIgb3IgInsyfSIsIHByb2JhYmx5IGF3YWl0aW5nIHJlc3RhcnQnIC1mICgkU2NyaXB0OkJpdExvY2tlckVuY3J5cHRpb25TdGF0dXNlc1swXSwkU2NyaXB0OkJpdExvY2tlckVuY3J5cHRpb25TdGF0dXNlc1sxXSwkU2NyaXB0OkJpdExvY2tlckVuY3J5cHRpb25TdGF0dXNlc1syXSkpCiAgICB9Cn0KCgojIEFkZCBCaXRMb2NrZXIgUmVjb3ZlcnkgUGFzc3dvcmQgaWYgbm9uZSBhcmUgcHJlc2VudApMb2dXcml0ZSAoJyMgUmVjb3ZlcnlQYXNzd29yZCcpCklmICgkU2NyaXB0OklzRW5jcnlwdGVkIC1vciAoJFNjcmlwdDpWb2x1bWVFbmNTdGF0dXMgLWVxICRTY3JpcHQ6Qml0TG9ja2VyRW5jcnlwdGlvblN0YXR1c2VzWzFdKSkgewogICAgSWYgKC1ub3QoJFNjcmlwdDpJc1Byb3RlY3Rpb25QYXNzdykpIHsKICAgICAgICBHZXQtUmVjb3ZlcnlQYXNzd29yZHMKCiAgICAgICAgIyBJZiB0aGVyZXMgYWxyZWFkeSBhIFByb3RlY3Rpb25QYXNzd29yZCwgd2UncmUgZG9uZQogICAgICAgIElmICgkU2NyaXB0OkNvdW50UHJvdGVjdGlvbktleXMgLWVxIDEpIHsKICAgICAgICAgICAgV3JpdGUtUmVjb3ZlcnlQYXNzd29yZAogICAgICAgICAgICAkU2NyaXB0OklzUHJvdGVjdGlvblBhc3N3ID0gJHRydWUKICAgICAgICB9CgogICAgICAgICMgSWYgdGhlcmVzIDAgb3IgbXVsdGlwbGUgUHJvdGVjdGlvbnNQYXNzd29yZChzKQogICAgICAgIEVsc2UgewogICAgICAgICAgICBbYm9vbF0gJExvY2FsOlN1Y2Nlc3MgPSAkZmFsc2UKCiAgICAgICAgICAgICMgSWYgdGhlcmUncyBubyBQcm90ZWN0aW9uUGFzc3dvcmQsIHdlIG5lZWQgdG8gbWFrZSBvbmUKICAgICAgICAgICAgSWYgKCRTY3JpcHQ6Q291bnRQcm90ZWN0aW9uS2V5cyAtZXEgMCkgewogICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdObyBSZWNvdmVyeVBhc3N3b3JkcyBmb3VuZCBmb3IgT1MgRHJpdmUgezB9LCBjcmVhdGluZyBuZXcgb25lLicgLWYgJE9TRHJpdmUpCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICRudWxsID0gQWRkLUJpdExvY2tlcktleVByb3RlY3RvciAtTW91bnRQb2ludCAkT1NEcml2ZSAtUmVjb3ZlcnlQYXNzd29yZFByb3RlY3RvciAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSAtV2FybmluZ0FjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgSWYgKCQ/KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbDpTdWNjZXNzID0gJHRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgRWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRudWxsID0gRW5hYmxlLUJpdExvY2tlciAtTW91bnRQb2ludCAkT1NEcml2ZSAtUmVjb3ZlcnlQYXNzd29yZFByb3RlY3RvciAtRXJyb3JBY3Rpb24gU3RvcAogICAgICAgICAgICAgICAgICAgICAgICBJZiAoJD8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbDpTdWNjZXNzID0gJHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgICAgIExvZ0Vycm9ycwogICAgICAgICAgICAgICAgICAgICRudWxsID0gQWRkLUJpdExvY2tlcktleVByb3RlY3RvciAtTW91bnRQb2ludCAkT1NEcml2ZSAtUmVjb3ZlcnlQYXNzd29yZFByb3RlY3RvciAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSAtV2FybmluZ0FjdGlvbiBTaWxlbnRseUNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgSWYgKCQ/KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbDpTdWNjZXNzID0gJHRydWUKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgRWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRudWxsID0gRW5hYmxlLUJpdExvY2tlciAtTW91bnRQb2ludCAkT1NEcml2ZSAtUmVjb3ZlcnlQYXNzd29yZFByb3RlY3RvciAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgICAgICAgICBJZiAoJD8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbDpTdWNjZXNzID0gJHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnVHJpZWQgdG8gYWRkIEJpdExvY2tlciBSZWNvdmVyeVBhc3N3b3JkUHJvdGVjdG9yLiBTdWNjZXNzPyB7MH0uJyAtZiAoJExvY2FsOlN1Y2Nlc3MpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgIAogICAgICAgICAgICAjIElmIHRoZXJlJ3MgbXVsdGlwbGUgZXhpc3RpbmcgUHJvdGVjdGlvblBhc3N3b3JkcywgZGVsZXRlIGFsbCBidXQgb25lCiAgICAgICAgICAgIEVsc2UgewogICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdUaGVyZSBhcmUgezB9IFJlY292ZXJ5IFBhc3N3b3JkcyBwcmVzZW50OicgLWYgKCRTY3JpcHQ6Q291bnRQcm90ZWN0aW9uS2V5cykpCiAgICAgICAgICAgICAgICBbdWludDE2XSAkTG9jYWw6SW50VGVtcENvdW50ZXIgPSAwCiAgICAgICAgICAgICAgICAkU2NyaXB0OkFycmF5UHJvdGVjdGlvblBhc3N3b3JkcyB8IEZvckVhY2gtT2JqZWN0IHsgTG9nV3JpdGUgKCd7MH0gfCBLZXlQcm90ZWN0b3JJZCAiezF9IiB8IFJlY292ZXJ5UGFzc3dvcmQgInsyfSI6ICcgLWYgKCgkTG9jYWw6SW50VGVtcENvdW50ZXIgKz0gMSksJF8uS2V5UHJvdGVjdG9ySWQsJF8uUmVjb3ZlcnlQYXNzd29yZCkpIH0KICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnV2lsbCByZW1vdmUgYWxsIGJ1dCB0aGUgZmlyc3Qgb25lJykKICAgICAgICAgICAgICAgICRTY3JpcHQ6QXJyYXlQcm90ZWN0aW9uUGFzc3dvcmRzIHwgRm9yRWFjaC1PYmplY3QgeyAKICAgICAgICAgICAgICAgICAgICBJZiAoJF8uS2V5UHJvdGVjdG9ySWQgLW5lICRTY3JpcHQ6QXJyYXlQcm90ZWN0aW9uUGFzc3dvcmRzWzBdLktleVByb3RlY3RvcklkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRudWxsID0gUmVtb3ZlLUJpdExvY2tlcktleVByb3RlY3RvciAtTW91bnRQb2ludCAkT1NEcml2ZSAtS2V5UHJvdGVjdG9ySWQgJF8uS2V5UHJvdGVjdG9ySUQKICAgICAgICAgICAgICAgICAgICAgICAgSWYgKCQ/KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ1N1Y2Nlc3NmdWxseSByZW1vdmVkIHwgS2V5UHJvdGVjdG9ySWQgInswfSIgfCBSZWNvdmVyeVBhc3N3b3JkICJ7MX0iJyAtZiAoJF8uS2V5UHJvdGVjdG9ySWQsJF8uUmVjb3ZlcnlQYXNzd29yZCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkU2NyaXB0OkNvdW50UHJvdGVjdGlvbktleXMgLT0gMQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIEVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ1N1Y2Nlc3NmdWxseSBza2lwcGVkIHRoZSBmaXJzdCBrZXkuIHwgS2V5UHJvdGVjdG9ySWQgInswfSIgfCBSZWNvdmVyeVBhc3N3b3JkICJ7MX0iJyAtZiAoJF8uS2V5UHJvdGVjdG9ySWQsJF8uUmVjb3ZlcnlQYXNzd29yZCkpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgSWYgKCRTY3JpcHQ6Q291bnRQcm90ZWN0aW9uS2V5cyAtZXEgMSkgewogICAgICAgICAgICAgICAgICAgICRMb2NhbDpTdWNjZXNzID0gJHRydWUKICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgIAogICAgICAgICAgICB9CgogICAgICAgICAgICAjIENvdW50IGFuZCBsaXN0IGV4aXN0aW5nIFJlY292ZXJ5UGFzc3dvcmQsIG9ubHkgd3JpdGUgc3VjY2VzcyBpZiB0aGVyZXMgb25lICAgICAgICAKICAgICAgICAgICAgSWYgKCRMb2NhbDpTdWNjZXNzKSB7CiAgICAgICAgICAgICAgICBMb2dXcml0ZSAnQ2hlY2tpbmcgaWYgdGhlcmUgaXMgb25seSBvbmUgUHJvdGVjdGlvbiBQYXNzd29yZC4nCiAgICAgICAgICAgICAgICBHZXQtUmVjb3ZlcnlQYXNzd29yZHMKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgSWYgKCRTY3JpcHQ6Q291bnRQcm90ZWN0aW9uS2V5cyAtZXEgMCkgewogICAgICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnRkFJTCwgbm8gUHJvdGVjdGlvbiBQYXNzd29yZCBmb3VuZCcpCiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBFbHNlIHsKICAgICAgICAgICAgICAgICAgICBJZiAoJFNjcmlwdDpDb3VudFByb3RlY3Rpb25LZXlzIC1lcSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnU1VDQ0VTUywga2V5cyBsZWZ0OiAxLicpCiAgICAgICAgICAgICAgICAgICAgICAgICRTY3JpcHQ6SXNQcm90ZWN0aW9uUGFzc3cgPSAkdHJ1ZQogICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBFbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgTG9nV3JpdGUgJ0ZBSUwsIGtleXMgbGVmdDogezB9LicgLWYgKCRTY3JpcHQ6QXJyYXlQcm90ZWN0aW9uUGFzc3dvcmRzLkNvdW50KQogICAgICAgICAgICAgICAgICAgICAgICAkU2NyaXB0OklzUHJvdGVjdGlvblBhc3N3ID0gJGZhbHNlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnU3RhdHVzOiB7MH0ga2V5KHMpIHByZXNlbnQ6JyAtZiAoJEdsb2JhbDpDb3VudFByb3RlY3Rpb25LZXlzKSkKICAgICAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ0tleVByb3RlY3RvcklkICJ7MH0iIHwgUmVjb3ZlcnlQYXNzd29yZCAiezF9Ii4nIC1mICgkU2NyaXB0OkFycmF5UHJvdGVjdGlvblBhc3N3b3Jkc1swXS5LZXlQcm90ZWN0b3JJZCwkU2NyaXB0OkFycmF5UHJvdGVjdGlvblBhc3N3b3Jkc1swXS5SZWNvdmVyeVBhc3N3b3JkKSkKICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgICAgIEVsc2UgewogICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdTb21ldGhpbmcgZmFpbGVkJykKICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgfQogICAgCiAgICB9CiAgICBFbHNlIHsKICAgICAgICBXcml0ZS1SZWNvdmVyeVBhc3N3b3JkCiAgICB9Cn0KIyBOb3QgZW5jcnlwdGVkID0gTm8gbWFraW5nIG9mIFJlY292ZXJ5UGFzc3dvcmQKRWxzZSB7CiAgICBMb2dXcml0ZSAoJ09TIERyaXZlIGlzIG5laXRoZXIgIkZ1bGx5RW5jcnlwdGVkIiBvciAiRW5jcnlwdGlvbkluUHJvZ3Jlc3MiOiBCaXRMb2NrZXIgUmVjb3ZlcnlQYXNzd29yZCBjYW4gbm90IGJlIGFkZGVkLicpCiAgICBMb2dXcml0ZSAoJ1JlY292ZXJ5IFBhc3N3b3JkIHByZXNlbnQ/IHswfScgLWYgKChHZXQtQml0TG9ja2VyS2V5UHJvdGVjdG9yVHlwZXMpWzFdKSkKICAgICRTY3JpcHQ6SXNQcm90ZWN0aW9uUGFzc3cgPSAkZmFsc2UKfQoKCgojIyMjIyMjIyMjIyMjIyMjIyMjIwojIyMjIyMgQkFDS1VQICMjIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIwojIEJhY2t1cCBCaXRMb2NrZXIgS2V5IHRvIE9uZURyaXZlIGFuZCBBenVyZUFECkxvZ1dyaXRlICgnIyMjIEJhY2t1cCBQcm90ZWN0aW9uIFBhc3N3b3JkJykKIyBDaGVjayB3aGF0aGVyIE9TRHJpdmUgaXMgZW5jcnlwdGVkIGFuZCBpZiBQcm90ZWN0aW9uIFBhc3N3b3JkKHMpIGV4aXN0CklmICgoJFNjcmlwdDpJc0VuY3J5cHRlZCAtb3IgKCRTY3JpcHQ6Vm9sdW1lRW5jU3RhdHVzIC1lcSAkU2NyaXB0OkJpdExvY2tlckVuY3J5cHRpb25TdGF0dXNlc1sxXSkpIC1hbmQgJFNjcmlwdDpJc1Byb3RlY3Rpb25QYXNzdykgewogICAgTG9nV3JpdGUgKCdPUyBEcml2ZSBpcyBlbmNyeXB0ZWQsIGFuZCB0aGVyZSBhcmUgezB9IFByb3RlY3Rpb25QYXNzd29yZChzKSBwcmVzZW50LicgLWYgKCRTY3JpcHQ6Q291bnRQcm90ZWN0aW9uS2V5cykpCiAgICBMb2dXcml0ZSAoJ0NvbnRpbnVpbmcgd2l0aCBiYWNrdXAuJykKCiAgICBJZiAoKC1ub3QoJElzUHJvdGVjdGlvblBhc3N3KSkgLW9yICgtbm90KCRJc0JhY2t1cEFBRCkpKSB7ICAgICAgICAKICAgICAgICBJZiAoLW5vdCAoJFNjcmlwdDpBcnJheVByb3RlY3Rpb25QYXNzd29yZHMpKSB7CiAgICAgICAgICAgIEdldC1SZWNvdmVyeVBhc3N3b3JkcwogICAgICAgIH0KICAgIH0KCiAgICAjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKICAgICMgT25lRHJpdmUgZm9yIEJ1c2luZXNzIGJhY2t1cAogICAgIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiAgICBMb2dXcml0ZSAoJyMgQmFja3VwIHRvIE9uZURyaXZlJykKICAgIElmICgkU2NyaXB0OklzQmFja3VwT0QpIHsKICAgICAgICBMb2dXcml0ZSAoJ0FscmVhZHkgZG9uZScpCiAgICB9CiAgICBFbHNlIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAjV3JpdGluZyBWYWx1ZSB0byBPbmVEcml2ZSBmaXJzdCAKICAgICAgICAgICAgJHJlZ1ZhbHVlcyA9IEdldC1DaGlsZEl0ZW0gJ0hLQ1U6XFNPRlRXQVJFXE1pY3Jvc29mdFxPbmVEcml2ZVxBY2NvdW50c1wnCiAgICAgICAgICAgIEZvckVhY2ggKCRyZWdWYWx1ZSBpbiAkcmVnVmFsdWVzKSB7CiAgICAgICAgICAgICAgICBbU3RyaW5nXSAkTG9jYWw6T0Q0QkFjY1R5cGUgPSBbU3RyaW5nW11dICgoKCRyZWdWYWx1ZSB8IFNlbGVjdC1PYmplY3QgTmFtZSkuTmFtZSkuU3BsaXQoJ3tcfScpWy0xXSkKICAgICAgICAgICAgICAgIElmICgkTG9jYWw6T0Q0QkFjY1R5cGUgLWxpa2UgJ0J1c2luZXNzKicpIHsKICAgICAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ0ZvdW5kIGEgT25lRHJpdmUgZm9yIEJ1c2luZXNzIGFjY291bnQnKQogICAgICAgICAgICAgICAgICAgICRMb2NhbDpLZXkgPSAkcmVnVmFsdWUubmFtZS5SZXBsYWNlKCdIS0VZX0NVUlJFTlRfVVNFUicsICdIS0NVOicpICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBbU3RyaW5nXSAkTG9jYWw6T0Q0QlBhdGggPSAoR2V0LUl0ZW1Qcm9wZXJ0eSAtUGF0aCAkTG9jYWw6S2V5IC1OYW1lICdVc2VyRm9sZGVyJykuVXNlckZvbGRlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIElmICgoLW5vdCgkTG9jYWw6T0Q0QlBhdGggLWxpa2UgKCRPU0RyaXZlICsgJ1xVc2Vyc1wqXE9uZURyaXZlIC0qJykpKSAtYW5kIChUZXN0LVBhdGggJExvY2FsOk9ENEJQYXRoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ0ZhaWxlZCB0byBidWlsZCBPbmVEcml2ZSBwYXRoOiAiezB9Iiwgb3IgaXQgZG9lcyBub3QgZXhpc3QuJyAtZiAkTG9jYWw6UGF0aCkKICAgICAgICAgICAgICAgICAgICAgICAgJFNjcmlwdDpJc0JhY2t1cE9EID0gJGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICNbU3RyaW5nXSAkTG9jYWw6UGF0aCA9ICgkZW52OlN5c3RlbURyaXZlICsgJGVudjpIT01FUEFUSCArICdPbmVEcml2ZSAtICcgKyAnXEJpdExvY2tlciBSZWNvdmVyeVwnICsgJGVudjpDT01QVVRFUk5BTUUgKyAnXCcgKQogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICAgICAgRWxzZSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgSWYgKC1ub3QoJFNjcmlwdDpDb21wdXRlclByb2R1Y3ROYW1lKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ3JlYXRlLUVudlZhcmlhYmxlcwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIFtTdHJpbmddICRMb2NhbDpPRDRCQmFja3VwUGF0aCA9ICgkTG9jYWw6T0Q0QlBhdGggKyAnXEJpdExvY2tlciBSZWNvdmVyeVx7MH0gKHsxfSB7Mn0pXCcgLWYgKCRTY3JpcHQ6Q29tcHV0ZXJOYW1lLCRTY3JpcHQ6Q29tcHV0ZXJNYW51ZmFjdHVyZXIsJFNjcmlwdDpDb21wdXRlclByb2R1Y3ROYW1lKSkKICAgICAgICAgICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdPbmVEcml2ZSBmb3IgQnVzaW5lc3MgcGF0aDogezB9JyAtZiAoJExvY2FsOk9ENEJQYXRoKSkKICAgICAgICAgICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdSZXN0b3JlIHBhc3N3b3JkIHBhdGg6IHswfScgLWYgKCRMb2NhbDpPRDRCQmFja3VwUGF0aCkpIAogICAgICAgICAgICAgICAgICAgICAgICAjVGVzdGluZyBpZiBSZWNvdmVyeSBmb2xkZXIgZXhpc3RzIGlmIG5vdCBjcmVhdGUgb25lCiAgICAgICAgICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnVGVzdGluZyBpZiBiYWNrdXAgZm9sZGVyIGV4aXN0cywgY3JlYXRlIGl0IGlmIG5vdC4nKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShUZXN0LVBhdGggJExvY2FsOk9ENEJCYWNrdXBQYXRoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJG51bGwgPSBOZXctSXRlbSAtSXRlbVR5cGUgRGlyZWN0b3J5IC1Gb3JjZSAtUGF0aCAkTG9jYWw6T0Q0QkJhY2t1cFBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIElmICgkPykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvZ1dyaXRlICdTdWNjZXNzIGNyZWF0aW5nIE9uZURyaXZlIGZvciBCdXNpbmVzcyBmb2xkZXIgZm9yIGJhY2t1cCcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ0RvZXMgYmFja3VwIGZvbGRlciBleGlzdD8gezB9JyAtZiAoVGVzdC1QYXRoIC1QYXRoICRMb2NhbDpPRDRCQmFja3VwUGF0aCkpICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIENyZWF0ZSBzdHJpbmcgZm9yIEJpdExvY2tlclJlY292ZXJ5UGFzc3dvcmQudHh0CiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbDpTdHJSZWNQYXNzID0gW1N0cmluZ106OkVtcHR5CiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbDpTdHJSZWNQYXNzICs9ICgnQml0TG9ja2VyIFJlY292ZXJ5UGFzc3dvcmQgZm9yIE9TIERyaXZlICh7MH0pezF9JyAtZiAoJGVudjpTeXN0ZW1Ecml2ZSwiYHJgbiIpKQogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWw6U3RyUmVjUGFzcyArPSBHZXQtUmVjb3ZlcnlQYXNzd29yZHNTdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN0clJlY1Bhc3MgKz0gImByYG5gcmBuIgogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWw6U3RyUmVjUGFzcyArPSAnQml0TG9ja2VyIERyaXZlIEVuY3J5cHRpb24gcmVjb3Zlcnkga2V5ezB9JyAtZiAiYHJgbiIKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN0clJlY1Bhc3MgKz0gJ1RvIHZlcmlmeSB0aGF0IHRoaXMgaXMgdGhlIGNvcnJlY3QgcmVjb3Zlcnkga2V5LCBjb21wYXJlIHRoZSBzdGFydCBvZiB0aGUgZm9sbG93aW5nezB9JyAtZiAiYHJgbiIKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN0clJlY1Bhc3MgKz0gJ2lkZW50aWZpZXIgd2l0aCB0aGUgaWRlbnRpZmllciB2YWx1ZSBkaXNwbGF5ZWQgb24geW91ciBQQy4nCiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbDpTdHJSZWNQYXNzICs9ICJgcmBuYHJgbiIKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN0clJlY1Bhc3MgKz0gKCdJZGVudGlmaWVyOiB7MH0nIC1mICgkU2NyaXB0OkFycmF5UHJvdGVjdGlvblBhc3N3b3Jkc1swXS5LZXlQcm90ZWN0b3JJZCkpCiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbDpTdHJSZWNQYXNzICs9ICJgcmBuYHJgbiIKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN0clJlY1Bhc3MgKz0gJ0lmIHRoZSBhYm92ZSBpZGVudGlmaWVyIG1hdGNoZXMgdGhlIG9uZSBkaXNwbGF5ZWQgYnkgeW91ciBQQyx7MH0nIC1mICJgcmBuIgogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWw6U3RyUmVjUGFzcyArPSAndGhlbiB1c2UgdGhlIGZvbGxvd2luZyBrZXkgdG8gIHVubG9jayB5b3VyIGRyaXZlOicKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN0clJlY1Bhc3MgKz0gImByYG5gcmBuIgogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWw6U3RyUmVjUGFzcyArPSAoJ1JlY292ZXJ5IEtleTogezB9JyAtZiAoJFNjcmlwdDpBcnJheVByb3RlY3Rpb25QYXNzd29yZHNbMF0uUmVjb3ZlcnlQYXNzd29yZCkpCiAgICAgICAgICAgICAgICAgICAgICAgICRMb2NhbDpTdHJSZWNQYXNzICs9ICJgcmBuYHJgbiIKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN0clJlY1Bhc3MgKz0gJ0lmIHRoZSBhYm92ZSBpZGVudGlmaWVyIGRvZXNuYHQgbWF0Y2ggdGhlIG9uZSBkaXNwbGF5ZWQgYnkgeW91ciBQQyx7MH0nIC1mICJgcmBuIgogICAgICAgICAgICAgICAgICAgICAgICAkTG9jYWw6U3RyUmVjUGFzcyArPSAndGhlbiB0aGlzIGlzbmB0IHRoZSByaWdodCBrZXkgdG8gdW5sb2NrIHlvdXIgZHJpdmUuezB9JyAtZiAiYHJgbiIKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN0clJlY1Bhc3MgKz0gJ1RyeSBhbm90aGVyIHJlY292ZXJ5IGtleSwgb3IgcmVmZXIgdG97MH0nIC1mICJgcmBuIiAKICAgICAgICAgICAgICAgICAgICAgICAgJExvY2FsOlN0clJlY1Bhc3MgKz0gJ2h0dHBzOi8vZ28ubWljcm9zb2Z0LmNvbS9md2xpbmsvP0xpbmtJRD0yNjA1ODkgZm9yIGFkZGl0aW9uYWwgYXNzaXN0YW5jZS4nCgogICAgICAgICAgICAgICAgICAgICAgICAjIE91dC1GaWxlIHRoZSBzdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgW1N0cmluZ10gJExvY2FsOkN1ckRhdGUgPSAoR2V0LURhdGUgLVVmb3JtYXQgJyV5JW0lZCVIJU0lUycpCiAgICAgICAgICAgICAgICAgICAgICAgIFtTdHJpbmddICRMb2NhbDpPRDRCQmFja3VwRmlsZVBhdGggPSAoJExvY2FsOk9ENEJCYWNrdXBQYXRoICsgJ0JpdGxvY2tlclJlY292ZXJ5UGFzc3dvcmQgezB9LnR4dCcgLWYgKCRMb2NhbDpDdXJEYXRlKSkKICAgICAgICAgICAgICAgICAgICAgICAgT3V0LUZpbGUgLUZpbGVQYXRoICRMb2NhbDpPRDRCQmFja3VwRmlsZVBhdGggLUVuY29kaW5nIHV0ZjggLUZvcmNlIC1JbnB1dE9iamVjdCAoJExvY2FsOlN0clJlY1Bhc3MpCiAgICAgICAgICAgICAgICAgICAgICAgIElmICgkPykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFNjcmlwdDpJc0JhY2t1cE9EID0gJHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBDYXRjaCB7CiAgICAgICAgICAgIExvZ1dyaXRlICgnRXJyb3Igd2hpbGUgYmFja3VwIHRvIE9uZURyaXZlLCBtYWtlIHN1cmUgdGhhdCB5b3UgYXJlIEFBRCBqb2luZWQgYW5kIGFyZSBydW5uaW5nIHRoZSBjbWRsZXQgYXMgYW4gYWRtaW4uJykKICAgICAgICAgICAgTG9nV3JpdGUgKCdFcnJvciBtZXNzYWdlOicgKyAiYHJgbiIgKyAoJF8pKQogICAgICAgIH0KICAgICAgICBGaW5hbGx5IHsKICAgICAgICAgICAgTG9nV3JpdGUgKCdEaWQgYmFja3VwIHRvIE9uZURyaXZlIHN1Y2NlZWQ/IHswfScgLWYgKCRTY3JpcHQ6SXNCYWNrdXBPRCkpCiAgICAgICAgfQogICAgfQogICAgCiAgICAjIyMjIyMjIyMjIyMjIyMjIwogICAgIyBBenVyZSBBRCBCYWNrdXAKICAgICMjIyMjIyMjIyMjIyMjIyMjCiAgICBMb2dXcml0ZSAoJyMgQmFja3VwIHRvIEF6dXJlIEFEJykKICAgIElmICgkU2NyaXB0OklzQmFja3VwQUFEKSB7CiAgICAgICAgTG9nV3JpdGUgKCdBbHJlYWR5IGRvbmUnKQogICAgfQogICAgRWxzZSB7ICAgICAgICAgICAKICAgICAgICAjQ2hlY2sgaWYgd2UgY2FuIHVzZSBCYWNrdXBUb0FBRC1CaXRMb2NrZXJLZXlQcm90ZWN0b3IgY29tbWFuZGxldAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIExvZ1dyaXRlICdDaGVjayBpZiB3ZSBjYW4gdXNlIEJhY2t1cFRvQUFELUJpdExvY2tlcktleVByb3RlY3RvciBjb21tYW5kbGV0Li4uJwogICAgICAgICAgICAkY21kTmFtZSA9ICdCYWNrdXBUb0FBRC1CaXRMb2NrZXJLZXlQcm90ZWN0b3InCiAgICAgICAgICAgIGlmIChHZXQtQ29tbWFuZCAkY21kTmFtZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZSkgewogICAgICAgICAgICAgICAgI0JhY2t1cFRvQUFELUJpdExvY2tlcktleVByb3RlY3RvciBjb21tYW5kbGV0IGV4aXN0cwogICAgICAgICAgICAgICAgTG9nV3JpdGUgKCd7MH0gY29tbWFuZGxldCBleGlzdHMhJyAtZiAkY21kTmFtZSkgCiAgICAgICAgICAgICAgICAkbnVsbCA9IEJhY2t1cFRvQUFELUJpdExvY2tlcktleVByb3RlY3RvciAtTW91bnRQb2ludCAkT1NEcml2ZSAtS2V5UHJvdGVjdG9ySWQgJFNjcmlwdDpBcnJheVByb3RlY3Rpb25QYXNzd29yZHNbMF0uS2V5UHJvdGVjdG9ySWQgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgIElmICgkPykgewogICAgICAgICAgICAgICAgICAgICRTY3JpcHQ6SXNCYWNrdXBBQUQgPSAkdHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgRWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJExvY2FsOkJMViA9IEdldC1CaXRMb2NrZXJWb2x1bWUgLU1vdW50UG9pbnQgJE9TRHJpdmUKICAgICAgICAgICAgICAgICAgICAkbnVsbCA9IEJhY2t1cFRvQUFELUJpdExvY2tlcktleVByb3RlY3RvciAtTW91bnRQb2ludCAkT1NEcml2ZSAtS2V5UHJvdGVjdG9ySWQgJExvY2FsOkJMVi5LZXlQcm90ZWN0b3JbMF0uS2V5UHJvdGVjdG9ySWQgLUVycm9yQWN0aW9uIFN0b3AKICAgICAgICAgICAgICAgICAgICBJZiAoJD8pIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFNjcmlwdDpJc0JhY2t1cEFBRCA9ICR0cnVlCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdTdWNjZXNzPyB7MH0nIC1mICgkU2NyaXB0OklzQmFja3VwQUFEKSkKICAgICAgICAgICAgfSAKICAgICAgICAgICAgZWxzZSB7IAogICAgICAgICAgICAgICAgIyBCYWNrdXBUb0FBRC1CaXRMb2NrZXJLZXlQcm90ZWN0b3IgY29tbWFuZGxldCBub3QgYXZhaWxhYmxlLCB1c2luZyBvdGhlciBtZWNoYW5pc20gCiAgICAgICAgICAgICAgICBMb2dXcml0ZSAnQmFja3VwVG9BQUQtQml0TG9ja2VyS2V5UHJvdGVjdG9yIGNvbW1hbmRsZXQgbm90IGF2YWlsYWJsZSwgdXNpbmcgb3RoZXIgbWVjaGFuaXNtLicgCiAgICAgICAgICAgICAgICAjIEdldCB0aGUgQUFEIE1hY2hpbmUgQ2VydGlmaWNhdGUKICAgICAgICAgICAgICAgICRjZXJ0ID0gR2V0LUNoaWxkSXRlbSBDZXJ0OlxMb2NhbE1hY2hpbmVcTXlcIHwgV2hlcmUtT2JqZWN0IHsgJF8uSXNzdWVyIC1tYXRjaCAnQ049TVMtT3JnYW5pemF0aW9uLUFjY2VzcycgfQoKICAgICAgICAgICAgICAgICMgT2J0YWluIHRoZSBBQUQgRGV2aWNlIElEIGZyb20gdGhlIGNlcnRpZmljYXRlCiAgICAgICAgICAgICAgICAkaWQgPSAkY2VydC5TdWJqZWN0LlJlcGxhY2UoJ0NOPScsJycpCgogICAgICAgICAgICAgICAgIyBHZXQgdGhlIHRlbmFudCBuYW1lIGZyb20gdGhlIHJlZ2lzdHJ5CiAgICAgICAgICAgICAgICAkdGVuYW50ID0gKEdldC1JdGVtUHJvcGVydHkgSEtMTTpcU1lTVEVNXEN1cnJlbnRDb250cm9sU2V0XENvbnRyb2xcQ2xvdWREb21haW5Kb2luXEpvaW5JbmZvXCQoJGlkKSkuVXNlckVtYWlsLlNwbGl0KCdAJylbMV0KICAgICAgICAgICAgICAgIExvZ1dyaXRlICR0ZW5hbnQKICAgICAgICAgICAgICAgICMgR2VuZXJhdGUgdGhlIGJvZHkgdG8gc2VuZCB0byBBQUQgY29udGFpbmluZyB0aGUgcmVjb3ZlcnkgaW5mb3JtYXRpb24KICAgICAgICAgICAgICAgICMgR2V0IHRoZSBCaXRMb2NrZXIga2V5IGluZm9ybWF0aW9uIGZyb20gV01JCiAgICAgICAgICAgICAgICAoR2V0LUJpdExvY2tlclZvbHVtZSAtTW91bnRQb2ludCAkT1NEcml2ZSkuS2V5UHJvdGVjdG9yfD8geyRfLktleVByb3RlY3RvclR5cGUgLWVxICdSZWNvdmVyeVBhc3N3b3JkJ318ICUgewogICAgICAgICAgICAgICAgICAgICRrZXkgPSAkXwogICAgICAgICAgICAgICAgICAgIHdyaXRlLXZlcmJvc2UgImtpZCA6ICQoJGtleS5LZXlQcm90ZWN0b3JJZCkga2V5OiAkKCRrZXkuUmVjb3ZlcnlQYXNzd29yZCkiCiAgICAgICAgICAgICAgICAgICAgJGJvZHkgPSAieyIia2V5IiI6IiIkKCRrZXkuUmVjb3ZlcnlQYXNzd29yZCkiIiwiImtpZCIiOiIiJCgka2V5LktleVByb3RlY3RvcklkLnJlcGxhY2UoJ3snLCcnKS5SZXBsYWNlKCd9JywnJykpIiIsIiJ2b2wiIjoiIk9TViIifSIKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIENyZWF0ZSB0aGUgVVJMIHRvIHBvc3QgdGhlIGRhdGEgdG8gYmFzZWQgb24gdGhlIHRlbmFudCBhbmQgZGV2aWNlIGluZm9ybWF0aW9uCiAgICAgICAgICAgICAgICAgICAgJHVybCA9ICJodHRwczovL2VudGVycHJpc2VyZWdpc3RyYXRpb24ud2luZG93cy5uZXQvbWFuYWdlLyR0ZW5hbnQvZGV2aWNlLyQoJGlkKT9hcGktdmVyc2lvbj0xLjAiCiAgICAgICAgICAgICAgICAgICAgTG9nc3RyaW5nICJDcmVhdGluZyB1cmwuLi4kdXJsIgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgUG9zdCB0aGUgZGF0YSB0byB0aGUgVVJMIGFuZCBzaWduIGl0IHdpdGggdGhlIEFBRCBNYWNoaW5lIENlcnRpZmljYXRlCiAgICAgICAgICAgICAgICAgICAgJHJlcSA9IEludm9rZS1XZWJSZXF1ZXN0IC1VcmkgJHVybCAtQm9keSAkYm9keSAtVXNlQmFzaWNQYXJzaW5nIC1NZXRob2QgUG9zdCAtVXNlRGVmYXVsdENyZWRlbnRpYWxzIC1DZXJ0aWZpY2F0ZSAkY2VydAogICAgICAgICAgICAgICAgICAgICRyZXEuUmF3Q29udGVudAogICAgICAgICAgICAgICAgICAgIElmICgkPykgewogICAgICAgICAgICAgICAgICAgICAgICAkU2NyaXB0OklzQmFja3VwQUFEID0gJHRydWUKICAgICAgICAgICAgICAgICAgICB9ICAgIAogICAgICAgICAgICAgICAgICAgIExvZ1N0cmluZyAoJ1Bvc3QgdGhlIGRhdGEgdG8gdGhlIFVSTCBhbmQgc2lnbiBpdCB3aXRoIHRoZSBBQUQgTWFjaGluZSBDZXJ0aWZpY2F0ZS4gU3VjY2Vzcz8gezB9JyAtZiAoJFNjcmlwdDpJc0JhY2t1cEFBRCkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gCiAgICAgICAgfQogICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgTG9nV3JpdGUgKCdFcnJvciB3aGlsZSBiYWNrdXAgdG8gQXp1cmUgQUQsIG1ha2Ugc3VyZSB0aGF0IHlvdSBhcmUgQUFEIGpvaW5lZCBhbmQgYXJlIHJ1bm5pbmcgdGhlIGNtZGxldCBhcyBhbiBhZG1pbi4nKQogICAgICAgICAgICBMb2dXcml0ZSAoJ0Vycm9yIG1lc3NhZ2U6JyArICJgcmBuIiArICgkXykpCiAgICAgICAgICAgICRJc0JhY2t1cEFBRCA9ICRmYWxzZQogICAgICAgIH0KICAgICAgICBGaW5hbGx5IHsKICAgICAgICAgICAgTG9nV3JpdGUgKCdEaWQgYmFja3VwIHRvIEF6dXJlIEFEIFN1Y2NlZWQ/IHswfScgLWYgKCRTY3JpcHQ6SXNCYWNrdXBBQUQpKQogICAgICAgIH0KICAgIH0KCn0gCmVsc2UgewogICAgTG9nV3JpdGUgKCdEcml2ZSBpcyBub3QgZW5jcnlwdGVkIGFuZC9vciBubyBQcm90ZWN0aW9uIFBhc3N3b3JkKHMpIHByZXNlbnQuJykKICAgIExvZ1dyaXRlICgnV2lsbCBza2lwIGJhY2t1cCwgZm9yIG5vdy4nKQp9CgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMjIyMjICBHIFUgSSAjIyMjIyMKIyMjIyMjIyMjIyMjIyMjIyMjIyMKI3JlZ2lvbiBHVUkKSWYgKCRTY3JpcHQ6SXNFbmNyeXB0ZWQgLWFuZCAkU2NyaXB0OklzUHJvdGVjdGlvblBhc3N3IC1hbmQgJEdVSSkgewogICAgIyBTaG93IHJlYm9vdCBwcm9tcHQgdG8gdXNlcgogICAgTG9nV3JpdGUgIlByb21wdGluZyB1c2VyIHRvIFJlYm9vdCBjb21wdXRlci4iCiAgICAgICAgICAgCgogICAgW3ZvaWRdW1N5c3RlbS5SZWZsZWN0aW9uLkFzc2VtYmx5XTo6TG9hZFdpdGhQYXJ0aWFsTmFtZSgg4oCcU3lzdGVtLldpbmRvd3MuRm9ybXPigJ0pCiAgICBbdm9pZF1bU3lzdGVtLlJlZmxlY3Rpb24uQXNzZW1ibHldOjpMb2FkV2l0aFBhcnRpYWxOYW1lKCDigJxNaWNyb3NvZnQuVmlzdWFsQmFzaWPigJ0pCgogICAgJGZvcm0gPSBOZXctT2JqZWN0IOKAnFN5c3RlbS5XaW5kb3dzLkZvcm1zLkZvcm3igJ07CiAgICAkZm9ybS5XaWR0aCA9IDUwMDsKICAgICRmb3JtLkhlaWdodCA9IDE1MDsKICAgICRmb3JtLlRleHQgPSAiQml0TG9ja2VyIHJlcXVpcmVzIGEgcmVib290ICEiOwogICAgJGZvcm0uU3RhcnRQb3NpdGlvbiA9IFtTeXN0ZW0uV2luZG93cy5Gb3Jtcy5Gb3JtU3RhcnRQb3NpdGlvbl06OkNlbnRlclNjcmVlbjsKCiAgICAkRHJvcERvd25BcnJheSA9IEAoIjQ6SG91cnMiLCAiODpIb3VycyIsICIxMjpIb3VycyIsICIyNDpIb3VycyIpCiAgICAkRERMID0gTmV3LU9iamVjdCBTeXN0ZW0uV2luZG93cy5Gb3Jtcy5Db21ib0JveAogICAgJERETC5Mb2NhdGlvbiA9IE5ldy1PYmplY3QgU3lzdGVtLkRyYXdpbmcuU2l6ZSgxNDAsIDEwKQogICAgJERETC5TaXplID0gTmV3LU9iamVjdCBTeXN0ZW0uRHJhd2luZy5TaXplKDEzMCwgMzApCiAgICBGb3JFYWNoICgkSXRlbSBpbiAkRHJvcERvd25BcnJheSkgewogICAgICAgICREREwuSXRlbXMuQWRkKCRJdGVtKSB8IE91dC1OdWxsCiAgICB9CiAgICAkRERMLlNlbGVjdGVkSW5kZXggPSAwCgogICAgJGJ1dHRvbjEgPSBOZXctT2JqZWN0IOKAnFN5c3RlbS5XaW5kb3dzLkZvcm1zLmJ1dHRvbuKAnTsKICAgICRidXR0b24xLkxlZnQgPSA0MDsKICAgICRidXR0b24xLlRvcCA9IDg1OwogICAgJGJ1dHRvbjEuV2lkdGggPSAxMDA7CiAgICAkYnV0dG9uMS5UZXh0ID0g4oCcUmVib290IE5vd+KAnTsKICAgICRidXR0b24xLkFkZF9DbGljayggeyRnbG9iYWw6eGlucHV0ID0gIlJlYm9vdCI7ICRGb3JtLkNsb3NlKCl9KQoKICAgICRidXR0b24yID0gTmV3LU9iamVjdCDigJxTeXN0ZW0uV2luZG93cy5Gb3Jtcy5idXR0b27igJ07CiAgICAkYnV0dG9uMi5MZWZ0ID0gMTcwOwogICAgJGJ1dHRvbjIuVG9wID0gODU7CiAgICAkYnV0dG9uMi5XaWR0aCA9IDEwMDsKICAgICRidXR0b24yLlRleHQgPSDigJxQb3N0cG9uZeKAnTsKICAgICRidXR0b24yLkFkZF9DbGljayggeyRnbG9iYWw6eGlucHV0ID0gIlBvc3Rwb25lOiIgKyAkRERMLlRleHQ7ICRGb3JtLkNsb3NlKCl9KQoKICAgICRidXR0b24zID0gTmV3LU9iamVjdCDigJxTeXN0ZW0uV2luZG93cy5Gb3Jtcy5idXR0b27igJ07CiAgICAkYnV0dG9uMy5MZWZ0ID0gMjkwOwogICAgJGJ1dHRvbjMuVG9wID0gODU7CiAgICAkYnV0dG9uMy5XaWR0aCA9IDEwMDsKICAgICRidXR0b24zLlRleHQgPSDigJxDYW5jZWzigJ07CiAgICAkYnV0dG9uMy5BZGRfQ2xpY2soIHskZ2xvYmFsOnhpbnB1dCA9ICJQb3N0cG9uZTI0IjsgJEZvcm0uQ2xvc2UoKX0pCgoKICAgICRmb3JtLktleVByZXZpZXcgPSAkVHJ1ZQogICAgJGZvcm0uQWRkX0tleURvd24oIHtpZiAoJF8uS2V5Q29kZSAtZXEgIkVudGVyIikgCiAgICAgICAgICAgIHskeCA9ICR0ZXh0Qm94MS5UZXh0OyAkZm9ybS5DbG9zZSgpfX0pCiAgICAkZm9ybS5BZGRfS2V5RG93bigge2lmICgkXy5LZXlDb2RlIC1lcSAiRXNjYXBlIikgCiAgICAgICAgICAgIHskZm9ybS5DbG9zZSgpfX0pCgogICAgJGV2ZW50SGFuZGxlciA9IFtTeXN0ZW0uRXZlbnRIYW5kbGVyXSB7IAogICAgICAgICRidXR0b24xLkNsaWNrOwogICAgICAgICREcm9wRG93bkFycmF5LlRleHQ7CiAgICAgICAgJGZvcm0uQ2xvc2UoKTsgfTsKCiAgICAjJGJ1dHRvbi5BZGRfQ2xpY2soJGV2ZW50SGFuZGxlcikgOwogICAgJGZvcm0uQ29udHJvbHMuQWRkKCRidXR0b24xKTsKICAgICRmb3JtLkNvbnRyb2xzLkFkZCgkYnV0dG9uMik7CiAgICAkZm9ybS5Db250cm9scy5BZGQoJGJ1dHRvbjMpOwogICAgJGZvcm0uQ29udHJvbHMuQWRkKCREREwpOwogICAgJGZvcm0uQ29udHJvbHMuQWRkKCR0ZXh0TGFiZWwxKQogICAgJHJldCA9ICRmb3JtLlNob3dEaWFsb2coKTsKCiAgICBpZiAoJGdsb2JhbDp4aW5wdXQgLWVxICJSZWJvb3QiKSB7c2h1dGRvd24gLXIgLWYgL3QgNjAwfQogICAgaWYgKCRnbG9iYWw6eGlucHV0IC1saWtlICJQb3N0cG9uZToqOkhvdXJzIikgewogICAgICAgICRodmFsID0gKChbaW50XSRnbG9iYWw6eGlucHV0LnNwbGl0KCI6IilbMV0pICogNjAgKiA2MCkKICAgICAgICBzaHV0ZG93biAtciAtZiAvdCAkaHZhbAogICAgfQogICAgaWYgKCRnbG9iYWw6eGlucHV0IC1lcSAiUG9zdHBvbmUyNCIpIHtzaHV0ZG93biAtciAtZiAvdCA4NjQwMH0KfQojZW5kcmVnaW9uIEdVSQoKCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMjIyBTIFQgQSBUIFMgIyMjIyMKIyMjIyMjIyMjIyMjIyMjIyMjIyMKTG9nV3JpdGUgKCcjIyMgU1RBVFMnKQokU2NyaXB0OkNvdW50UnVucyArPSAxCgpJZiAoLW5vdCgkU2NyaXB0OkJvb2xSZW1vdmVGaWxlc0FmdGVyU3VjY2VzcykpIHsKICAgIElmICgtbm90KFRlc3QtUGF0aCAkU2NyaXB0OkJpdExvY2tlclRyaWdnZXJQYXRoKSkgewogICAgICAgICRudWxsID0gTmV3LUl0ZW0gLVBhdGggJFNjcmlwdDpCaXRMb2NrZXJUcmlnZ2VyUGF0aCAtSXRlbVR5cGUgRGlyZWN0b3J5IC1Gb3JjZQogICAgfQogICAgCiAgICBbU3RyaW5nXSAkT3V0U3RyaW5nID0gKCgkU2NyaXB0OkNvdW50UnVucykuVG9TdHJpbmcoKSArICJgcmBuIikKICAgICRPdXRTdHJpbmcgKz0gKChbdWludDE2XSAkU2NyaXB0OklzRW5jcnlwdGVkKS5Ub1N0cmluZygpICsgImByYG4iKQogICAgJE91dFN0cmluZyArPSAoKFt1aW50MTZdICRTY3JpcHQ6SXNQcm90ZWN0aW9uUGFzc3cpLlRvU3RyaW5nKCkgKyAiYHJgbiIpCiAgICAkT3V0U3RyaW5nICs9ICgoW3VpbnQxNl0gJFNjcmlwdDpJc0JhY2t1cE9EKS5Ub1N0cmluZygpICsgImByYG4iKQogICAgJE91dFN0cmluZyArPSAoKFt1aW50MTZdICRTY3JpcHQ6SXNCYWNrdXBBQUQpLlRvU3RyaW5nKCkgKyAiYHJgbiIpCiAgICBPdXQtRmlsZSAtRmlsZVBhdGggJFNjcmlwdDpGaWxlU3RhdHMgLUVuY29kaW5nIHV0ZjggLUZvcmNlIC1JbnB1dE9iamVjdCAoJE91dFN0cmluZykKfQpMb2dXcml0ZSAoJ1J1bnMgc28gZmFyOiB7MH0nIC1mICgkU2NyaXB0OkNvdW50UnVucykpCgpJZiAoJFNjcmlwdDpDb3VudFJ1bnMgLWVxIDMwKSB7CiAgICBMb2dXcml0ZSAoJ1Nob3VsZCBoYXZlIGJlZW4gZG9uZSBieSBub3cuIFNlbmRpbmcgYSBzdXBwb3J0IHJlcXVlc3QgdG8geW91ciBoZWxwZGVzaycpCiAgICAjIyMgR2F0aGVyaW5nIGluZm8gZm9yIHRoZSBlbWFpbAogICAgSWYgKC1ub3QoJFNjcmlwdDpXaW5kb3dzVmVyc2lvbikpIHsKICAgICAgICBDcmVhdGUtRW52VmFyaWFibGVzCiAgICB9CiAgICAjIyMgQnVpbGRpbmcgZW1haWwgc3RyaW5nCiAgICBbU3RyaW5nXSAkTG9jYWw6U3RyU3ViamVjdCA9ICgnQml0TG9ja2VyVHJpZ2dlciBmYWlsZWQgezB9IHRpbWVzIGZvciB0ZW5hbnQgInsxfSIsIGRldmljZTogInsyfSInIC1mICgkQ291bnRSdW5zLlRvU3RyaW5nKCksJExvY2FsOk5hbWVUZW5hbnQsJExvY2FsOk5hbWVDb21wdXRlcikpCiAgICBbU3RyaW5nXSAkTG9jYWw6U3RyRW1haWwgPSBbU3RyaW5nXTo6RW1wdHkKICAgICRMb2NhbDpTdHJFbWFpbCArPSAoJExvY2FsOlN0clN1YmplY3QpCiAgICAkTG9jYWw6U3RyRW1haWwgKz0gKCJgcmBuIikKICAgICRMb2NhbDpTdHJFbWFpbCArPSAoImByYG4iICsgJyMjIEVudmlyb25tZW50IGluZm8nKQogICAgJExvY2FsOlN0ckVtYWlsICs9ICgiYHJgbiIgKyAnRGV2aWNlIG5hbWU6ICcgKyAkU2NyaXB0OkNvbXB1dGVyTmFtZSArICcgfCBNYW51ZmFjdHVyZXI6ICcgKyAkU2NyaXB0OkNvbXB1dGVyTWFudWZhY3R1cmVyICsgJyB8IE1vZGVsOiAnICsgJFNjcmlwdDpDb21wdXRlclByb2R1Y3ROYW1lKSAKICAgICRMb2NhbDpTdHJFbWFpbCArPSAoImByYG4iICsgJ1dpbmRvd3MgRWRpdGlvbjogJyArICRTY3JpcHQ6V2luZG93c0VkaXRpb24gKyAnIHwgV2luZG93cyBWZXJzaW9uJyArICRTY3JpcHQ6V2luZG93c1ZlcnNpb24pCiAgICAkTG9jYWw6U3RyRW1haWwgKz0gKCJgcmBuYHJgbiIgKyAnVGhlcmUgaGF2ZSBub3cgYmVlbiB7MH0gcnVucywgYnV0IEJpdExvY2tlclRyaWdnZXIgU1RJTEwgZmFpbHMuJyAtZiAoJFNjcmlwdDpDb3VudFJ1bnMpKQogICAgJExvY2FsOlN0ckVtYWlsICs9ICgiYHJgbiIgKyAnU3VjY2VzcyBzdGF0dXMgfCBFbmNyeXB0ZWQgOiB7MH0gfCBQcm90ZWN0aW9uIFBhc3N3b3JkcyBwcmVzZW50IDogezF9IHwgQmFja3VwIHRvIEF6dXJlQUQgOiB7Mn0gfCBCYWNrdXAgdG8gT25lRHJpdmUgOiB7M30nIC1mICgkU2NyaXB0OklzRW5jcnlwdGVkLCRTY3JpcHQ6SXNQcm90ZWN0aW9uUGFzc3csJFNjcmlwdDpJc0JhY2t1cEFBRCwkU2NyaXB0OklzQmFja3VwT0QpKQogICAgTG9nV3JpdGUgKCRMb2NhbDpTdHJFbWFpbCkKICAgIDwjIyMgU2VuZCBlbWFpbAogICAgIyMgTWFpbCBhZGRyZXNzKGVzKQogICAgW1N0cmluZ10gJExvY2FsOlN0clRvRW1haWxBZGRyZXNzID0gJ09sYXYgUi4gQmlya2VsYW5kIDxvbGF2YkBpcm9uc3RvZWl0LmNvbT47JwogICAgIyRTdHJFbWFpbEFkZHJlc3MgKz0gJ0lyb25zdG9uZSBTZXJ2aWNlZGVzayA8c2VydmljZWRla3NAaXJvbnN0b25laXQuY29tPicKICAgIFtTdHJpbmddICRMb2NhbDpTdHJGcm9tRW1haWxBZGRyZXNzID0gKCdCaXRMb2NrZXJUcmlnZ2VyRmFpbEB7MH0nIC1mICgkU2NyaXB0Ok5hbWVUZW5hbnQpKQogICAgI1NlbmQtTWFpbE1lc3NhZ2UgLVRvICRMb2NhbDpTdHJUb0VtYWlsQWRkcmVzcyAtU210cFNlcnZlciAgLUZyb20gJExvY2FsOlN0ckZyb21FbWFpbEFkZHJlc3MgLVN1YmplY3QgJExvY2FsOlN0clN1YmplY3QgLUJvZHkgJExvY2FsOlN0ckVtYWlsCiAgICAjPgp9CgoKCiMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjIyMgRU5EIFJFU1VMVCAjIyMjCiMjIyMjIyMjIyMjIyMjIyMjIyMjCkxvZ1dyaXRlICgnIyMjIEVuZCByZXN1bHRzJykKV3JpdGUtU3RhdHMKIyBDbGVhbmluZyB1cCBpZiBzdWNjZXNzCklmICgkU2NyaXB0OklzRW5jcnlwdGVkIC1hbmQgJFNjcmlwdDpJc1Byb3RlY3Rpb25QYXNzdyAtYW5kICRTY3JpcHQ6SXNCYWNrdXBBQUQgLWFuZCAkU2NyaXB0OklzQmFja3VwT0QpIHsKICAgIEdldC1CaXRMb2NrZXJTdGF0dXMKICAgIEdldC1SZWNvdmVyeVBhc3N3b3JkcwogICAgSWYgKCgkU2NyaXB0OlZvbHVtZUVuY1N0YXR1cyAtZXEgJ0Z1bGx5RW5jcnlwdGVkJykgLWFuZCAoJFNjcmlwdDpBcnJheVByb3RlY3Rpb25QYXNzd29yZHMuQ291bnQgLWdlIDEpKSB7CiAgICAgICAgTG9nV3JpdGUgJ1JlbW92aW5nIHRoZSBTY2hlZHVsZWQgdGFzayBhbmQgZmlsZXMuJwogICAgICAgIAogICAgICAgICMgU2NoZWR1bGVkIFRhc2sKICAgICAgICAkTG9jYWw6U2NoZWR1bGVkVGFza3MgPSBHZXQtU2NoZWR1bGVkVGFzayB8IFdoZXJlLU9iamVjdCB7JF8uVGFza05hbWUgLWxpa2UgJFNjcmlwdDpTY2hlZHVsZWRUYXNrTmFtZSAtb3IgJF8uVGFza05hbWUgLWxpa2UgJypUcmlnZ2VyJ30KICAgICAgICBJZiAoJExvY2FsOlNjaGVkdWxlZFRhc2tzLmxlbmd0aCAtZ3QgMCkgewogICAgICAgICAgICAkTG9jYWw6VGFza3MgfCBGb3JFYWNoLU9iamVjdCB7ICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgJG51bGwgPSBVbnJlZ2lzdGVyLVNjaGVkdWxlZFRhc2sgLVRhc2tOYW1lICRfLlRhc2tOYW1lIC1Db25maXJtOiRmYWxzZSAtRXJyb3JBY3Rpb24gU2lsZW50bHlDb250aW51ZQogICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdSZW1vdmluZyB0aGUgU2NoZWR1bGVkIHRhc2sgInswfSIuIFN1Y2Nlc3M/IHsxfScgLWYgKCRfLlRhc2tOYW1lLCQ/KSkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBFbHNlIHsKICAgICAgICAgICAgSWYgKEdldC1TY2hlZHVsZWRUYXNrIC1UYXNrTmFtZSAkU2NyaXB0OlNjaGVkdWxlZFRhc2tOYW1lIC1FcnJvckFjdGlvbiBTaWxlbnRseUNvbnRpbnVlKSB7ICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAkbnVsbCA9IFVucmVnaXN0ZXItU2NoZWR1bGVkVGFzayAtVGFza05hbWUgJFNjcmlwdDpTY2hlZHVsZWRUYXNrTmFtZSAtQ29uZmlybTokZmFsc2UgLUVycm9yQWN0aW9uIFNpbGVudGx5Q29udGludWUKICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnUmVtb3ZpbmcgdGhlIFNjaGVkdWxlZCB0YXNrICJ7MH0iLiBTdWNjZXNzPyB7MX0nIC1mICgkU2NyaXB0OlNjaGVkdWxlZFRhc2tOYW1lLCQ/KSkKICAgICAgICAgICAgfQogICAgICAgICAgICBFbHNlIHsKICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnU2NoZWR1bGVkIHRhc2sgInswfSIgZG9lcyBub3QgZXhpc3QuJyAtZiAoJFNjcmlwdDpTY2hlZHVsZWRUYXNrTmFtZSkpCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgRmlsZXMKICAgICAgICBJZiAoLW5vdCgkU2NyaXB0OkJvb2xSZW1vdmVGaWxlc0FmdGVyU3VjY2VzcykpIHsKICAgICAgICAgICAgW1N0cmluZ10gJExvY2FsOkxvZ0Rlc3RQYXRoID0gKCRTY3JpcHQ6Qml0TG9ja2VyVHJpZ2dlclBhdGggKyAnVHJpZ2dlckJpdExvY2tlci5sb2cnKQogICAgICAgICAgICBDb3B5LUl0ZW0gLVBhdGggJFNjcmlwdDpGaWxlTG9nIC1EZXN0aW5hdGlvbiAkTG9jYWw6TG9nRGVzdFBhdGggLUZvcmNlCiAgICAgICAgfQogICAgICAgIEVsc2UgewogICAgICAgICAgICAkbnVsbCA9IFN0YXJ0LUpvYiAtQXJndW1lbnRMaXN0ICRTY3JpcHQ6RmlsZUxvZyAtU2NyaXB0QmxvY2sgewogICAgICAgICAgICAgICAgUGFyYW0oCiAgICAgICAgICAgICAgICAgICAgW3N0cmluZ10gJEZpbGVMb2cKICAgICAgICAgICAgICAgICkKICAgICAgICAKICAgICAgICAgICAgICAgIEZ1bmN0aW9uIExvZ1dyaXRlIHsKICAgICAgICAgICAgICAgICAgICBQYXJhbSAoW3N0cmluZ10kTG9nU3RyaW5nKQogICAgICAgICAgICAgICAgICAgIFtzdHJpbmddICRhID0gR2V0LURhdGUKICAgICAgICAgICAgICAgICAgICBbc3RyaW5nXSAkTG9nU3RyaW5nID0gJGEsICRMb2dTdHJpbmcKICAgICAgICAgICAgICAgICAgICBBZGQtY29udGVudCAtUGF0aCAkRmlsZUxvZyAtVmFsdWUgJExvZ1N0cmluZwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgW1N0cmluZ10gJExvY2FsOlJlbURpclBhdGggPSAoJHtlbnY6UHJvZ3JhbUZpbGVzKHg4Nil9ICsgJ1xCaXRMb2NrZXJUcmlnZ2VyXCcpCiAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzIDUKICAgICAgICAgICAgICAgIExvZ1dyaXRlICgnU3RhcnRlZCB0aGUgam9iIHRvIHJlbW92ZSAiezB9IicgLWYgKCRMb2NhbDpSZW1EaXJQYXRoKSkKICAgICAgICAgICAgICAgIElmIChUZXN0LVBhdGggJExvY2FsOlJlbURpclBhdGgpIHsKICAgICAgICAgICAgICAgICAgICBSZW1vdmUtSXRlbSAtUGF0aCAkTG9jYWw6UmVtRGlyUGF0aCAtUmVjdXJzZSAtRm9yY2UKICAgICAgICAgICAgICAgICAgICBMb2dXcml0ZSAoJ1JlbW92aW5nIHRoZSBmb2xkZXIgKHJlY3Vyc2UsIGZvcmNlKS4gU3VjY2Vzcz8gezB9JyAtZiAoJD8pKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgRWxzZSB7CiAgICAgICAgICAgICAgICAgICAgTG9nV3JpdGUgKCdGb2xkZXIgZG9lcyBub3QgZXhpc3QnKQogICAgICAgICAgICAgICAgfSAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSAgICAKfQpFbHNlIHsKICAgIExvZ1dyaXRlICdUaGVyZSBhcmUgc3RpbGwgdGhpbmdzIHRvIGRvLiBUcnlpbmcgYWdhaW4gaW4gMTUgbWludXRlcy4nCn0KCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMjIyAgRCBPIE4gRSAgIyMjIyMKIyMjIyMjIyMjIyMjIyMjIyMjIyMKTG9nV3JpdGUgKCdBbGwgZG9uZSwgZXhpdGluZyBzY3JpcHQuLi4nKQ==')
#endregion FilePS1

# Enable-BitLockerTrigger.VBS
#region FileVBS
[String] $Local:NameVBS = 'Enable_BitLocker.vbs'
[String] $Local:FileVBS = ('U2V0IG9ialNoZWxsID0gQ3JlYXRlT2JqZWN0KCJXc2NyaXB0LlNoZWxsIikgIA0KU2V0IGFyZ3MgPSBXc2NyaXB0LkFyZ3VtZW50cyAgDQpGb3IgRWFjaCBhcmcgSW4gYXJncyAgDQogICAgRGltIFBTUnVuDQogICAgUFNSdW4gPSAicG93ZXJzaGVsbC5leGUgLVdpbmRvd1N0eWxlIGhpZGRlbiAtRXhlY3V0aW9uUG9saWN5IGJ5cGFzcyAtTm9uSW50ZXJhY3RpdmUgLUZpbGUgIiIiICYgYXJnICYgIiIiIg0KICAgIG9ialNoZWxsLlJ1bihQU1J1biksMA0KTmV4dA==')
#endregion FileVBS
    
# Enable-BitLockerTrigger.XML
#region FileXML
[String] $Local:NameXML = 'Enable_BitLocker.xml'
[String] $Local:FileXML = ('PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTE2Ij8+CjxUYXNrIHZlcnNpb249IjEuNCIgeG1sbnM9Imh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd2luZG93cy8yMDA0LzAyL21pdC90YXNrIj4KICA8UmVnaXN0cmF0aW9uSW5mbz4KICAgIDxEYXRlPjIwMTgtMDEtMDFUMTQ6MDA6MDA8L0RhdGU+CiAgICA8QXV0aG9yPklyb25zdG9uZTwvQXV0aG9yPgogICAgPFVSST5cSXJvblRyaWdnZXI8L1VSST4KICA8L1JlZ2lzdHJhdGlvbkluZm8+CiAgPFRyaWdnZXJzPgogICAgPFRpbWVUcmlnZ2VyPgogICAgICA8UmVwZXRpdGlvbj4KICAgICAgICA8SW50ZXJ2YWw+UFQxNU08L0ludGVydmFsPgogICAgICAgIDxTdG9wQXREdXJhdGlvbkVuZD5mYWxzZTwvU3RvcEF0RHVyYXRpb25FbmQ+CiAgICAgIDwvUmVwZXRpdGlvbj4KICAgICAgPFN0YXJ0Qm91bmRhcnk+MjAxOC0wMS0wMVQwMDowMDowMDwvU3RhcnRCb3VuZGFyeT4KICAgICAgPEVuYWJsZWQ+dHJ1ZTwvRW5hYmxlZD4KICAgIDwvVGltZVRyaWdnZXI+CiAgPC9UcmlnZ2Vycz4KICA8UHJpbmNpcGFscz4KICAgIDxQcmluY2lwYWwgaWQ9IkF1dGhvciI+CiAgICAgIDxHcm91cElkPlMtMS01LTMyLTU0NTwvR3JvdXBJZD4KICAgICAgPFJ1bkxldmVsPkhpZ2hlc3RBdmFpbGFibGU8L1J1bkxldmVsPgogICAgPC9QcmluY2lwYWw+CiAgPC9QcmluY2lwYWxzPgogIDxTZXR0aW5ncz4KICAgIDxNdWx0aXBsZUluc3RhbmNlc1BvbGljeT5JZ25vcmVOZXc8L011bHRpcGxlSW5zdGFuY2VzUG9saWN5PgogICAgPERpc2FsbG93U3RhcnRJZk9uQmF0dGVyaWVzPmZhbHNlPC9EaXNhbGxvd1N0YXJ0SWZPbkJhdHRlcmllcz4KICAgIDxTdG9wSWZHb2luZ09uQmF0dGVyaWVzPmZhbHNlPC9TdG9wSWZHb2luZ09uQmF0dGVyaWVzPgogICAgPEFsbG93SGFyZFRlcm1pbmF0ZT50cnVlPC9BbGxvd0hhcmRUZXJtaW5hdGU+CiAgICA8U3RhcnRXaGVuQXZhaWxhYmxlPnRydWU8L1N0YXJ0V2hlbkF2YWlsYWJsZT4KICAgIDxSdW5Pbmx5SWZOZXR3b3JrQXZhaWxhYmxlPmZhbHNlPC9SdW5Pbmx5SWZOZXR3b3JrQXZhaWxhYmxlPgogICAgPElkbGVTZXR0aW5ncz4KICAgICAgPFN0b3BPbklkbGVFbmQ+dHJ1ZTwvU3RvcE9uSWRsZUVuZD4KICAgICAgPFJlc3RhcnRPbklkbGU+ZmFsc2U8L1Jlc3RhcnRPbklkbGU+CiAgICA8L0lkbGVTZXR0aW5ncz4KICAgIDxBbGxvd1N0YXJ0T25EZW1hbmQ+dHJ1ZTwvQWxsb3dTdGFydE9uRGVtYW5kPgogICAgPEVuYWJsZWQ+dHJ1ZTwvRW5hYmxlZD4KICAgIDxIaWRkZW4+ZmFsc2U8L0hpZGRlbj4KICAgIDxSdW5Pbmx5SWZJZGxlPmZhbHNlPC9SdW5Pbmx5SWZJZGxlPgogICAgPERpc2FsbG93U3RhcnRPblJlbW90ZUFwcFNlc3Npb24+ZmFsc2U8L0Rpc2FsbG93U3RhcnRPblJlbW90ZUFwcFNlc3Npb24+CiAgICA8VXNlVW5pZmllZFNjaGVkdWxpbmdFbmdpbmU+dHJ1ZTwvVXNlVW5pZmllZFNjaGVkdWxpbmdFbmdpbmU+CiAgICA8V2FrZVRvUnVuPmZhbHNlPC9XYWtlVG9SdW4+CiAgICA8RXhlY3V0aW9uVGltZUxpbWl0PlBUMUg8L0V4ZWN1dGlvblRpbWVMaW1pdD4KICAgIDxQcmlvcml0eT43PC9Qcmlvcml0eT4KICA8L1NldHRpbmdzPgogIDxBY3Rpb25zIENvbnRleHQ9IkF1dGhvciI+CiAgICA8RXhlYz4KICAgICAgPENvbW1hbmQ+d3NjcmlwdC5leGU8L0NvbW1hbmQ+CiAgICAgIDxBcmd1bWVudHM+IkM6XFByb2dyYW0gRmlsZXMgKHg4NilcSXJvblRyaWdnZXJcRW5hYmxlX0JpdExvY2tlci52YnMiICJDOlxQcm9ncmFtIEZpbGVzICh4ODYpXElyb25UcmlnZ2VyXEVuYWJsZV9CaXRMb2NrZXIucHMxIjwvQXJndW1lbnRzPgogICAgPC9FeGVjPgogIDwvQWN0aW9ucz4KPC9UYXNrPg==')
#endregion FileXML
#enregion Files
#endregion Variables



#region Functions
    #region Write-DebugIfOn
    Function Write-DebugIfOn {
        param(
            [Parameter(Mandatory=$true, Position=0)]
            [String] $In
        )
        If ($DebugConsole) {
            Write-Output -InputObject $In
        }
        If ($DebugWinTemp) {
            $Global:DebugStr += ($In + "`r`n")
        }
    }
    #endregion Write-DebugIfOn


    #region Check-CreateDir
    Function Check-CreateDir {
        Param(
            [Parameter(Mandatory=$true, Position=0)]
            [String] $Dir
        )
        Write-DebugIfOn -In ('Check-CreateDir -Dir ' + $Dir)
        If (!(Test-Path $Dir)) {
                Write-DebugIfOn -In '   Reg dir does not exist, trying to create'
                If(!($ReadOnly)) {
                    $null = New-Item -ItemType Directory -Force -Path $Dir 2>&1
                    If (!($?)) {
                        Write-DebugIfOn -In '      ERROR: Dir could not be created'
                    }
                    Else {
                        Write-DebugIfOn -In '      SUCCESS: Dir was created'
                    }
                }
                Else {Write-DebugIfOn -In '      ReadOnly mode'}
            } 
        Else {
            Write-DebugIfOn -In '   Reg dir does already exist'
        } 
    }
    #endregion Check-CreateDir


    #region FileOut-FromBase64
    Function FileOut-FromBase64 {
        Param(
            [Parameter(Mandatory=$true)]
            [String] $InstallDir, $FileName, $File, $Encoding
        )
        Write-DebugIfOn -In ('FileOut-FromBase64 -FilePath ' + $InstallDir + ' -FileName ' + $FileName + ' -File ' + ($File.Substring(0,10) + '...'))
        $Local:FilePath = $InstallDir + $FileName

        If (Test-Path $InstallDir) {
            Write-DebugIfOn -In ('   Path exists, trying to write the file (File alrady exists? {0})' -f (Test-Path $Local:FilePath))
            If (-not($ReadOnly)) {
                Out-File -FilePath $Local:FilePath -Encoding $Encoding -InputObject ([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($File)))
                Write-DebugIfOn -In ('      Success? {0}' -f ($?))
                Write-DebugIfOn -In ('         Does file actually exist? {0}' -f (Test-Path $Local:FilePath -ErrorAction SilentlyContinue))
            }
        }
        Else {
            Write-DebugIfOn -In ('   ERROR: Path does not exist')
        }
    }
    #enregion FileOut-FromBase64


    #region Query-Registry
    Function Query-Registry {
        Param ([Parameter(Mandatory=$true)] [String] $Dir)
        $Local:Out = [String]::Empty
        [String] $Local:Key = $Dir.Split('{\}')[-1]
        [String] $Local:Dir = $Dir.Replace($Local:Key,'')
        
        $Local:Exists = Get-ItemProperty -Path ('{0}' -f $Dir) -Name ('{0}' -f $Local:Key) -ErrorAction SilentlyContinue
        If ($Exists) {
            $Local:Out = $Local:Exists.$Local:Key
        }
        return $Local:Out
    }
    #endregion Query-Registry


    #region Get-MachineInfo
    Function Get-MachineInfo {
        $Script:ComputerName = $env:COMPUTERNAME
        [String] $Script:ComputerManufacturer = Query-Registry -Dir 'HKLM:\HARDWARE\DESCRIPTION\System\BIOS\SystemManufacturer'
        If (-not([String]::IsNullOrEmpty($Script:ComputerManufacturer))) {
            [String] $Script:ComputerFamily = Query-Registry -Dir 'HKLM:\HARDWARE\DESCRIPTION\System\BIOS\SystemFamily'
            [String] $Script:ComputerProductName = Query-Registry -Dir 'HKLM:\HARDWARE\DESCRIPTION\System\BIOS\SystemProductName'
            [String] $Script:WindowsEdition = Query-Registry -Dir 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProductName'
            [String] $Script:WindowsVersion = Query-Registry -Dir 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ReleaseId'
            [String] $Script:WindowsVersion += (' ({0})' -f (Query-Registry -Dir 'HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\CurrentBuild'))
        } 
        Else {
            $Local:EnvInfo = Get-WmiObject -Class Win32_ComputerSystem | Select-Object -Property Manufacturer,Model,SystemFamily        
            [String] $Script:ComputerManufacturer = $Local:EnvInfo.Manufacturer
            [String] $Script:ComputerFamily = $Local:EnvInfo.SystemFamily
            [String] $Script:ComputerProductName = $Local:EnvInfo.Model
            $Local:OSInfo = Get-WmiObject -Class win32_operatingsystem | Select-Object -Property Caption,Version
            [String] $Script:WindowsEdition = $Local:OSInfo.Caption
            [String] $Script:WindowsVersion = $Local:OSInfo.Version
        }
    }
    #endregion Get-MachineInfo
#enregion Functions



#region Initialize
Get-MachineInfo
If ($DebugWinTemp -or $DebugConsole) {
    Write-DebugIfOn -In '### Environment Info'
    Write-DebugIfOn -In ('Script settings: DebugConsole = "{0}", DebugWinTemp = "{1}", ReadOnly = "{2}"' -f ($DebugConsole,$DebugWinTemp,$Script:ReadOnly))
    Write-DebugIfOn -In ('Machine info: Name = "{0}", Manufacturer = "{1}", Family = "{2}", Model = "{3}"' -f ($Script:ComputerName,$Script:ComputerManufacturer,$Script:ComputerFamily,$Script:ComputerProductName))
    Write-DebugIfOn -In ('Windows info: Edition = "{0}", Version = "{1}"' -f ($Script:WindowsEdition,$Script:WindowsVersion))
}
#endregion Initialize



#region Main
    Write-DebugIfOn -In ("`r`n`r`n" + '### ' + $WhatToConfig)

    [String] $Local:InstallDir = (${env:ProgramFiles(x86)} + '\IronTrigger\')


    ###########################################################
    ### 1. Clean up BitLockerTrigger and IronTrigger
    Write-DebugIfOn -In ("`r`n`r`n" + '# 1. Clean up previous installations')
    # Paths
    Write-DebugIfOn -In ('Remove previous install path(s) if present')
    [String[]] $Local:RemPaths = @($Local:InstallDir,(${env:ProgramFiles(x86)} + '\BitLockerTrigger\'))
    $Local:RemPaths | ForEach-Object {
        Write-DebugIfOn -In ('   Removing "{0}" if it exists.' -f ($_))
        If (Test-Path -Path ('"{0}"' -f ($_))) {
            Remove-Item -Path ('"{0}"' -f ($_)) -Force -Recurse
            Write-DebugIfOn -In ('      File does exist. Removing. Success? .' -f ($?))
        }
        Else {
            Write-DebugIfOn -In ('      File does not exist')
        }
    }
    # Stats and Logs
    Write-DebugIfOn -In ('Remove previous files, stats and logs')
    [String[]] $Local:RemItems = @(($env:windir + '\Temp\BitLockerTrigger.log'),($env:windir + '\Temp\IronTrigger.log'))
    $Local:RemItems | ForEach-Object { 
        Write-DebugIfOn -In ('   Removing "{0}" if it exists.' -f ($_))
        If (Test-Path -Path ('"{0}"' -f ($_))) {
            Remove-Item -Path ('"{0}"' -f ($_)) -Force
            Write-DebugIfOn -In ('      File does exist. Removing. Success? .' -f ($?))
        }
        Else {
            Write-DebugIfOn -In ('      File does not exist')
        }     
    }
    # Scheduled tasks
    Write-DebugIfOn -In ('Remove previous ScheduledTask(s)')
    $Local:ScheduledTasks = Get-ScheduledTask | Where-Object {$_.TaskName -like $Script:ScheduledTaskName -or $_.TaskName -like '*Trigger'}
    If ($Local:ScheduledTasks.length -gt 0) {
        $Local:Tasks | ForEach-Object {             
            $null = Unregister-ScheduledTask -TaskName $_.TaskName -Confirm:$false -ErrorAction SilentlyContinue
            Write-DebugIfOn -In ('  Removing the Scheduled task "{0}". Success? {1}' -f ($_.TaskName,$?))
        }
    }
    Else {
        If (Get-ScheduledTask -TaskName $Script:ScheduledTaskName -ErrorAction SilentlyContinue) {            
            $null = Unregister-ScheduledTask -TaskName $Script:ScheduledTaskName -Confirm:$false -ErrorAction SilentlyContinue
            Write-DebugIfOn -In ('  Removing the Scheduled task "{0}". Success? {1}' -f ($Script:ScheduledTaskName,$?))
        }
        Else {
            Write-DebugIfOn -In ('  Scheduled task "{0}" does not exist.' -f ($Script:ScheduledTaskName))
        }
    }



    ###########################################################
    ### 2. Create install dir
    Write-DebugIfOn -In ("`r`n`r`n" + '# 2. Create "{0}"' -f ($Local:InstallDir))
    Check-CreateDir -Dir $InstallDir
    

    ###########################################################
    ### 3. Import files
    Write-DebugIfOn -In ("`r`n`r`n" + '# 3. Import files to "{0}"' -f ($Local:InstallDir))
    FileOut-FromBase64 -InstallDir $Local:InstallDir -FileName $Local:NamePS1 -File $Local:FilePS1 -Encoding utf8
    FileOut-FromBase64 -InstallDir $Local:InstallDir -FileName $Local:NameVBS -File $Local:FileVBS -Encoding default
    FileOut-FromBase64 -InstallDir $Local:InstallDir -FileName $Local:NameXML -File $Local:FileXML -Encoding utf8


    ###########################################################
    ### 4. Create ScheduledTask from XML
    Write-DebugIfOn -In ("`r`n`r`n" + '# 4. Create Scheduled Task "{0}"' -f ($Script:ScheduledTaskName))
    Write-DebugIfOn -In ('Register-ScheduledTask -Xml (Get-Content "{0}" | Out-String) -TaskName "{1}" -Force' -f (($Local:InstallDir + $Local:NameXML),$Script:ScheduledTaskName))
    $null = Register-ScheduledTask -Xml (Get-Content ($Local:InstallDir + $Local:NameXML) | Out-String) -TaskName $Script:ScheduledTaskName -Force
    Write-DebugIfOn -In ('   Success? {0}' -f ($?))


    Write-DebugIfOn -In 'Done.'    
#endregion Main



#region Debug
If ($DebugWinTemp) {
    If ([String]::IsNullOrEmpty($DebugStr)) {
        $DebugStr = 'Everything failed'
    }

    # Write Output
    $DebugPath = 'C:\Windows\Temp\'
    $CurDate = Get-Date -Uformat '%y%m%d'
    $CurTime = Get-Date -Format 'HHmmss'
    $DebugFileName = ('Debug Powershell ' + $WhatToConfig + ' ' + $CurDate + $CurTime + '.txt')

    $DebugStr | Out-File -FilePath ($DebugPath + $DebugFileName) -Encoding 'utf8'
    If (!($?)) {
        $DebugStr | Out-File -FilePath ($env:TEMP + '\' + $DebugFileName) -Encoding 'utf8'
    }
}
#endregion Debug